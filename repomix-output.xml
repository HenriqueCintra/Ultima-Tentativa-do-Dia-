This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
4. Repository files, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

<additional_info>

</additional_info>

</file_summary>

<directory_structure>
.env.example
.repomixignore
components.json
docker-compose.yml
Dockerfile
eslint.config.js
index.html
package.json
src/api/authService.ts
src/api/config.ts
src/api/gameService.ts
src/api/teamService.ts
src/App.css
src/App.tsx
src/components/ButtonHomeBack.tsx
src/components/Cloud.tsx
src/components/CreateTeamButton.tsx
src/components/ProtectedRoute.tsx
src/components/SelectTeamButton.tsx
src/components/TeamCard.tsx
src/components/ui/button.tsx
src/components/ui/card.tsx
src/components/ui/carousel.tsx
src/components/ui/dialog.tsx
src/components/ui/input.tsx
src/components/ui/separator.tsx
src/constants/teams.ts
src/contexts/AuthContext.tsx
src/index.css
src/lib/utils.ts
src/main.tsx
src/pages/auth/Cadastro/Cadastro.tsx
src/pages/auth/ForgotPassword/ForgotPassword.tsx
src/pages/auth/Login/Login.tsx
src/pages/ChooseTeam/ChooseTeam.tsx
src/pages/Desafio/ApresentacaoDesafio.tsx
src/pages/escolherVeiculo/index.ts
src/pages/escolherVeiculo/VehicleSelectionPage.tsx
src/pages/fuel/FuelPage.tsx
src/pages/Game-truck/game.css
src/pages/Game-truck/game.tsx
src/pages/Game-truck/GameMiniMap.tsx
src/pages/Game-truck/kaboom.ts
src/pages/GameSelection/components/Footer.tsx
src/pages/GameSelection/components/GameCard.tsx
src/pages/GameSelection/components/PixelHeading.tsx
src/pages/GameSelection/GameSelectionPage.tsx
src/pages/Home/HomePage.tsx
src/pages/Home/index.ts
src/pages/mapaRota/FuelModal.tsx
src/pages/mapaRota/MapComponent.tsx
src/pages/mapaRota/routesData.ts
src/pages/PauseMenu/PauseMenu.tsx
src/pages/Perfil/ChangePassword.tsx
src/pages/Perfil/CriarEquipe.tsx
src/pages/Perfil/EditarEquipe.tsx
src/pages/Perfil/EditarPerfil.tsx
src/pages/Perfil/ExcluirEquipe.tsx
src/pages/Perfil/PerfilPage.tsx
src/pages/Ranking/RankingPage.tsx
src/pages/RoutesPage/RoutesPage.tsx
src/pages/Tutorial/TutorialPage.tsx
src/styles/pixelArt.css
src/types/index.ts
src/types/vehicle.ts
tsconfig.app.json
tsconfig.json
tsconfig.node.json
tsconfig.tsbuildinfo
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".env.example">
VITE_API_URL=http://localhost:8000
</file>

<file path="src/pages/escolherVeiculo/index.ts">
export { VehicleSelectionPage } from './VehicleSelectionPage';
</file>

<file path=".repomixignore">
# Dependencies
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# Build outputs
build/
dist/
out/
.next/
.nuxt/
.output/
.vercel/
.netlify/

# Cache directories
.cache/
.parcel-cache/
.tmp/
.temp/
.vite/
.turbo/

# Environment files
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# IDE/Editor files
.vscode/
.idea/
*.swp
*.swo
*~

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Logs
logs/
*.log

# Test coverage
coverage/
.nyc_output/
.coverage/

# Package manager lock files (mant√©m apenas um)
# package-lock.json
# yarn.lock
# pnpm-lock.yaml

# Assets grandes (imagens, v√≠deos, fontes)
*.png
*.jpg
*.jpeg
*.gif
*.svg
*.ico
*.webp
*.mp4
*.avi
*.mov
*.wmv
*.flv
*.woff
*.woff2
*.ttf
*.eot
*.otf

# Documenta√ß√£o (se n√£o for essencial)
README.md
CHANGELOG.md
LICENSE
*.md

# Configura√ß√µes n√£o essenciais
.prettierrc*
.eslintrc*
.stylelintrc*
.editorconfig
.gitignore
.gitattributes
tailwind.config.js
postcss.config.js
vite.config.*
webpack.config.*
rollup.config.*
babel.config.*
jest.config.*
cypress.json
playwright.config.*

# Testes (se n√£o quiser incluir)
# __tests__/
# **/*.test.*
# **/*.spec.*
# cypress/
# e2e/

# Storybook
.storybook/
storybook-static/

# Tipos gerados automaticamente
*.d.ts

# Arquivos de exemplo/demo
examples/
demo/
docs/
documentation/

# Mapas de source
*.map

# Arquivos de rotas espec√≠ficos (dados de path grandes)
src/pages/mapaRota/paths/route1Path.ts
src/pages/mapaRota/paths/route2Path.ts
src/pages/mapaRota/paths/route3Path.ts
src/pages/mapaRota/paths/route4Path.ts

# Ou se quiser ignorar todos os paths dessa pasta:
# src/pages/mapaRota/paths/
</file>

<file path="src/components/ui/carousel.tsx">
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}
</file>

<file path="src/components/ui/dialog.tsx">
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 opacity-80 transition-all duration-300 ease-in-out
               hover:scale-110 rounded-md text bg-red-600  ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <h1 className="font-pixel text-sm text-white" >X</h1>
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogTrigger,
  DialogClose,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}
</file>

<file path="src/pages/Game-truck/game.css">
@import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');

/* Garantir que o body n√£o tenha margem/padding para tela cheia */
body {
  margin: 0;
  padding: 0;
  overflow: hidden; /* Evitar scroll bars em tela cheia */
}

.tittle {
    font-family: "Silkscreen", sans-serif;
}

.endMessage {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    text-align: center;
    color: black;
    font-family: "Silkscreen", sans-serif;
    z-index: 2000;
}

/* Ajustes responsivos para diferentes tamanhos de tela */
@media (max-width: 768px) {
  .endMessage {
    width: 90%;
    max-width: 350px;
    padding: 15px;
  }
}
</file>

<file path="src/pages/Game-truck/kaboom.ts">
import kaboom from "kaboom";

export const k = kaboom({
  width: 640,
  height: 480,
  canvas: document.createElement("canvas"), // ser√° substitu√≠do depois!
  scale: 2,
  background: [0, 0, 0],
});
</file>

<file path="tsconfig.tsbuildinfo">
{"root":["./src/App.tsx","./src/main.tsx","./src/vite-env.d.ts","./src/api/authService.ts","./src/api/config.ts","./src/api/gameService.ts","./src/api/teamService.ts","./src/components/ButtonHomeBack.tsx","./src/components/Cloud.tsx","./src/components/CreateTeamButton.tsx","./src/components/ProtectedRoute.tsx","./src/components/SelectTeamButton.tsx","./src/components/TeamCard.tsx","./src/components/ui/button.tsx","./src/components/ui/card.tsx","./src/components/ui/carousel.tsx","./src/components/ui/dialog.tsx","./src/components/ui/input.tsx","./src/components/ui/separator.tsx","./src/constants/teams.ts","./src/contexts/AuthContext.tsx","./src/lib/utils.ts","./src/pages/ChooseTeam/ChooseTeam.tsx","./src/pages/Desafio/ApresentacaoDesafio.tsx","./src/pages/Game-truck/game.tsx","./src/pages/Game-truck/kaboom.ts","./src/pages/GameSelection/GameSelectionPage.tsx","./src/pages/GameSelection/components/Footer.tsx","./src/pages/GameSelection/components/GameCard.tsx","./src/pages/GameSelection/components/PixelHeading.tsx","./src/pages/Home/HomePage.tsx","./src/pages/Home/index.ts","./src/pages/Perfil/ChangePassword.tsx","./src/pages/Perfil/CriarEquipe.tsx","./src/pages/Perfil/EditarEquipe.tsx","./src/pages/Perfil/EditarPerfil.tsx","./src/pages/Perfil/ExcluirEquipe.tsx","./src/pages/Perfil/PerfilPage.tsx","./src/pages/Ranking/RankingPage.tsx","./src/pages/RoutesPage/RoutesPage.tsx","./src/pages/Tutorial/TutorialPage.tsx","./src/pages/auth/Cadastro/Cadastro.tsx","./src/pages/auth/ForgotPassword/ForgotPassword.tsx","./src/pages/auth/Login/Login.tsx","./src/pages/escolherVeiculo/VehicleSelectionPage.tsx","./src/pages/escolherVeiculo/index.ts","./src/pages/fuel/FuelPage.tsx","./src/pages/mapaRota/FuelModal.tsx","./src/pages/mapaRota/MapComponent.tsx","./src/pages/mapaRota/routesData.ts","./src/pages/mapaRota/paths/route1Path.ts","./src/pages/mapaRota/paths/route2Path.ts","./src/pages/mapaRota/paths/route3Path.ts","./src/pages/mapaRota/paths/route4Path.ts","./src/types/index.ts","./src/types/vehicle.ts"],"errors":true,"version":"5.7.3"}
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/index.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="docker-compose.yml">
services:
  frontend:
    build: .
    ports:
      - "5173:5173"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - CHOKIDAR_USEPOLLING=true
    stdin_open: true
    tty: true
    command: npm run dev -- --host 0.0.0.0
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
    },
  },
)
</file>

<file path="src/api/teamService.ts">
// src/api/teamService.ts
import api from './config';
import { Team, TeamCreationData, TeamDetails } from '../types';

export const TeamService = {
  // Busca a lista de todas as equipes
  async getTeams(): Promise<Team[]> {
    const response = await api.get('/equipes/');
    return response.data;
  },

  // Cria uma nova equipe
  async createTeam(data: TeamCreationData): Promise<TeamDetails> {
    const response = await api.post<TeamDetails>('/equipes/', data);
    return response.data;
  },

  // Busca detalhes de uma equipe espec√≠fica
  async getTeamDetails(teamId: number): Promise<TeamDetails> {
    const response = await api.get<TeamDetails>(`/equipes/${teamId}/`);
    return response.data;
  },

  // Atualiza dados da equipe
  async updateTeam(teamId: number, data: { nome: string }): Promise<TeamDetails> {
    const response = await api.patch<TeamDetails>(`/equipes/${teamId}/`, data);
    return response.data;
  },

  // Regenera c√≥digo de convite
  async regenerateCode(teamId: number): Promise<{ detail: string; novo_codigo: string }> {
    const response = await api.post<{ detail: string; novo_codigo: string }>(`/equipes/${teamId}/regenerate-code/`);
    return response.data;
  },

  // Exclui a equipe
  async deleteTeam(teamId: number): Promise<void> {
    await api.delete(`/equipes/${teamId}/`);
  },

  // Faz o usu√°rio atual entrar em uma equipe via c√≥digo
  async joinTeam(code: string): Promise<{ detail: string }> {
    const response = await api.post<{ detail: string }>('/equipes/entrar/', { codigo: code });
    return response.data;
  }
};
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/components/CreateTeamButton.tsx">
import React from 'react';
import { Plus } from 'lucide-react';

interface CreateTeamButtonProps {
  onClick: () => void;
}

const CreateTeamButton: React.FC<CreateTeamButtonProps> = ({ onClick }) => {
  return (
    <div 
      onClick={onClick} 
      className=" bg-white border-2 border-black rounded-lg p-6 flex flex-col items-center justify-center h-22 cursor-pointer 
        hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-all hover:-translate-x-[2px] hover:-translate-y-[2px]"
    >
      <div className="w-8 h-8 rounded-full border-2 border-cyan-400 flex items-center justify-center">
        <Plus size={32} className="text-cyan-400" />
      </div>
      <span className="font-pixel text-cyan-400 text-center mt-4">CRIAR NOVA EQUIPE</span>
    </div>
  );
};

export default CreateTeamButton;
</file>

<file path="src/components/SelectTeamButton.tsx">
import React from 'react';

interface SelectTeamButtonProps {
  onClick: () => void;
}

const SelectTeamButton: React.FC<SelectTeamButtonProps> = ({ onClick }) => {
  return (
    <button 
      onClick={onClick}
      className="w-[500px] mx-auto bg-orange-500 text-black font-bold py-2 px-6 border-2 border-black mb-2
        hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-all 
        hover:-translate-x-[2px] hover:-translate-y-[2px] text-xl"
    >
      ESCOLHER ESSA EQUIPE
    </button>

  );
};

export default SelectTeamButton;
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",
        outline:
          "border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2",
        sm: "h-8 rounded-md px-3 text-xs",
        lg: "h-10 rounded-md px-8",
        icon: "h-9 w-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-xl border bg-card text-card-foreground shadow",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("font-semibold leading-none tracking-tight", className)}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
</file>

<file path="src/components/ui/separator.tsx">
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }
</file>

<file path="src/constants/teams.ts">
import { Team } from '../types';

export const TEAMS: Team[] = [
  {
    id: 'team1',
    name: 'ENTREGA R√ÅPIDA',
    stats: {
      people: 4,
      trophy: 25,
    },
    selected: false,
    history: [
      {
        id: 'history1',
        name: 'ENTREGA EFICIENTE',
        stats: {
          people: 3,
          trophy: 15,
          tasks: 4
        },
        color: 'bg-yellow-500'
      },
      {
        id: 'history2',
        name: 'JOGO 2',
        stats: {
          people: 2,
          trophy: 10,
          tasks: 3
        },
        color: 'bg-cyan-500'
      },
      {
        id: 'history3',
        name: 'JOGO 3',
        stats: {
          people: 2,
          trophy: 5,
          tasks: 1
        },
        color: 'bg-emerald-500'
      }
    ]
  },
  {
    id: 'team2',
    name: 'FRUIT VALE',
    stats: {
      people: 4,
      trophy: 5,
      trucks: 3
    },
    selected: false,
    history: [
      {
        id: 'history1',
        name: 'ENTREGA EFICIENTE',
        stats: {
          people: 3,
          trophy: 15,
          tasks: 4
        },
        color: 'bg-yellow-500'
      },
      {
        id: 'history2',
        name: 'JOGO 2',
        stats: {
          people: 2,
          trophy: 10,
          tasks: 3
        },
        color: 'bg-cyan-500'
      },
      {
        id: 'history3',
        name: 'JOGO 3',
        stats: {
          people: 2,
          trophy: 5,
          tasks: 1
        },
        color: 'bg-emerald-500'
      }
    ]
  }
];
</file>

<file path="src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/pages/auth/ForgotPassword/ForgotPassword.tsx">
import { useState } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Button } from "../../../components/ui/button";
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "../../../components/ui/card";
import { Input } from "../../../components/ui/input";
import { ArrowLeft, House, AlertCircle } from 'lucide-react';
import { ButtonHomeBack } from "@/components/ButtonHomeBack";
import AuthService from "../../../api/authService";

export const ForgotPassword = () => {
  const navigate = useNavigate();
  const { uidb64, token } = useParams(); // Para reset de senha
  const [step, setStep] = useState(uidb64 && token ? 2 : 1);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [success, setSuccess] = useState("");

  const handleEmailSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!email) {
      setError("Por favor, informe seu e-mail");
      return;
    }

    setLoading(true);
    setError("");

    try {
      await AuthService.requestPasswordReset({ email });
      setSuccess("E-mail de recupera√ß√£o enviado! Verifique sua caixa de entrada.");
      setTimeout(() => {
        if (!uidb64 && !token) {
          navigate('/login');
        }
      }, 3000);
    } catch (error: any) {
      if (error.response && error.response.data) {
        if (error.response.data.email) {
          setError(error.response.data.email.join(", "));
        } else if (error.response.data.detail) {
          setError(error.response.data.detail);
        } else {
          setError("Falha ao solicitar recupera√ß√£o de senha.");
        }
      } else {
        setError("Erro de conex√£o. Tente novamente mais tarde.");
      }
    } finally {
      setLoading(false);
    }
  };

  const handlePasswordReset = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!password || !confirmPassword) {
      setError("Por favor, preencha todos os campos");
      return;
    }

    if (password !== confirmPassword) {
      setError("As senhas n√£o conferem");
      return;
    }

    setLoading(true);
    setError("");

    try {
      await AuthService.confirmPasswordReset({
        password,
        password2: confirmPassword,
        token: token || "",
        uidb64: uidb64 || ""
      });

      setSuccess("Senha alterada com sucesso!");
      setTimeout(() => {
        navigate('/login');
      }, 2000);
    } catch (error: any) {
      if (error.response && error.response.data) {
        if (typeof error.response.data === 'object') {
          const errorMessages = Object.entries(error.response.data)
            .map(([key, value]) => `${key}: ${Array.isArray(value) ? value.join(", ") : value}`)
            .join("; ");
          setError(errorMessages);
        } else {
          setError("Falha ao redefinir senha. Verifique o link ou tente novamente.");
        }
      } else {
        setError("Erro de conex√£o. Tente novamente mais tarde.");
      }
    } finally {
      setLoading(false);
    }
  };

  const renderEmailScreen = () => (
    <Card className="w-[700px] h-auto rounded-[18px] border-2 border-solid border-black bg-white">
      <CardHeader className="pb-0">
        <CardTitle className="text-[35px] text-center [font-family:'Silkscreen',Helvetica] font-bold">
          ESQUECI A SENHA
        </CardTitle>
      </CardHeader>
      <CardContent className="pt-1 px-[45px]">
        {success && (
          <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
            {success}
          </div>
        )}

        {error && (
          <div className="text-red-500 flex items-center gap-2 mb-4">
            <AlertCircle size={20} />
            <span>{error}</span>
          </div>
        )}

        <form className="space-y-2" onSubmit={handleEmailSubmit}>
          <div className="space-y-2">
            <label
              htmlFor="email"
              className="block [font-family:'Silkscreen',Helvetica] font-bold text-black text-[32px]"
            >
              CONFIRME O EMAIL
            </label>
            <Input
              id="email"
              type="email"
              placeholder="teste@email.com"
              className="h-[55px] rounded-xl border border-solid border-black"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
            />
          </div>

          <div className="flex justify-end pt-4">
            <Button
              type="submit"
              disabled={loading}
              className="w-[274px] h-[53px] bg-[#e3922a] rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[32px] hover:bg-[#e3922a] transform transition-transform duration-300 hover:scale-105"
            >
              {loading ? "ENVIANDO..." : "ENVIAR"}
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  );

  const renderNewPasswordScreen = () => (
    <Card className="w-[700px] h-auto rounded-[18px] border-2 border-solid border-black bg-white">
      <CardHeader className="pb-0">
        <CardTitle className="text-[35px] text-center [font-family:'Silkscreen',Helvetica] font-bold">
          NOVA SENHA
        </CardTitle>
      </CardHeader>
      <CardContent className="pt-1 px-[45px]">
        {success && (
          <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
            {success}
          </div>
        )}

        {error && (
          <div className="text-red-500 flex items-center gap-2 mb-4">
            <AlertCircle size={20} />
            <span>{error}</span>
          </div>
        )}

        <form className="space-y-2" onSubmit={handlePasswordReset}>
          <div className="space-y-2">
            <label
              htmlFor="newPassword"
              className="block [font-family:'Silkscreen',Helvetica] font-bold text-black text-[32px]"
            >
              NOVA SENHA
            </label>
            <Input
              id="newPassword"
              type="password"
              className="h-[55px] rounded-xl border border-solid border-black"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
          </div>

          <div className="space-y-2">
            <label
              htmlFor="confirmPassword"
              className="block [font-family:'Silkscreen',Helvetica] font-bold text-black text-[32px]"
            >
              CONFIRME A SENHA
            </label>
            <Input
              id="confirmPassword"
              type="password"
              className="h-[55px] rounded-xl border border-solid border-black"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
            />
          </div>

          <div className="flex justify-end pt-4">
            <Button
              type="submit"
              disabled={loading}
              className="w-[274px] h-[53px] bg-[#e3922a] rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[32px] hover:bg-[#e3922a] transform transition-transform duration-300 hover:scale-105"
            >
              {loading ? "ENVIANDO..." : "ALTERAR"}
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  );

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(32,2,89,1)_0%,rgba(121,70,213,1)_100%)] relative overflow-hidden">
        {/* Imagens de decora√ß√£o */}
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right"
          alt="Cloud decoration"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration"
          src="/nuvemright.png"
        />

        {/* Bot√µes de navega√ß√£o */}
        <div className="flex gap-5 absolute top-14 left-[33px]">
          <ButtonHomeBack onClick={() => navigate("/login")}><ArrowLeft /></ButtonHomeBack>
          <ButtonHomeBack onClick={() => navigate("/")}><House /></ButtonHomeBack>
        </div>

        {/* Conte√∫do principal */}
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
          {step === 1 ? renderEmailScreen() : renderNewPasswordScreen()}
        </div>
      </div>
    </div>
  );
};

export default ForgotPassword;
</file>

<file path="src/pages/fuel/FuelPage.tsx">
import React, { useState } from 'react';
import { Vehicle } from '../../types/vehicle';
import { useLocation, useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';

export const FuelPage: React.FC = () => {
  const location = useLocation();
  const navigate = useNavigate();

  // Dados recebidos da tela anterior
  const receivedVehicle = location.state?.selectedVehicle || location.state?.vehicle || { id: 'carreta', name: 'Carreta', capacity: 60, consumption: { asphalt: 2, dirt: 1.5 }, image: '/carreta.png', maxCapacity: 495, currentFuel: 0, cost: 4500 };
  
  // Garantir que o ve√≠culo sempre comece com tanque vazio na p√°gina de combust√≠vel
  const vehicle = {
    ...receivedVehicle,
    currentFuel: 0 // Tanque sempre vazio para for√ßar decis√£o do usu√°rio
  };
  
  const availableMoney = location.state?.availableMoney || 5500;
  const selectedRoute = location.state?.selectedRoute;

  // Debug dos dados recebidos
  console.log("=== DEBUG FUEL PAGE ===");
  console.log("Location state:", location.state);
  console.log("Vehicle received:", vehicle);
  console.log("Available money:", availableMoney);
  console.log("Selected route:", selectedRoute);
  console.log("======================");

  const [selectedVehicle] = useState<Vehicle>({ ...vehicle });
  const [fuelAmount, setFuelAmount] = useState<'full' | 'half' | 'quarter'>('full');
  const [availableBalance] = useState(availableMoney);
  const [previewFuel, setPreviewFuel] = useState<number>(vehicle.maxCapacity); // Preview inicia com a op√ß√£o 'full' selecionada

  const fuelCostPerLiter = 5.5;

  const calculateFuelCost = (option: 'full' | 'half' | 'quarter') => {
    const maxCapacity = selectedVehicle.maxCapacity;
    let fuelToAdd = 0;

    // Como o tanque sempre come√ßa vazio, calculamos a quantidade total desejada
    switch (option) {
      case 'full':
        fuelToAdd = maxCapacity;
        break;
      case 'half':
        fuelToAdd = maxCapacity / 2;
        break;
      case 'quarter':
        fuelToAdd = maxCapacity / 4;
        break;
    }

    return fuelToAdd * fuelCostPerLiter;
  };

  const handleRefuel = () => {
    const cost = calculateFuelCost(fuelAmount);

    if (cost <= availableBalance) {
      // Calcular o novo combust√≠vel baseado na op√ß√£o selecionada
      const newCurrentFuel = fuelAmount === 'full'
        ? selectedVehicle.maxCapacity
        : fuelAmount === 'half'
          ? selectedVehicle.maxCapacity / 2
          : selectedVehicle.maxCapacity / 4;

      const updatedVehicle = {
        ...selectedVehicle,
        currentFuel: newCurrentFuel
      };

      const newBalance = availableBalance - cost;

      // Navegar para o jogo 2D com os dados atualizados
      navigate('/game', {
        state: {
          selectedVehicle: updatedVehicle,
          availableMoney: newBalance,
          selectedRoute: selectedRoute
        }
      });
    } else {
      alert('Saldo insuficiente para abastecer!');
    }
  };

  const handleSkipFuel = () => {
    // Navegar para o jogo 2D sem abastecer
    navigate('/game', {
      state: {
        selectedVehicle: selectedVehicle,
        availableMoney: availableBalance,
        selectedRoute: selectedRoute
      }
    });
  };

  const calculatePreviewFuel = (option: 'full' | 'half' | 'quarter'): number => {
    const max = selectedVehicle.maxCapacity;

    switch (option) {
      case 'full':
        return max;
      case 'half':
        return max / 2;
      case 'quarter':
        return max / 4;
      default:
        return 0; // Tanque vazio por padr√£o
    }
  };

  const goBack = () => {
    navigate('/routes');
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-[#200259] to-[#300369] font-['Silkscreen']">
      {/* Header compacto */}
      <div className="bg-[#200259] border-b-4 border-[#E3922A] px-3 py-2 shadow-lg">
        <div className="flex items-center justify-between max-w-7xl mx-auto">
          <button
            className="flex items-center gap-1 px-3 py-1.5 bg-[#E3922A] text-black font-bold text-sm rounded-md shadow-lg
                     hover:bg-[#FFC06F] transition-all duration-200 border-2 border-black"
            onClick={goBack}
          >
            <ArrowLeft size={16} /> VOLTAR
          </button>
          
          <h1 className="text-lg lg:text-xl font-bold text-[#E3922A] text-center flex items-center gap-2">
            ‚õΩ ABASTECIMENTO
          </h1>
          
          <div className="bg-gradient-to-r from-[#E3922A] to-[#FFC06F] text-black text-sm lg:text-base font-bold px-3 py-1.5 rounded-md shadow-lg border-2 border-black">
            R$ {availableBalance.toFixed(2)}
          </div>
        </div>
      </div>

             {/* Conte√∫do principal */}
      <div className="h-[calc(100vh-60px)] max-h-[calc(100vh-60px)] overflow-hidden p-2">
        <div className="bg-gradient-to-br from-gray-900 to-gray-800 rounded-lg shadow-2xl border-2 border-[#E3922A] w-full h-full p-3 backdrop-blur-sm flex flex-col">
          {/* Header compacto da se√ß√£o */}
          <div className="bg-gradient-to-r from-[#E3922A] to-[#FFC06F] text-black p-2 rounded-lg mb-2 border border-black flex-shrink-0">
            <div className="flex items-center justify-between">
              <h2 className="text-sm font-['Silkscreen'] font-bold flex items-center gap-1">
                üöõ ABASTECER VE√çCULO?
              </h2>
              <p className="font-['Silkscreen'] text-xs font-bold flex items-center gap-1">
                üí∞ Saldo final: <span className="text-green-800">R$ {(availableBalance - calculateFuelCost(fuelAmount)).toFixed(2)}</span>
              </p>
            </div>
          </div>

          {/* Layout otimizado sem scroll */}
          <div className="flex-1 min-h-0 flex flex-col">
            {/* Se√ß√£o principal em uma linha */}
            <div className="flex flex-col lg:flex-row gap-4 flex-1 min-h-0">
              
              {/* Card do ve√≠culo elegante */}
              <div className="lg:w-3/5 bg-gradient-to-br from-[#FFC06F] via-[#FFD700] to-[#FFA500] p-4 rounded-xl shadow-xl border-2 border-[#E3922A]">
                <div className="bg-black bg-opacity-10 rounded-lg p-3 h-full flex flex-col">
                  
                  {/* Header do ve√≠culo */}
                  <div className="flex items-center justify-center mb-3">
                    <h3 className="text-lg font-['Silkscreen'] font-bold text-black bg-white bg-opacity-80 px-4 py-2 rounded-full border-2 border-black shadow-md">
                      üöõ {selectedVehicle.name.toUpperCase()}
                    </h3>
                  </div>
                  
                  {/* Layout horizontal com imagem e informa√ß√µes */}
                  <div className="flex gap-4 flex-1">
                    {/* Imagem do ve√≠culo */}
                    <div className="w-2/5 flex items-center justify-center bg-white bg-opacity-30 rounded-lg p-3 shadow-inner">
                      <img
                        src={selectedVehicle.image}
                        alt={selectedVehicle.name}
                        className="max-h-20 lg:max-h-24 object-contain filter drop-shadow-lg"
                      />
                    </div>
                    
                    {/* Informa√ß√µes t√©cnicas */}
                    <div className="w-3/5 space-y-3">
                      <div className="grid grid-cols-2 gap-3">
                        {/* Consumo */}
                        <div className="bg-green-500 bg-opacity-20 p-2 rounded-lg border border-green-600">
                          <h4 className="font-['Silkscreen'] text-sm font-bold text-green-900 mb-1 text-center">‚õΩ CONSUMO</h4>
                          <p className="text-xs text-green-800 text-center">üõ£Ô∏è {selectedVehicle.consumption.asphalt} KM/L</p>
                          <p className="text-xs text-green-800 text-center">üåÑ {selectedVehicle.consumption.dirt} KM/L</p>
                        </div>
                        
                        {/* Capacidade */}
                        <div className="bg-blue-500 bg-opacity-20 p-2 rounded-lg border border-blue-600">
                          <h4 className="font-['Silkscreen'] text-sm font-bold text-blue-900 mb-1 text-center">üóúÔ∏è TANQUE</h4>
                          <p className="text-xs text-blue-800 text-center">üìä 0L</p>
                          <p className="text-xs text-blue-800 text-center">üèÅ {selectedVehicle.maxCapacity}L</p>
                        </div>
                      </div>

                      {/* Barra de combust√≠vel melhorada */}
                      <div className="bg-white bg-opacity-40 p-2 rounded-lg">
                        <div className="flex justify-between items-center mb-2">
                          <p className="font-['Silkscreen'] text-black text-sm font-bold">‚õΩ N√çVEL DO TANQUE</p>
                          <p className="text-sm font-bold text-black">0L ‚Üí {previewFuel.toFixed(0)}L / {selectedVehicle.maxCapacity}L</p>
                        </div>
                        
                        <div className="w-full bg-gray-200 rounded-full h-5 border-2 border-black relative overflow-hidden shadow-inner">
                          {/* Barra vazia (fundo branco quando n√£o h√° combust√≠vel) */}
                          <div className="w-full h-full bg-white rounded-full"></div>
                          
                          {/* Barra de preview - quantidade que ser√° abastecida (verde) */}
                          <div
                            className="bg-gradient-to-r from-green-400 via-green-500 to-green-600 h-full absolute top-0 left-0 transition-all duration-700 ease-out"
                            style={{ width: `${(previewFuel / selectedVehicle.maxCapacity) * 100}%` }}
                          ></div>
                          
                          {/* Marcadores de divis√£o */}
                          <div className="absolute inset-0 flex justify-between items-center px-2">
                            <div className="w-0.5 h-3 bg-gray-600 opacity-50"></div>
                            <div className="w-0.5 h-3 bg-gray-600 opacity-50"></div>
                            <div className="w-0.5 h-3 bg-gray-600 opacity-50"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Painel de abastecimento */}
              <div className="lg:w-2/5 bg-gradient-to-br from-orange-400 via-orange-500 to-red-500 p-4 rounded-xl shadow-xl border-2 border-orange-600">
                <div className="bg-white bg-opacity-10 rounded-lg p-3 h-full flex flex-col">
                  
                  {/* Header */}
                  <div className="text-center mb-3">
                    <h4 className="font-['Silkscreen'] text-lg font-bold text-white bg-black bg-opacity-30 px-3 py-2 rounded-lg border border-white">
                      ‚õΩ POSTO DE COMBUST√çVEL
                    </h4>
                  </div>
                  
                  {/* Pre√ßo em destaque */}
                  <div className="bg-red-600 text-white p-3 rounded-lg mb-3 text-center border-2 border-red-800 shadow-md">
                    <p className="font-['Silkscreen'] text-sm font-bold">
                      üíµ DIESEL: R$ {fuelCostPerLiter.toFixed(2)}/LITRO
                    </p>
                  </div>

                  {/* Op√ß√µes de abastecimento */}
                  <div className="space-y-2 mb-3">
                    <p className="font-['Silkscreen'] text-white text-sm font-bold text-center">ESCOLHA A QUANTIDADE:</p>
                    <div className="grid grid-cols-3 gap-2">
                      <button
                        onClick={() => {
                          const newPreview = calculatePreviewFuel('quarter');
                          setFuelAmount('quarter');
                          setPreviewFuel(newPreview);
                        }}
                        className={`py-2 px-2 border-2 rounded-lg font-bold text-sm transition-all duration-200 ${
                          fuelAmount === 'quarter' 
                            ? 'bg-[#E3922A] text-black border-black shadow-lg transform scale-105' 
                            : 'bg-white text-gray-800 border-gray-300 hover:bg-gray-100'
                        }`}
                      >
                        1/4 TANQUE
                      </button>
                      <button
                        onClick={() => {
                          const newPreview = calculatePreviewFuel('half');
                          setFuelAmount('half');
                          setPreviewFuel(newPreview);
                        }}
                        className={`py-2 px-2 border-2 rounded-lg font-bold text-sm transition-all duration-200 ${
                          fuelAmount === 'half' 
                            ? 'bg-[#E3922A] text-black border-black shadow-lg transform scale-105' 
                            : 'bg-white text-gray-800 border-gray-300 hover:bg-gray-100'
                        }`}
                      >
                        1/2 TANQUE
                      </button>
                      <button
                        onClick={() => {
                          const newPreview = calculatePreviewFuel('full');
                          setFuelAmount('full');
                          setPreviewFuel(newPreview);
                        }}
                        className={`py-2 px-2 border-2 rounded-lg font-bold text-sm transition-all duration-200 ${
                          fuelAmount === 'full' 
                            ? 'bg-[#E3922A] text-black border-black shadow-lg transform scale-105' 
                            : 'bg-white text-gray-800 border-gray-300 hover:bg-gray-100'
                        }`}
                      >
                        TANQUE CHEIO
                      </button>
                    </div>
                  </div>

                  {/* Custo total em destaque */}
                  <div className="bg-green-600 text-white p-3 rounded-lg text-center border-2 border-green-800 shadow-md mt-auto">
                    <p className="font-['Silkscreen'] text-lg font-bold">
                      üí∞ TOTAL: R$ {calculateFuelCost(fuelAmount).toFixed(2)}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            {/* Bot√µes de a√ß√£o elegantes */}
            <div className="flex justify-center gap-4 mt-4 flex-shrink-0">
              <button
                onClick={handleSkipFuel}
                className="bg-gradient-to-r from-gray-700 via-gray-800 to-gray-900 text-white font-bold py-3 px-8 rounded-xl shadow-xl border-2 border-gray-600 
                         hover:from-gray-600 hover:via-gray-700 hover:to-gray-800 transition-all duration-200 transform hover:scale-105 flex items-center gap-2"
              >
                ‚è≠Ô∏è PULAR ABASTECIMENTO
              </button>
              <button
                onClick={handleRefuel}
                disabled={calculateFuelCost(fuelAmount) > availableBalance}
                className={`font-bold py-3 px-8 rounded-xl shadow-xl border-2 transition-all duration-200 transform hover:scale-105 flex items-center gap-2 ${
                  calculateFuelCost(fuelAmount) > availableBalance 
                    ? 'bg-gray-400 text-gray-600 cursor-not-allowed border-gray-500' 
                    : 'bg-gradient-to-r from-[#E3922A] via-[#FFC06F] to-[#FFD700] text-black border-[#E3922A] hover:from-[#FFC06F] hover:via-[#FFD700] hover:to-[#FFED4E]'
                }`}
              >
                ‚õΩ ABASTECER AGORA
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
      );
};
</file>

<file path="src/pages/Game-truck/GameMiniMap.tsx">
import React, { useEffect, useMemo, useRef } from 'react';
import { MapContainer, TileLayer, Polyline, Marker, useMap } from 'react-leaflet';
import 'leaflet/dist/leaflet.css';
import L from 'leaflet';
import { Vehicle } from '../../types/vehicle';

// Configura√ß√£o do √≠cone padr√£o do Leaflet
import defaultIcon from 'leaflet/dist/images/marker-icon.png';
import iconShadow from 'leaflet/dist/images/marker-shadow.png';

let DefaultIcon = L.icon({
  iconUrl: defaultIcon,
  shadowUrl: iconShadow,
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34]
});
L.Marker.prototype.options.icon = DefaultIcon;

interface GameMiniMapProps {
  pathCoordinates: [number, number][];
  currentPathIndex: number;
  pathProgress: number; // 0-1 progresso dentro do segmento atual
  vehicle: Vehicle;
  progress: number; // Progresso total em porcentagem
  className?: string;
}

// Componente para atualizar a posi√ß√£o do caminh√£o
const TruckMarker: React.FC<{
  pathCoordinates: [number, number][];
  currentPathIndex: number;
  pathProgress: number;
  vehicle: Vehicle;
}> = ({ pathCoordinates, currentPathIndex, pathProgress, vehicle }) => {
  const markerRef = useRef<L.Marker>(null);

  // √çcone personalizado do ve√≠culo
  const vehicleIcon = useMemo(() => {
    // Converter URL da imagem para uso no mapa
    let imageUrl = vehicle.image;
    if (imageUrl.startsWith('/src/assets/')) {
      imageUrl = imageUrl.replace('/src/assets/', '/assets/');
    }
    if (!imageUrl.startsWith('/assets/') && !imageUrl.startsWith('http')) {
      imageUrl = `/assets/${imageUrl.split('/').pop()}`;
    }

    return L.icon({
      iconUrl: imageUrl,
      iconSize: [30, 30],
      iconAnchor: [15, 15],
      popupAnchor: [0, -15]
    });
  }, [vehicle.image]);

  // Calcular posi√ß√£o atual do caminh√£o
  const currentPosition = useMemo(() => {
    if (!pathCoordinates || pathCoordinates.length < 2) {
      return pathCoordinates?.[0] || [0, 0];
    }

    const totalSegments = pathCoordinates.length - 1;
    
    // Garantir que o √≠ndice esteja dentro dos limites
    const segmentIndex = Math.min(currentPathIndex, totalSegments - 1);
    const nextIndex = Math.min(segmentIndex + 1, totalSegments);
    
    const startPoint = pathCoordinates[segmentIndex];
    const endPoint = pathCoordinates[nextIndex];
    
    // Interpolar entre os dois pontos
    const lat = startPoint[0] + (endPoint[0] - startPoint[0]) * pathProgress;
    const lng = startPoint[1] + (endPoint[1] - startPoint[1]) * pathProgress;
    
    return [lat, lng] as [number, number];
  }, [pathCoordinates, currentPathIndex, pathProgress]);

  return (
    <Marker
      position={currentPosition}
      icon={vehicleIcon}
      ref={markerRef}
    />
  );
};

// Componente para ajustar automaticamente o zoom do mapa
const MapViewAdjuster: React.FC<{ pathCoordinates: [number, number][] }> = ({ pathCoordinates }) => {
  const map = useMap();

  useEffect(() => {
    if (pathCoordinates && pathCoordinates.length > 1) {
      const bounds = L.latLngBounds(pathCoordinates);
      map.fitBounds(bounds, { padding: [10, 10] });
    }
  }, [map, pathCoordinates]);

  return null;
};

export const GameMiniMap: React.FC<GameMiniMapProps> = ({
  pathCoordinates,
  currentPathIndex,
  pathProgress,
  vehicle,
  progress,
  className = ""
}) => {
  // Se n√£o h√° coordenadas da rota, n√£o renderizar o mapa
  if (!pathCoordinates || pathCoordinates.length < 2) {
    return (
      <div className={`${className} flex items-center justify-center bg-gray-800 text-white text-sm`}>
        <div className="text-center">
          <div>üìç Mapa</div>
          <div>Indispon√≠vel</div>
        </div>
      </div>
    );
  }

  // Coordenadas de in√≠cio e fim
  const startCoord = pathCoordinates[0];
  const endCoord = pathCoordinates[pathCoordinates.length - 1];

  return (
    <div className={className} style={{ position: 'relative' }}>
      {/* Overlay com informa√ß√µes */}
      {/* <div style={{
        position: 'absolute',
        top: '5px',
        left: '5px',
        right: '5px',
        zIndex: 1000,
        backgroundColor: 'rgba(0, 0, 0, 0.7)',
        color: 'white',
        padding: '4px 8px',
        borderRadius: '4px',
        fontSize: '11px',
        textAlign: 'center'
      }}>
        <div>{progress.toFixed(1)}% Conclu√≠do</div>
      </div> */}

      <MapContainer
        center={startCoord}
        zoom={10}
        scrollWheelZoom={false}
        zoomControl={false}
        attributionControl={false}
        dragging={false}
        style={{ width: '100%', height: '100%', borderRadius: '50%' }}
      >
        <TileLayer
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        />
        
        {/* Ajustar visualiza√ß√£o automaticamente */}
        <MapViewAdjuster pathCoordinates={pathCoordinates} />
        
        {/* Desenhar a rota completa */}
        <Polyline
          positions={pathCoordinates}
          pathOptions={{
            color: '#0077cc',
            weight: 4,
            opacity: 0.7
          }}
        />
        
        {/* Parte da rota j√° percorrida */}
        {currentPathIndex > 0 && (
          <Polyline
            positions={pathCoordinates.slice(0, currentPathIndex + 1)}
            pathOptions={{
              color: '#00cc66',
              weight: 5,
              opacity: 0.9
            }}
          />
        )}
        
        {/* Marcadores de in√≠cio e fim */}
        <Marker
          position={startCoord}
          icon={L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
          })}
        />
        
        <Marker
          position={endCoord}
          icon={L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684879.png',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
          })}
        />
        
        {/* Caminh√£o na posi√ß√£o atual */}
        <TruckMarker
          pathCoordinates={pathCoordinates}
          currentPathIndex={currentPathIndex}
          pathProgress={pathProgress}
          vehicle={vehicle}
        />
      </MapContainer>
    </div>
  );
};
</file>

<file path="src/pages/Home/HomePage.tsx">
import { ArrowRightIcon } from "lucide-react";
import { useNavigate } from "react-router-dom";
import { Button } from "../../components/ui/button";
import { Card, CardContent } from "../../components/ui/card";
import { Separator } from "../../components/ui/separator";

export const HomePage = () => {
  const navigate = useNavigate();

  const handleLogin = () => {
    navigate("/Login");
  };
  const handleCadastro = () => {
    navigate("/Cadastro");
  };


  return (
    <div className="bg-white flex flex-row justify-center w-full ">
      <div className="bg-white py-5 [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] w-full min-h-screen relative flex flex-col items-center justify-center">
        <Card className="w-[1039px] h-[455px] relative border-[3px] border-solid border-black rounded">
          <CardContent className="p-0 flex h-full">
            {/* Left purple section */}
            <div className="w-[512px] h-full bg-[#561c86] rounded border-r-[3px] border-solid border-black flex flex-col items-center px-12 py-5">
              <h1 className="[font-family:'Silkscreen',Helvetica] font-bold text-white text-[40px] text-center mt-3">
                Jogos Logisticos
              </h1>

              <Card className="w-full h-[202px] mt-8 border-[3px] border-solid border-black flex items-center justify-center bg-[#ffffff]">
                <CardContent className="p-0 flex items-center justify-center h-full">
                  <img
                    className="w-[45%] object-cover"
                    alt="Game logo"
                    src="/Logoifba.png"
                  />
                </CardContent>
              </Card>

              <p className="[font-family:'Silkscreen',Helvetica] font-normal text-white text-[15px] mt-3 text-center">
                Gerencie sua frota de caminh√µes, escolha
                <br />
                as melhores rotas e fa√ßa entregas com efici√™ncia.
              </p>

            
            </div>

            {/* Right section */}
            <div className="flex-1 flex flex-col items-center px-10">
              <h2 className="[text-shadow:2px_3px_0.6px_#000000] [-webkit-text-stroke:1px_#000000] [font-family:'Silkscreen',Helvetica] font-bold text-[#ff8c00e3] text-[40px] text-center mt-5">
                Bem-vindo!
              </h2>

              <div className="w-full mt-16">
                <Button 
                onClick={handleLogin}
                className="w-full h-[58px] bg-[#ffd700] hover:bg-[#e6c200] text-[#1c1a1a] border border-solid border-black rounded-[3px] relative">
                  <span className="[font-family:'Silkscreen',Helvetica] font-bold text-2xl absolute left-1/2 transform -translate-x-1/2">
                    Entrar
                  </span>
                  <ArrowRightIcon className="absolute right-6 w-6 h-[21px]" />
                </Button>
              </div>

              <div className="w-full mt-5 flex items-center justify-center">
                <div className="[font-family:'Signika',Helvetica] font-bold text-[#8d8c8c] text-2xl">
                  <Separator className="inline-block w-[160px] h-px bg-[#8d8c8c]" />
                  <span className="mx-2">OU</span>
                  <Separator className="inline-block w-[160px] h-px bg-[#8d8c8c]" />
                </div>
              </div>

              <div className="w-full mt-10">
                <Button
                 onClick={handleCadastro}
                className="w-full h-[58px] bg-[#16bd81] hover:bg-[#14a974] text-[#1c1a1a] border border-solid border-black rounded-[3px] relative">
                  <span className="[font-family:'Silkscreen',Helvetica] font-bold text-2xl absolute left-1/2 transform -translate-x-1/2">
                    Cadastrar
                  </span>
                  <ArrowRightIcon className="absolute right-6 w-6 h-[21px]" />
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>

        <footer className="mt-5 mb-10">
          <p className="[font-family:'Silkscreen',Helvetica] font-bold text-white text-[15px] text-center">
            ¬© 2025 Jogos Log√≠sticos - Todos os direitos reservados
          </p>
        </footer>
      </div>
    </div>
  );
};
</file>

<file path="src/pages/Home/index.ts">
export { HomePage } from "./HomePage";
</file>

<file path="src/pages/PauseMenu/PauseMenu.tsx">
import { useNavigate } from "react-router-dom";
import { 
  Play, 
  User, 
  RotateCcw
} from 'lucide-react';

interface PauseMenuProps {
  isVisible: boolean;
  onResume: () => void;
  onGoToProfile?: () => void;
  onRestart?: () => void;
}

export const PauseMenu = ({ 
  isVisible, 
  onResume,
  onGoToProfile,
  onRestart
}: PauseMenuProps) => {
  const navigate = useNavigate();

  if (!isVisible) return null;

  const handleGoToProfile = () => {
    if (onGoToProfile) {
      onGoToProfile();
    } else {
      navigate("/perfil");
    }
  };

  const silkscreenFont = "[font-family:'Silkscreen',Helvetica]";
  const titleStyle = {
    color: "#E3922A",
    textShadow: "2px 3px 0.6px #000"
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]">
      <div className="w-full h-full [background:linear-gradient(180deg,rgba(57,189,248,0.9)_0%,rgba(154,102,248,0.9)_100%)] relative overflow-hidden flex items-center justify-center">
        
        {}
        <img
          className="w-[300px] h-[120px] absolute top-[100px] left-[50px] object-cover animate-float-right opacity-40"
          alt="Cloud decoration"
          src="/nuvemleft.png"
        />
        <img
          className="w-[350px] h-[140px] absolute bottom-[50px] right-[50px] object-cover animate-float-left opacity-40"
          alt="Cloud decoration"
          src="/nuvemright.png"
        />

        {/* Menu principal */}
        <div className="border-4 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] max-w-md w-full mx-4 relative z-10">
          <div className="p-6">
            
            {/* T√≠tulo */}
            <div className="text-center mb-6">
              <h1 className={`${silkscreenFont} text-3xl font-bold`} style={titleStyle}>
                JOGO PAUSADO
              </h1>
              <div className="w-full h-1 bg-black mt-2"></div>
            </div>

            {/* Bot√µes principais */}
            <div className="space-y-4">
              
              {/* Continuar Jogo */}
              <button
                onClick={onResume}
                className={`${silkscreenFont} w-full py-4 text-lg font-bold bg-green-500 hover:bg-green-600 text-white border-2 border-black rounded-md shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] transition-all flex items-center justify-center`}
              >
                <Play size={20} className="mr-2" />
                CONTINUAR
              </button>

              {/* Grid de op√ß√µes */}
              <div className="grid grid-cols-2 gap-4">
                
                {/* Perfil */}
                <button
                  onClick={handleGoToProfile}
                  className={`${silkscreenFont} py-4 text-sm font-bold bg-blue-500 hover:bg-blue-600 text-white border-2 border-black rounded-md shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] transition-all flex flex-col items-center`}
                >
                  <User size={20} className="mb-1" />
                  PERFIL
                </button>

                {/* Reiniciar */}
                {onRestart && (
                  <button
                    onClick={onRestart}
                    className={`${silkscreenFont} py-4 text-sm font-bold bg-orange-500 hover:bg-orange-600 text-white border-2 border-black rounded-md shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] transition-all flex flex-col items-center`}
                  >
                    <RotateCcw size={20} className="mb-1" />
                    REINICIAR
                  </button>
                )}
              </div>
            </div>

            {/* Dica */}
            <div className="text-center mt-6">
              <p className={`${silkscreenFont} text-xs text-gray-600`}>
                Pressione ESC para pausar/despausar
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PauseMenu;
</file>

<file path="src/styles/pixelArt.css">
/* Pixel Art Styling */
@font-face {
  font-family: 'PixelFont';
  src: url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  font-display: swap;
}

.font-pixel {
  font-family: 'Press Start 2P', monospace;
  letter-spacing: 1px;
  line-height: 1.5;
}

/* Custom utility classes */
.hover\:scale-102:hover {
  transform: scale(1.02);
}

/* Transitions */
.transition-all {
  transition: all 0.3s ease;
}
</file>

<file path="src/types/vehicle.ts">
// Defini√ß√£o do tipo de ve√≠culo
export interface Vehicle {
  id: string;
  name: string;
  capacity: number;
  consumption: {
    asphalt: number;
    dirt: number;
  };
  image: string;
  maxCapacity: number;
  currentFuel: number;
  cost: number; // Custo do aluguel + motorista
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "composite": true,
    "allowSyntheticDefaultImports": true,
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": false,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="Dockerfile">
# Usa a imagem oficial do Node.js
FROM node:23-alpine3.20

# Define o diret√≥rio de trabalho dentro do container
WORKDIR /app


# Copia os arquivos de configura√ß√£o do projeto
COPY package*.json ./
COPY vite.config.ts ./

# Instala as depend√™ncias
RUN npm install

# # Copia o restante dos arquivos do projeto
COPY . .

# # Exp√µe a porta que o Vite usa por padr√£o
EXPOSE 5173

# # Comando para iniciar o servidor de desenvolvimento
CMD ["npm", "run", "dev"]
</file>

<file path="src/api/authService.ts">
import api from './config';

// Interface para login
interface LoginCredentials {
  username: string;
  password: string;
}

// Interface para resposta do token
interface TokenResponse {
  access: string;
  refresh: string;
}

// Interface para registro
interface RegisterData {
  username: string;
  email: string;
  password: string;
  password2: string;  // Confirma√ß√£o de senha
  nickname: string;
  first_name?: string;
  last_name?: string;
  data_nascimento?: string;
}

// Interface para atualiza√ß√£o de perfil
interface UpdateProfileData {
  email?: string;
  first_name?: string;
  last_name?: string;
  data_nascimento?: string;
}

// Interface para solicita√ß√£o de redefini√ß√£o de senha
interface PasswordResetRequest {
  email: string;
}

// Interface para confirma√ß√£o de redefini√ß√£o de senha
interface PasswordResetConfirm {
  password: string;
  password2: string;
  token: string;
  uidb64: string;
}

export const AuthService = {
  // Login do usu√°rio
  async login(credentials: LoginCredentials): Promise<TokenResponse> {
    const response = await api.post<TokenResponse>('/auth/token/', credentials);

    // Armazena os tokens no localStorage
    localStorage.setItem('token', response.data.access);
    localStorage.setItem('refreshToken', response.data.refresh);

    return response.data;
  },

  // Registro de novo usu√°rio
  async register(userData: RegisterData) {
    return await api.post('/auth/registro/', userData);
  },

  // Logout do usu√°rio
  logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('refreshToken');
  },

  // Verifica se o usu√°rio est√° autenticado
  isAuthenticated(): boolean {
    return !!localStorage.getItem('token');
  },

  // Obter perfil do usu√°rio
  async getProfile() {
    return await api.get('/auth/perfil/');
  },

  // Atualizar perfil do usu√°rio - CORRIGIDO: PATCH em vez de PUT
  async updateProfile(userData: UpdateProfileData) {
    return await api.patch('/auth/perfil/', userData);
  },

  // Solicitar redefini√ß√£o de senha
  async requestPasswordReset(data: PasswordResetRequest) {
    return await api.post('/auth/password-reset/', data);
  },

  // Confirmar redefini√ß√£o de senha
  async confirmPasswordReset(data: PasswordResetConfirm) {
    return await api.post('/auth/password-reset/confirm/', data);
  }
};

export default AuthService;
</file>

<file path="src/api/gameService.ts">
// src/api/gameService.ts
import api from './config';
import { Map } from '../types';

interface EventResponse {
  id: number;
  partida: number;
  evento: {
    id: number;
    nome: string;
    descricao: string;
    tipo: 'positivo' | 'negativo';
    chance_base: number;
    opcoes: Array<{
      id: number;
      descricao: string;
      efeitos: any;
    }>;
  };
  momento: string;
  ordem: number;
  opcao_escolhida: null;
}

interface PartidaResponse {
  id: number;
  saldo: number;
  combustivel_atual: number;
  quantidade_carga: number;
  condicao_veiculo: number;
  estresse_motorista: number;
  tempo_real: number;
  pontuacao: number;
  distancia_percorrida: number;
}

interface RespondResponse {
  detail: string;
  partida: PartidaResponse;
}

export const GameService = {
  async getMaps(): Promise<Map[]> {
    const response = await api.get('/jogo1/mapas/');
    return response.data;
  },

  async getVehicles(): Promise<any[]> {
    const response = await api.get('/jogo1/veiculos/');
    return response.data;
  },

  async getNextEvent(): Promise<EventResponse> {
    const response = await api.get<EventResponse>('/jogo1/proximo-evento/');
    return response.data;
  },

  async respondToEvent(optionId: number): Promise<RespondResponse> {
    const response = await api.post<RespondResponse>('/jogo1/eventos/responder/', {
      opcao_id: optionId
    });
    return response.data;
  },

  async getActiveGame(): Promise<PartidaResponse> {
    const response = await api.get<PartidaResponse>('/jogo1/partidas/ativa/');
    return response.data;
  },

  async createGame(gameData: { mapa: number; rota: number; veiculo: number }): Promise<PartidaResponse> {
    const response = await api.post<PartidaResponse>('/jogo1/partidas/', gameData);
    return response.data;
  },

  async pauseGame(): Promise<{ detail: string }> {
    const response = await api.post<{ detail: string }>('/jogo1/partidas/pausar/');
    return response.data;
  },

  async resumeGame(): Promise<{ detail: string }> {
    const response = await api.post<{ detail: string }>('/jogo1/partidas/continuar/');
    return response.data;
  },

  async syncGameProgress(progressData: { tempo_decorrido_segundos: number }): Promise<PartidaResponse> {
    const response = await api.post<PartidaResponse>('/jogo1/partidas/sincronizar/', progressData);
    return response.data;
  }
};
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { HomePage } from './pages/Home';
import { VehicleSelectionPage } from './pages/escolherVeiculo';
import { RoutesPage } from './pages/RoutesPage/RoutesPage';
import { FuelPage } from './pages/fuel/FuelPage';
import { MapComponent } from './pages/mapaRota/MapComponent';
import { GameScene } from './pages/Game-truck/game';
import './App.css';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/select-vehicle" element={<VehicleSelectionPage />} />
        <Route path="/routes" element={<RoutesPage />} />
        <Route path="/fuel" element={<FuelPage />} />
        <Route path="/map" element={<MapComponent />} />
        <Route path="/mapa-rota" element={<MapComponent />} />
        <Route path="/game" element={<GameScene />} />
        {/* Redirecionar para a p√°gina inicial por padr√£o */}
        <Route path="*" element={<Navigate to="/" replace />} />
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/components/ButtonHomeBack.tsx">
import { ReactNode } from 'react';

interface ButtonHomeBackProps {
    onClick: () => void;
    children: ReactNode;  
}
/// <button onClick={() => navigate(-1)} className="w-10 h-10 bg-white rounded-md items-center justify-center  flex text-black" ><div className="justify-self-center"><ArrowLeft size={25} /></div></button>
export const ButtonHomeBack = ({ 
  onClick, 
  children
}: ButtonHomeBackProps) => {
  return (
    <button 
      onClick={onClick}
      type="button"
      className="flex items-center justify-center w-14 h-14 bg-white border-2 border-black hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-all hover:-translate-x-[2px] hover:-translate-y-[2px]"
      aria-label="Voltar para p√°gina anterior"
    >
        <div className="justify-self-center"> 
            {children}
        </div>
    </button>
  );
};
</file>

<file path="src/components/Cloud.tsx">
import React from 'react';

interface CloudProps {
  className?: string;
  position: string;
}
// Essas nuvens s√£o usadas para criar um efeito visual de nuvens pixeladas no fundo do jogo. 
// s√£o menores e mais simples que as nuvens do jogo, mas nao exclui a possibilidade de serem usadas no jogo, mas atualmente 
//eelas n√£o est√£o sendo utilizadas.

const Cloud: React.FC<CloudProps> = ({ className, position }) => {
  return (
    <div className={`pixel-cloud ${position} ${className}`}>
      <svg width="120" height="60" viewBox="0 0 120 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="20" y="20" width="20" height="20" fill="#B8B5FF" />
        <rect x="40" y="20" width="20" height="20" fill="#B8B5FF" />
        <rect x="60" y="20" width="20" height="20" fill="#B8B5FF" />
        <rect x="0" y="40" width="20" height="20" fill="#B8B5FF" />
        <rect x="20" y="40" width="20" height="20" fill="#B8B5FF" />
        <rect x="40" y="40" width="20" height="20" fill="#B8B5FF" />
        <rect x="60" y="40" width="20" height="20" fill="#B8B5FF" />
        <rect x="80" y="40" width="20" height="20" fill="#B8B5FF" />
        <rect x="100" y="40" width="20" height="20" fill="#B8B5FF" />
      </svg>
    </div>
  );
};

export default Cloud;
</file>

<file path="src/components/ProtectedRoute.tsx">
import { Navigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { ReactNode } from 'react';

interface ProtectedRouteProps {
  children: ReactNode;
  redirectTo?: string;
}

export const ProtectedRoute: React.FC<ProtectedRouteProps> = ({
  children,
  redirectTo = '/login'
}) => {
  const { isAuthenticated, loading } = useAuth();

  // Se ainda estiver carregando, mostra um indicador de carregamento
  if (loading) {
    return (
      <div className="flex h-screen items-center justify-center bg-gradient-to-b from-sky-300 to-purple-400">
        <div className="text-center">
          <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-black mx-auto mb-4"></div>
          <p className="[font-family:'Silkscreen',Helvetica] text-black text-lg">CARREGANDO...</p>
        </div>
      </div>
    );
  }

  // Se n√£o estiver autenticado, redireciona para o login
  if (!isAuthenticated) {
    return <Navigate to={redirectTo} replace />;
  }

  // Se estiver autenticado, renderiza os componentes filhos
  return <>{children}</>;
};

export default ProtectedRoute;
</file>

<file path="src/components/TeamCard.tsx">
import React from 'react';
import { Team } from '../types';
import { Users, Trophy, Truck, ListChecks } from 'lucide-react';
import clsx from 'clsx';

interface TeamCardProps {
  team: Team;
  onClick?: () => void;
  selected?: boolean;
}

const TeamCard = ({ team, onClick, selected }: TeamCardProps) => {
  return (
    <div 
      className={clsx(
        'p-4 border-2 border-black transition-all cursor-pointer bg-white',
        'hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]',
        'hover:-translate-x-[2px] hover:-translate-y-[2px]',
        selected ? 'ring-4 ring-yellow-400' : ''
      )}
      onClick={onClick}
    >
      
      <div className="flex items-start">
        {/* Main Team Info */}
        <div className="flex items-start space-x-4">
          <div className="w-16 h-16 bg-gray-300 border-2 border-black"></div>
          <div className="flex-1">
            <h3 className="font-pixel text-xl font-bold">{team.nome}</h3>
            <div className="flex space-x-4 mt-2">
              <div className="flex items-center space-x-1">
                <Users size={18} />
                <span className="font-pixel">{team.stats.people}</span>
              </div>
              
              <div className="flex items-center space-x-1">
                <Trophy size={18} />
                <span className="font-pixel">{team.stats.trophy}</span>
              </div>
              
              {team.stats.trucks && (
                <div className="flex items-center space-x-1">
                  <Truck size={18} />
                  <span className="font-pixel">{team.stats.trucks}</span>
                </div>
              )}
              
              {team.stats.tasks && (
                <div className="flex items-center space-x-1">
                  <ListChecks size={18} />
                  <span className="font-pixel">{team.stats.tasks}</span>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* History Cards */}
        {team.history && (
          <div className="flex ml-auto gap-2 w-[850px]">
            {team.history.map((historyItem) => (
              <div
                key={historyItem.id}
                className={clsx(
                  'p-2 border-2 border-black flex-1',
                  historyItem.color
                )}
              >
                <h4 className="font-pixel text-sm font-bold mb-2">{historyItem.name}</h4>
                <div className="flex flex-wrap gap-2">
                  <div className="flex items-center space-x-1">
                    <Users size={14} />
                    <span className="font-pixel text-sm">{historyItem.stats.people}</span>
                  </div>
                  <div className="flex items-center space-x-1">
                    <Trophy size={14} />
                    <span className="font-pixel text-sm">{historyItem.stats.trophy}</span>
                  </div>
                  {historyItem.stats.tasks && (
                    <div className="flex items-center space-x-1">
                      <ListChecks size={14} />
                      <span className="font-pixel text-sm">{historyItem.stats.tasks}</span>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};

export default TeamCard;
</file>

<file path="src/contexts/AuthContext.tsx">
import React, { createContext, useState, useEffect, useContext, ReactNode } from 'react';
import AuthService from '../api/authService';

interface User {
  id: number;
  username: string;
  email: string;
  nickname: string;
  first_name?: string;
  last_name?: string;
  data_nascimento?: string;
  equipe?: number; // ID da equipe, pode ser null
}

interface AuthContextType {
  user: User | null;
  loading: boolean;
  isAuthenticated: boolean;
  login: (username: string, password: string) => Promise<void>;
  logout: () => void;
  refreshUser: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType>({
  user: null,
  loading: true,
  isAuthenticated: false,
  login: async () => { },
  logout: () => { },
  refreshUser: async () => { },
});

export const useAuth = () => useContext(AuthContext);

interface AuthProviderProps {
  children: ReactNode;
}

export const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  // Carrega o usu√°rio quando o componente √© montado
  useEffect(() => {
    const loadUser = async () => {
      if (AuthService.isAuthenticated()) {
        try {
          await refreshUser();
        } catch (error) {
          console.error("Erro ao carregar usu√°rio:", error);
          // Se houver erro, limpa os tokens
          AuthService.logout();
        }
      }
      setLoading(false);
    };

    loadUser();
  }, []);

  const refreshUser = async () => {
    try {
      const response = await AuthService.getProfile();
      setUser(response.data);
    } catch (error) {
      console.error("Erro ao obter perfil do usu√°rio:", error);
      throw error;
    }
  };

  const login = async (username: string, password: string) => {
    await AuthService.login({ username, password });
    await refreshUser();
  };

  const logout = () => {
    AuthService.logout();
    setUser(null);
  };

  return (
    <AuthContext.Provider
      value={{
        user,
        loading,
        isAuthenticated: !!user,
        login,
        logout,
        refreshUser,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
};

export default AuthContext;
</file>

<file path="src/index.css">
@import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;


:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}

@layer base {
  html {
    font-family: 'Silkscreen', sans-serif;
    font-family: 'Press Start 2P', cursive;
  }
  body {
    @apply antialiased;
    image-rendering: pixelated;
  }
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 3.9%;
    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 98%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 3.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
  }
  .dark {
    --background: 0 0% 3.9%;
    --foreground: 0 0% 98%;
    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
}
/* Estilos para o mapa Leaflet */
.leaflet-container {
  /* A largura e altura ser√£o controladas pelo Tailwind no MapComponent.tsx */
  /* Remove width: 100%; height: 500px; daqui para usar as classes Tailwind */
}

/* Opcional: Estilos para o popup do Leaflet se quiser mais controle */
.leaflet-popup-content-wrapper {
  border-radius: 0.5rem; /* Arredonda as bordas do popup */
}
.leaflet-popup-content {
  margin: 0; /* Remove margem padr√£o */
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
  @layer components {
  .pixel-border {
    box-shadow: 
      0 0 0 2px #fff,
      0 0 0 4px #000;
  }
  
  .pixel-button {
    @apply relative bg-amber-500 px-6 py-3 font-pixel 
    text-black font-bold border-2 border-black 
    transition-all duration-150 
    hover:brightness-110 active:brightness-90
    hover:-translate-y-1 active:translate-y-0;
  }
  
  .pixel-card {
    @apply bg-white border-2 border-black p-4 transition-all
    hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
    hover:-translate-x-[2px] hover:-translate-y-[2px];
  }
  
  .pixel-cloud {
    @apply absolute opacity-75 animate-float;
  }
  
  .pixelated {
    image-rendering: pixelated;
  }
}
</file>

<file path="src/pages/auth/Cadastro/Cadastro.tsx">
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { Button } from "../../../components/ui/button";
import { Card, CardContent } from "../../../components/ui/card";
import { ArrowLeft, AlertCircle } from 'lucide-react';
import { ButtonHomeBack } from "@/components/ButtonHomeBack";
import AuthService from "../../../api/authService";

export const Cadastro = () => {
  const navigate = useNavigate();
  const [formData, setFormData] = useState({
    first_name: "",
    username: "",
    email: "",
    data_nascimento: "",
    password: "",
    password2: "",
    nickname: "", // Ser√° preenchido automaticamente com o valor do username
    last_name: ""
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [success, setSuccess] = useState("");

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { id, value } = e.target;
    setFormData(prev => ({ ...prev, [id]: value }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // Valida√ß√£o b√°sica
    if (!formData.first_name || !formData.username || !formData.email || !formData.password || !formData.password2) {
      setError("Por favor, preencha todos os campos obrigat√≥rios");
      return;
    }

    if (formData.password !== formData.password2) {
      setError("As senhas n√£o conferem");
      return;
    }

    setLoading(true);
    setError("");
    setSuccess("");

    try {
      // Envia nickname igual ao username para satisfazer o backend
      const dataToSend = {
        ...formData,
        nickname: formData.username
      };
      
      await AuthService.register(dataToSend);
      setSuccess("Cadastro realizado com sucesso! Redirecionando para o login...");

      // Redireciona para o login ap√≥s 2 segundos
      setTimeout(() => {
        navigate("/login");
      }, 2000);
    } catch (error: any) {
      if (error.response && error.response.data) {
        // Trata erros da API
        if (typeof error.response.data === 'object') {
          // Extrai mensagens de erro
          const errorMessages = Object.entries(error.response.data)
            .map(([key, value]) => `${key}: ${Array.isArray(value) ? value.join(", ") : value}`)
            .join("; ");
          setError(errorMessages);
        } else {
          setError("Falha ao realizar cadastro. Verifique os dados.");
        }
      } else {
        setError("Erro de conex√£o. Tente novamente mais tarde.");
      }
    } finally {
      setLoading(false);
    }
  };

  // 6 inputs na ordem solicitada: nome, usu√°rio, email, data nascimento, senha, confirmar senha
  const formFields = [
    { id: "first_name", label: "NOME", type: "text" },
    { id: "username", label: "USU√ÅRIO", type: "text" },
    { id: "email", label: "EMAIL", type: "email" },
    { id: "data_nascimento", label: "DATA DE NASCIMENTO", type: "date" },
    { id: "password", label: "SENHA", type: "password" },
    { id: "password2", label: "CONFIRMAR SENHA", type: "password" },
  ];

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(32,2,89,1)_0%,rgba(121,70,213,1)_100%)] relative overflow-hidden">
        {/* Nuvens com anima√ß√£o */}
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right opacity-75 scale-110"
          alt="Nuvem"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110"
          alt="Nuvem"
          src="/nuvemright.png"
        />

        {/* Bot√£o de navega√ß√£o */}
        <div className="absolute top-14 left-[33px]">
          <ButtonHomeBack onClick={() => navigate("/")}><ArrowLeft /></ButtonHomeBack>
        </div>

        {/* Card de Cadastro */}
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
          <Card className="w-[700px] rounded-[18px] border-2 border-solid border-black bg-white">
            <CardContent className="pt-8 px-[45px]">
              <h1 className="text-center text-[32px] [font-family:'Silkscreen',Helvetica] font-bold mb-8">
                CADASTRO
              </h1>

              {/* Mensagem de sucesso */}
              {success && (
                <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
                  {success}
                </div>
              )}

              {/* Mensagem de erro */}
              {error && (
                <div className="text-red-500 flex items-center gap-2 mb-4">
                  <AlertCircle size={20} />
                  <span>{error}</span>
                </div>
              )}

              <form className="space-y-4" onSubmit={handleSubmit}>
                <div className="grid grid-cols-2 gap-6">
                  {formFields.map((field) => (
                    <div key={field.id} className="space-y-2">
                      <label className="block [font-family:'Silkscreen',Helvetica] font-bold text-black text-[18px]">
                        {field.label}
                      </label>
                      <input
                        id={field.id}
                        type={field.type}
                        className="w-full h-[55px] rounded-xl border-2 border-solid border-black bg-white p-3 text-black [font-family:'Silkscreen',Helvetica]"
                        value={formData[field.id as keyof typeof formData]}
                        onChange={handleChange}
                      />
                    </div>
                  ))}
                </div>

                <div className="flex flex-col justify-between items-center pt-8">
                  <Button
                    type="submit"
                    disabled={loading}
                    className="w-[374px] h-[53px] bg-[#e3922a] rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[24px] hover:bg-[#e3922a] transform transition-transform duration-300 hover:scale-105"
                  >
                    {loading ? "PROCESSANDO..." : "CADASTRAR"}
                  </Button>

                  <a
                    href="/login"
                    onClick={(e) => {
                      e.preventDefault();
                      navigate("/login");
                    }}
                    className="[font-family:'Silkscreen',Helvetica] font-normal mt-4 text-[#167dd2] text-base underline"
                  >
                    J√° possui uma conta? Fa√ßa login
                  </a>
                </div>
              </form>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/pages/Desafio/ApresentacaoDesafio.tsx">
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { Button } from "../../components/ui/button";
import { ArrowLeft, Home, Trophy, Clock, Users, Truck, Car } from 'lucide-react';
import { ButtonHomeBack } from "@/components/ButtonHomeBack";

// Desafio Mocado
const desafioMocado = {
  id: "desafio-001",
  titulo: "DESAFIO DE ENTREGA: JUAZEIRO A SALVADOR!",
  descricao: "PREPARE-SE, ESTRATEGISTA! SUA PER√çCIA EM LOG√çSTICA EST√Å EM JOGO. SUA MISS√ÉO: TRANSPORTAR 40 CAIXAS DE MADEIRA DE JUAZEIRO DIRETAMENTE PARA SALVADOR.",
  objetivo: "CHEGAR AO DESTINO COM A MAIOR QUANTIDADE DE DINHEIRO POSS√çVEL NO BOLSO!",
  ferramentas: [
    { tipo: "CARRO", descricao: "√ÅGIL PARA MANOBRAR E COM BAIXO CONSUMO, MAS QUANTAS VIAGENS SER√ÉO NECESS√ÅRIAS PARA LEVAR TODA A CARGA?" },
    { tipo: "CAMINH√ÉO PEQUENO", descricao: "UM BOM EQUIL√çBRIO ENTRE CAPACIDADE E CUSTOS PARA ENTREGAS MENORES." },
    { tipo: "CAMINH√ÉO M√âDIO", descricao: "LEVA UMA CARGA CONSIDER√ÅVEL, IDEAL PARA OTIMIZAR O N√öMERO DE VIAGENS." },
    { tipo: "CARRETA", descricao: "CAPACIDADE M√ÅXIMA! LEVA TUDO DE UMA VEZ, MAS ATEN√á√ÉO AOS CUSTOS DE COMBUST√çVEL E POSS√çVEIS PED√ÅGIOS." }
  ],
  dificuldade: "M√âDIO",
  tempoLimite: "8 HORAS",
  minJogadores: 1,
  maxJogadores: 4,
  imagem: "/desafio.png"
};

export const ApresentacaoDesafioPage = () => {
  const navigate = useNavigate();
  const [carregando, setCarregando] = useState(false);

  const handleAceitarDesafio = () => {
    setCarregando(true);
    // Simulando um tempo de carregamento
    setTimeout(() => {
      setCarregando(false);
      navigate("/select-vehicle"); // Rota para iniciar o desafio
    }, 1500);
  };

  const getVehicleIcon = (tipo: string) => {
    switch (tipo) {
      case 'CARRO':
        return <Car size={18} className="text-[#e3922a] mr-2 flex-shrink-0" />;
      default:
        return <Truck size={18} className="text-[#e3922a] mr-2 flex-shrink-0" />;
    }
  };

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(32,2,89,1)_0%,rgba(121,70,213,1)_100%)] relative overflow-hidden z-10">
        {/* Decora√ß√£o de nuvens */}
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right opacity-50 -z-10 "
          alt="Cloud decoration"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] -z-10 object-cover animate-float-left opacity-50 scale-110"
          alt="Cloud decoration"
          src="/nuvemright.png"
        />

        {/* Bot√µes de navega√ß√£o */}
        <div className="flex gap-5 absolute top-4 left-4 z-10">
          <ButtonHomeBack onClick={() => navigate(-1)}><ArrowLeft/></ButtonHomeBack>
          <ButtonHomeBack onClick={() => navigate("/perfil")}><Home/></ButtonHomeBack>
        </div>

        {/* Conte√∫do principal */}
        <div className="pt-16 pb-8 px-4 flex justify-center items-center min-h-screen z-10">
          <div className="bg-white rounded-[18px] border-2 border-solid border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] w-full max-w-[1000px] max-h-[85vh] overflow-hidden flex flex-col">
            {/* Cabe√ßalho fixo */}
            <div className="p-4 border-b-2 border-black bg-gray-50">
              <h1 className="text-center text-[22px] [font-family:'Silkscreen',Helvetica] font-bold text-[#e3922a]">
                {desafioMocado.titulo}
              </h1>
            </div>
            
            {/* Conte√∫do scroll√°vel */}
            <div className="overflow-y-auto p-4 flex-1">
              {/* Imagem principal */}
              <div className="border-2 border-black rounded-lg overflow-hidden h-[200px] mb-4">
                <img 
                  src={desafioMocado.imagem} 
                  alt="Imagem do desafio" 
                  className="w-full h-full object-cover"
                  onError={(e) => {
                    // Fallback se a imagem n√£o carregar
                    const target = e.target as HTMLImageElement;
                    target.src = "/placeholder-truck.png";
                  }}
                />
              </div>

              {/* Descri√ß√£o */}
              <div className="border-2 border-black rounded-lg p-3 bg-gray-50 mb-4">
                <h3 className="[font-family:'Silkscreen',Helvetica] font-bold text-[14px] mb-2">
                  DESCRI√á√ÉO:
                </h3>
                <p className="[font-family:'Silkscreen',Helvetica] text-[12px]">
                  {desafioMocado.descricao}
                </p>
              </div>

              {/* Detalhes */}
              <div className="border-2 border-black rounded-lg p-3 bg-gray-50 mb-4">
                <h3 className="[font-family:'Silkscreen',Helvetica] font-bold text-[14px] mb-2">
                  DETALHES:
                </h3>
                
                <div className="grid grid-cols-2 gap-2">
                  <div className="flex items-center">
                    <Trophy size={16} className="text-[#e3922a] mr-2 flex-shrink-0" />
                    <span className="[font-family:'Silkscreen',Helvetica] text-[11px]">
                      DIFICULDADE: {desafioMocado.dificuldade}
                    </span>
                  </div>
                  
                  <div className="flex items-center">
                    <Clock size={16} className="text-[#e3922a] mr-2 flex-shrink-0" />
                    <span className="[font-family:'Silkscreen',Helvetica] text-[11px]">
                      TEMPO: {desafioMocado.tempoLimite}
                    </span>
                  </div>
                  
                  <div className="flex items-center col-span-2">
                    <Users size={16} className="text-[#e3922a] mr-2 flex-shrink-0" />
                    <span className="[font-family:'Silkscreen',Helvetica] text-[11px]">
                      JOGADORES: {desafioMocado.minJogadores}-{desafioMocado.maxJogadores}
                    </span>
                  </div>
                </div>
              </div>

              {/* Objetivo */}
              <div className="border-2 border-black rounded-lg p-3 bg-gray-50 mb-4">
                <h3 className="[font-family:'Silkscreen',Helvetica] font-bold text-[14px] mb-2 text-green-600">
                  OBJETIVO:
                </h3>
                <p className="[font-family:'Silkscreen',Helvetica] text-[12px] font-bold text-green-600">
                  {desafioMocado.objetivo}
                </p>
              </div>

              {/* Ferramentas */}
              <div className="border-2 border-dashed border-[#e3922a] rounded-lg p-3 bg-yellow-50 mb-4">
                <h3 className="[font-family:'Silkscreen',Helvetica] font-bold text-[14px] mb-2">
                  SUAS FERRAMENTAS:
                </h3>
                <div className="space-y-3">
                  {desafioMocado.ferramentas.map((ferramenta, index) => (
                    <div key={index} className="flex items-start">
                      {getVehicleIcon(ferramenta.tipo)}
                      <div>
                        <span className="[font-family:'Silkscreen',Helvetica] text-[11px] font-bold block">
                          {ferramenta.tipo}
                        </span>
                        <span className="[font-family:'Silkscreen',Helvetica] text-[10px] text-gray-700">
                          {ferramenta.descricao}
                        </span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
            
            {/* Bot√£o de a√ß√£o fixo no footer */}
            <div className="p-4 border-t-2 flex justify-center border-black bg-gray-50">
              <Button 
                onClick={handleAceitarDesafio}
                disabled={carregando}
                className="w-1/2 py-3 bg-[#29D8FF] border-2 border-black rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[16px] hover:bg-[#20B4D2] transform transition-transform duration-300 hover:scale-105 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center"
              >
                {carregando ? (
                  <>
                    <div className="animate-spin rounded-full h-5 w-5 border-4 border-white border-t-black mr-2"></div>
                    CARREGANDO...
                  </>
                ) : (
                  <>
                    <Trophy className="mr-2" size={20} />
                    ACEITAR DESAFIO
                  </>
                )}
              </Button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ApresentacaoDesafioPage;
</file>

<file path="src/pages/GameSelection/components/Footer.tsx">
import React from 'react';

const Footer: React.FC = () => {
  return (
    <footer 
      className="w-full text-center py-6 text-white text-[8px] tracking-wider opacity-70"
      style={{ fontFamily: "'Press Start 2P', cursive" }}
    >
      ¬© 2025 JOGOS LOG√çSTICOS - TODOS OS DIREITOS RESERVADOS
    </footer>
  );
};

export default Footer;
</file>

<file path="src/pages/GameSelection/components/GameCard.tsx">
import React from 'react';

interface GameCardProps {
  title: string;
  description: string;
  isActive: boolean;
  onClick: () => void;
  borderColor: string;
  buttonBgColor: string;
  buttonHoverColor: string;
  icon: React.ReactNode;
}

const GameCard: React.FC<GameCardProps> = ({ 
  title, 
  description, 
  isActive, 
  onClick,
  borderColor,
  buttonBgColor,
  buttonHoverColor,
  icon
}) => {
  return (
    <div 
      className={`
        bg-white overflow-hidden transition-all duration-300 flex flex-col hover:opacity-100 hover:scale-100
        border-t-4 ${borderColor} 
        ${isActive ? 'opacity-100 scale-100' : 'opacity-50 scale-95'}
      `}
      onClick={onClick}
      style={{ fontFamily: "'Press Start 2P', cursive" }}
    >
      <div className="bg-gray-300 aspect-video flex items-center justify-center">
        <div className={`${isActive ? 'text-gray-700' : 'text-gray-400'}`}>
          {icon}
        </div>
      </div>
      
      <div className="p-6 flex-grow">
        <h3 className={`text-center font-bold text-sm mb-4 leading-relaxed ${isActive ? 'text-black' : 'text-gray-400'}`}>
          {title}
        </h3>
        
        <p className={`text-center text-[8px] leading-relaxed ${isActive ? 'text-black' : 'text-gray-400'}`}>
          {description}
        </p>
      </div>
      
      <div className="p-4">
        <button 
          className={`
            w-full py-3 text-center text-sm
            transition-colors duration-200
            ${buttonBgColor} ${buttonHoverColor}
            ${isActive ? 'text-black' : 'text-gray-500'}
          `}
        >
          JOGAR
        </button>
      </div>
    </div>
  );
};

export default GameCard;
</file>

<file path="src/pages/GameSelection/components/PixelHeading.tsx">
import React from 'react';

interface PixelHeadingProps {
  text: string;
  className?: string;
}

const PixelHeading: React.FC<PixelHeadingProps> = ({ text, className = '' }) => {
  return (
    <h1 
      className={`
        text-3xl md:text-4xl text-white tracking-widest uppercase
        drop-shadow-xl
        ${className}
      `}
      style={{ fontFamily: "'Press Start 2P', cursive" }}
    >
      {text.split('').map((char, index) => (
        <span 
          key={index} 
          className="inline-block transform transition-all duration-200 hover:scale-110 hover:text-yellow-300"
          style={{ padding: '0 0.05em' }}
        >
          {char === ' ' ? '\u00A0' : char}
        </span>
      ))}
    </h1>
  );
};

export default PixelHeading;
</file>

<file path="src/pages/Perfil/ChangePassword.tsx">
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../../contexts/AuthContext";
import { Button } from "../../components/ui/button";
import { Card, CardContent } from "../../components/ui/card";
import { Eye, EyeOff, ArrowLeft, Lock } from 'lucide-react';

export const ChangePassword = () => {
  const navigate = useNavigate();
  const { user } = useAuth();
  
  const [formData, setFormData] = useState({
    currentPassword: '',
    newPassword: '',
    confirmPassword: ''
  });
  
  const [showPasswords, setShowPasswords] = useState({
    current: false,
    new: false,
    confirm: false
  });
  
  const [errors, setErrors] = useState<Record<string, string>>({});
  const [isLoading, setIsLoading] = useState(false);
  const [successMessage, setSuccessMessage] = useState('');

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    // Limpar erro espec√≠fico quando usu√°rio come√ßar a digitar
    if (errors[field]) {
      setErrors(prev => ({ ...prev, [field]: '' }));
    }
    // Limpar mensagem de sucesso
    if (successMessage) {
      setSuccessMessage('');
    }
  };

  const togglePasswordVisibility = (field: 'current' | 'new' | 'confirm') => {
    setShowPasswords(prev => ({ ...prev, [field]: !prev[field] }));
  };

  const validateForm = (): boolean => {
    const newErrors: Record<string, string> = {};

    // Validar senha atual
    if (!formData.currentPassword) {
      newErrors.currentPassword = 'Senha atual √© obrigat√≥ria';
    }

    // Validar nova senha
    if (!formData.newPassword) {
      newErrors.newPassword = 'Nova senha √© obrigat√≥ria';
    } else if (formData.newPassword.length < 8) {
      newErrors.newPassword = 'Nova senha deve ter pelo menos 8 caracteres';
    } else if (formData.newPassword === formData.currentPassword) {
      newErrors.newPassword = 'Nova senha deve ser diferente da atual';
    }

    // Validar confirma√ß√£o
    if (!formData.confirmPassword) {
      newErrors.confirmPassword = 'Confirma√ß√£o de senha √© obrigat√≥ria';
    } else if (formData.newPassword !== formData.confirmPassword) {
      newErrors.confirmPassword = 'Senhas n√£o conferem';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!validateForm()) return;

    setIsLoading(true);
    setErrors({});

    try {

      // Simulando uma chamada API
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Simular sucesso
      setSuccessMessage('Senha alterada com sucesso!');
      setFormData({ currentPassword: '', newPassword: '', confirmPassword: '' });
      
      // Redirecionar ap√≥s 2 segundos
      setTimeout(() => {
        navigate('/perfil');
      }, 2000);

    } catch (error) {
      // Tratar diferentes tipos de erro
      setErrors({ 
        currentPassword: 'Senha atual incorreta' 
      });
    } finally {
      setIsLoading(false);
    }
  };

  const handleGoBack = () => {
    navigate('/perfil');
  };

  const titleStyle = {
    color: "#E3922A",
    textShadow: "2px 3px 0.6px #000"
  };

  return (
    <div className="bg-white flex flex-row justify-center w-full h-screen overflow-hidden">
      <div className="w-full h-full [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden">
        
        {}
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right"
          alt="Cloud decoration"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration"
          src="/nuvemright.png"
        />

        {/* Main content */}
        <div className="max-w-md mx-auto py-8 px-4 relative z-10 h-full flex flex-col justify-center">
          
          {/* Back button */}
          <Button
            variant="outline"
            onClick={handleGoBack}
            className="mb-2 border-2 border-black bg-white hover:bg-gray-100"
          >
            <ArrowLeft size={20} className="mr-2" />
            <span className="[font-family:'Silkscreen',Helvetica] font-bold">VOLTAR</span>
          </Button>

          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
            <CardContent className="p-4">
              
              {/* Header */}
              <div className="text-center mb-4">
                <div className="w-12 h-12 mx-auto mb-3 bg-orange-100 rounded-full flex items-center justify-center border-2 border-orange-500">
                  <Lock size={24} className="text-orange-500" />
                </div>
                <h2 className="[font-family:'Silkscreen',Helvetica] font-bold text-xl" style={titleStyle}>
                  ALTERAR SENHA
                </h2>
                <p className="[font-family:'Silkscreen',Helvetica] text-xs mt-1 text-gray-600">
                  Ol√°, {user?.first_name || user?.username}! Altere sua senha abaixo.
                </p>
              </div>

              {/* Success message */}
              {successMessage && (
                <div className="mb-4 p-3 bg-green-100 border-2 border-green-500 rounded-lg text-center">
                  <span className="[font-family:'Silkscreen',Helvetica] text-green-700 font-bold">
                    {successMessage}
                  </span>
                </div>
              )}

              {/* Form */}
              <form onSubmit={handleSubmit} className="space-y-3">
                
                {/* Current Password */}
                <div>
                  <label className="[font-family:'Silkscreen',Helvetica] text-sm font-bold block mb-2">
                    SENHA ATUAL *
                  </label>
                  <div className="relative">
                    <input
                      type={showPasswords.current ? "text" : "password"}
                      value={formData.currentPassword}
                      onChange={(e) => handleInputChange('currentPassword', e.target.value)}
                      className="w-full px-3 py-2 border-2 border-black rounded focus:outline-none focus:border-orange-500 [font-family:'Silkscreen',Helvetica]"
                      placeholder="Digite sua senha atual"
                      disabled={isLoading}
                    />
                    <button
                      type="button"
                      onClick={() => togglePasswordVisibility('current')}
                      className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 bg-transparent border-0 outline-0 shadow-none focus:outline-0 focus:shadow-none focus:ring-0 active:outline-0 active:shadow-none"
                      style={{ boxShadow: 'none', outline: 'none' }}
                      disabled={isLoading}
                    >
                      {showPasswords.current ? <EyeOff size={20} /> : <Eye size={20} />}
                    </button>
                  </div>
                  {errors.currentPassword && (
                    <span className="text-red-500 text-xs [font-family:'Silkscreen',Helvetica] mt-1 block">
                      {errors.currentPassword}
                    </span>
                  )}
                </div>

                {/* New Password */}
                <div>
                  <label className="[font-family:'Silkscreen',Helvetica] text-sm font-bold block mb-2">
                    NOVA SENHA *
                  </label>
                  <div className="relative">
                    <input
                      type={showPasswords.new ? "text" : "password"}
                      value={formData.newPassword}
                      onChange={(e) => handleInputChange('newPassword', e.target.value)}
                      className="w-full px-3 py-2 border-2 border-black rounded focus:outline-none focus:border-orange-500 [font-family:'Silkscreen',Helvetica]"
                      placeholder="Digite sua nova senha"
                      disabled={isLoading}
                    />
                    <button
                      type="button"
                      onClick={() => togglePasswordVisibility('new')}
                      className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 bg-transparent border-0 outline-0 shadow-none focus:outline-0 focus:shadow-none focus:ring-0 active:outline-0 active:shadow-none"
                      style={{ boxShadow: 'none', outline: 'none' }}
                      disabled={isLoading}
                    >
                      {showPasswords.new ? <EyeOff size={20} /> : <Eye size={20} />}
                    </button>
                  </div>
                  {errors.newPassword && (
                    <span className="text-red-500 text-xs [font-family:'Silkscreen',Helvetica] mt-1 block">
                      {errors.newPassword}
                    </span>
                  )}
                  <span className="text-gray-500 text-xs [font-family:'Silkscreen',Helvetica] mt-1 block">
                    M√≠nimo de 8 caracteres
                  </span>
                </div>

                {/* Confirm Password */}
                <div>
                  <label className="[font-family:'Silkscreen',Helvetica] text-sm font-bold block mb-2">
                    CONFIRMAR NOVA SENHA *
                  </label>
                  <div className="relative">
                    <input
                      type={showPasswords.confirm ? "text" : "password"}
                      value={formData.confirmPassword}
                      onChange={(e) => handleInputChange('confirmPassword', e.target.value)}
                      className="w-full px-3 py-2 border-2 border-black rounded focus:outline-none focus:border-orange-500 [font-family:'Silkscreen',Helvetica]"
                      placeholder="Confirme sua nova senha"
                      disabled={isLoading}
                    />
                    <button
                      type="button"
                      onClick={() => togglePasswordVisibility('confirm')}
                      className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 bg-transparent border-0 outline-0 shadow-none focus:outline-0 focus:shadow-none focus:ring-0 active:outline-0 active:shadow-none"
                      style={{ boxShadow: 'none', outline: 'none' }}
                      disabled={isLoading}
                    >
                      {showPasswords.confirm ? <EyeOff size={20} /> : <Eye size={20} />}
                    </button>
                  </div>
                  {errors.confirmPassword && (
                    <span className="text-red-500 text-xs [font-family:'Silkscreen',Helvetica] mt-1 block">
                      {errors.confirmPassword}
                    </span>
                  )}
                </div>

                {/* Submit Button */}
                <Button
                  type="submit"
                  disabled={isLoading}
                  className="w-full bg-orange-400 text-black hover:bg-orange-500 h-10 border-2 border-black [font-family:'Silkscreen',Helvetica] font-bold mt-4"
                >
                  {isLoading ? (
                    <div className="flex items-center justify-center">
                      <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-black mr-2"></div>
                      ALTERANDO...
                    </div>
                  ) : (
                    'ALTERAR SENHA'
                  )}
                </Button>

              </form>

            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default ChangePassword;
</file>

<file path="src/pages/Perfil/ExcluirEquipe.tsx">
import { useNavigate } from "react-router-dom";
import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Button } from "../../components/ui/button";
import {
  Card,
  CardContent,
} from "../../components/ui/card";
import {
  ArrowLeft,
  Trash2,
  AlertTriangle,
  Users,
  Trophy,
} from 'lucide-react';
import { TeamService } from "../../api/teamService";
import { useAuth } from "../../contexts/AuthContext";

export const ExcluirEquipePage = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const { user, refreshUser } = useAuth();
  const teamId = user?.equipe;

  const [confirmationText, setConfirmationText] = useState("");

  const handleNavigateBack = () => {
    navigate(-1);
  };

  // Query para buscar dados da equipe
  const { data: teamData, isLoading } = useQuery({
    queryKey: ['teamDetails', teamId],
    queryFn: () => TeamService.getTeamDetails(teamId!),
    enabled: !!teamId,
  });

  // Muta√ß√£o para excluir equipe
  const deleteTeamMutation = useMutation({
    mutationFn: () => TeamService.deleteTeam(teamId!),
    onSuccess: async () => {
      alert("Equipe exclu√≠da com sucesso!");
      await refreshUser(); // CRUCIAL: atualizar dados do usu√°rio
      queryClient.clear(); // Limpar todas as queries
      navigate("/perfil");
    },
    onError: (error: any) => {
      const errorMessage = error.response?.data?.detail ||
        "Erro ao excluir equipe.";
      alert(`Erro: ${errorMessage}`);
    },
  });

  const handleConfirmDelete = () => {
    if (!teamData) return;

    if (confirmationText.trim().toUpperCase() !== teamData.nome.toUpperCase()) {
      alert("O nome da equipe n√£o confere. Digite exatamente como mostrado.");
      return;
    }

    if (confirm("Esta a√ß√£o n√£o pode ser desfeita. Tem certeza absoluta?")) {
      deleteTeamMutation.mutate();
    }
  };

  const handleCancel = () => {
    navigate("/perfil/editar-equipe");
  };

  // Estados de loading
  if (isLoading) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(220,53,69,1)_0%,rgba(108,117,125,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <div className="animate-spin rounded-full h-8 w-8 border-2 border-red-500 border-t-transparent mx-auto mb-4"></div>
              <p>Carregando dados da equipe...</p>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  if (!teamData) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(220,53,69,1)_0%,rgba(108,117,125,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <p className="mb-4">Equipe n√£o encontrada ou voc√™ n√£o est√° em uma equipe.</p>
              <Button onClick={() => navigate("/perfil")} className="bg-blue-500 hover:bg-blue-600 text-white">
                Voltar ao Perfil
              </Button>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  // Verificar se √© o l√≠der (s√≥ ap√≥s carregar os dados)
  const isLeader = teamData && user && teamData.lider.id === user.id;
  if (teamData && user && !isLeader) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(220,53,69,1)_0%,rgba(108,117,125,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <p className="mb-4">Apenas o l√≠der da equipe pode exclu√≠-la.</p>
              <Button onClick={() => navigate("/perfil")} className="bg-blue-500 hover:bg-blue-600 text-white">
                Voltar ao Perfil
              </Button>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  const silkscreenFont = "[font-family:'Silkscreen',Helvetica]";
  const inputStyle = `bg-white border-2 border-black rounded-md p-3 w-full ${silkscreenFont} text-sm focus:outline-none focus:ring-2 focus:ring-red-400`;
  const labelStyle = `text-sm ${silkscreenFont} mb-2 block text-black font-bold`;
  const buttonBaseStyle = `${silkscreenFont} border-2 border-black rounded-md px-6 py-3 text-sm font-bold flex items-center justify-center transition-all`;

  const isConfirmationValid = confirmationText.trim().toUpperCase() === teamData.nome.toUpperCase();

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className={`w-full min-h-screen [background:linear-gradient(180deg,rgba(220,53,69,1)_0%,rgba(108,117,125,1)_100%)] relative overflow-hidden ${silkscreenFont}`}>
        {/* Decorative clouds */}
        <img
          className="w-[375px] h-[147px] absolute top-[80px] left-[calc(50%_-_650px)] object-cover animate-float-right opacity-60"
          alt="Cloud decoration left"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[calc(50%_-_700px)] object-cover animate-float-left opacity-55 scale-110"
          alt="Cloud decoration right"
          src="/nuvemright.png"
        />

        {/* Back button */}
        <div className="absolute top-4 left-4 z-20">
          <Button onClick={handleNavigateBack} variant="outline" className="p-2 bg-white border-2 border-black rounded-md hover:bg-gray-200">
            <ArrowLeft size={24} className="text-black" />
          </Button>
        </div>

        {/* Main content */}
        <div className="max-w-2xl mx-auto pt-16 pb-8 px-4 relative z-10">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <CardContent className="p-6">
              {/* Header */}
              <div className="text-center mb-6">
                <div className="flex justify-center mb-4">
                  <div className="w-20 h-20 rounded-full bg-red-100 border-2 border-red-500 flex items-center justify-center">
                    <AlertTriangle size={40} className="text-red-500" />
                  </div>
                </div>
                <h1 className={`${silkscreenFont} text-2xl font-bold text-red-600 mb-2`}>
                  EXCLUIR EQUIPE
                </h1>
                <p className={`${silkscreenFont} text-sm text-gray-700`}>
                  ESTA A√á√ÉO N√ÉO PODE SER DESFEITA
                </p>
              </div>

              {/* Team info */}
              <div className="bg-gray-50 border-2 border-black rounded-md p-4 mb-6">
                <h3 className={`${silkscreenFont} text-lg font-bold text-black mb-3 text-center`}>
                  EQUIPE: <span className="text-red-600">{teamData.nome}</span>
                </h3>

                <div className="grid grid-cols-2 gap-4 text-center">
                  <div className="flex flex-col items-center">
                    <Users size={24} className="text-gray-600 mb-1" />
                    <span className={`${silkscreenFont} text-xs text-gray-600`}>MEMBROS</span>
                    <span className={`${silkscreenFont} text-lg font-bold text-black`}>{teamData.membros.length}</span>
                  </div>
                  <div className="flex flex-col items-center">
                    <span className="text-2xl mb-1">üìÖ</span>
                    <span className={`${silkscreenFont} text-xs text-gray-600`}>CRIADA EM</span>
                    <span className={`${silkscreenFont} text-sm font-bold text-black`}>
                      {new Date(teamData.created_at).toLocaleDateString('pt-BR')}
                    </span>
                  </div>
                </div>

                {/* Members list */}
                <div className="mt-4">
                  <p className={`${silkscreenFont} text-xs text-gray-600 mb-2`}>MEMBROS QUE SER√ÉO REMOVIDOS:</p>
                  <div className="space-y-1 max-h-24 overflow-y-auto">
                    {teamData.membros.map((member) => (
                      <div key={member.id} className="flex items-center gap-2 text-xs">
                        <span className="text-red-500">‚Ä¢</span>
                        <span className={`${silkscreenFont}`}>
                          {member.nickname} {member.id === teamData.lider.id ? '(L√çDER)' : ''}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Warning */}
              <div className="bg-red-50 border-2 border-red-300 rounded-md p-4 mb-6">
                <div className="flex items-start">
                  <AlertTriangle size={20} className="text-red-500 mr-3 mt-1 flex-shrink-0" />
                  <div>
                    <h4 className={`${silkscreenFont} text-sm font-bold text-red-700 mb-2`}>
                      ATEN√á√ÉO: AO EXCLUIR A EQUIPE
                    </h4>
                    <ul className={`${silkscreenFont} text-xs text-red-600 space-y-1`}>
                      <li>‚Ä¢ TODOS OS MEMBROS SER√ÉO REMOVIDOS</li>
                      <li>‚Ä¢ TODO O PROGRESSO SER√Å PERDIDO</li>
                      <li>‚Ä¢ OS DADOS DA EQUIPE SER√ÉO APAGADOS</li>
                      <li>‚Ä¢ ESTA A√á√ÉO N√ÉO PODE SER REVERTIDA</li>
                    </ul>
                  </div>
                </div>
              </div>

              {/* Confirmation input */}
              <div className="mb-6">
                <label htmlFor="confirmationText" className={labelStyle}>
                  PARA CONFIRMAR, DIGITE O NOME DA EQUIPE:
                </label>
                <div className="mb-2">
                  <span className={`${silkscreenFont} text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded border`}>
                    {teamData.nome}
                  </span>
                </div>
                <input
                  type="text"
                  name="confirmationText"
                  id="confirmationText"
                  value={confirmationText}
                  onChange={(e) => setConfirmationText(e.target.value)}
                  className={inputStyle}
                  placeholder="DIGITE O NOME DA EQUIPE AQUI"
                  disabled={deleteTeamMutation.isPending}
                />
                {confirmationText && !isConfirmationValid && (
                  <p className={`${silkscreenFont} text-xs text-red-500 mt-1`}>
                    O nome n√£o confere
                  </p>
                )}
              </div>

              {/* Action buttons */}
              <div className="flex flex-col sm:flex-row gap-3">
                <Button
                  onClick={handleCancel}
                  disabled={deleteTeamMutation.isPending}
                  className={`${buttonBaseStyle} flex-1 bg-gray-200 hover:bg-gray-300 text-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] disabled:opacity-50 disabled:cursor-not-allowed`}
                >
                  CANCELAR
                </Button>
                <Button
                  onClick={handleConfirmDelete}
                  disabled={!isConfirmationValid || deleteTeamMutation.isPending}
                  className={`${buttonBaseStyle} flex-1 bg-red-500 hover:bg-red-600 text-white shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none`}
                >
                  {deleteTeamMutation.isPending ? (
                    <>
                      <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                      EXCLUINDO...
                    </>
                  ) : (
                    <>
                      <Trash2 size={18} className="mr-2" />
                      EXCLUIR EQUIPE
                    </>
                  )}
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default ExcluirEquipePage;
</file>

<file path="src/pages/RoutesPage/RoutesPage.tsx">
// src/pages/RoutesPage/RoutesPage.tsx

import React, { useState } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { routes, Route } from '../mapaRota/routesData';
import { MapComponent } from '../mapaRota/MapComponent';

export const RoutesPage: React.FC = () => {
  const location = useLocation();
  const navigate = useNavigate();

  // Dados recebidos da tela anterior
  const vehicle = location.state?.selectedVehicle || { id: 'carreta', name: 'Carreta', capacity: 60, consumption: { asphalt: 2, dirt: 1.5 }, image: '/carreta.png', maxCapacity: 495, currentFuel: 0, cost: 4500 };
  const availableMoney = location.state?.availableMoney || 5500;

  const [selectedRoute, setSelectedRoute] = useState<Route | null>(null);
  const [routesList] = useState<Route[]>(routes);

  const handleSelectRoute = (routeId: number) => {
    const routeToSelect = routesList.find(r => r.routeId === routeId);
    if (routeToSelect) {
      setSelectedRoute(routeToSelect);
    }
  };

  const handleContinue = () => {
    if (selectedRoute) {
      // Navegar para a tela de abastecimento
      navigate('/fuel', {
        state: {
          vehicle,
          availableMoney,
          selectedRoute
        }
      });
    }
  };

  const goBack = () => {
    navigate('/select-vehicle');
  };

  return (
    <div className="min-h-screen bg-[#200259] font-['Silkscreen']">
      {/* Header compacto */}
      <div className="bg-[#200259] border-b-2 border-[#E3922A] px-3 py-2">
        <div className="flex items-center justify-between mx-auto">
          <button
            className="flex items-center gap-1 px-3 py-1.5 bg-[#E3922A] text-black font-bold text-sm rounded-md shadow-lg
                     hover:bg-[#FFC06F] transition-all duration-200 border-2 border-black"
            onClick={goBack}
          >
            <ArrowLeft size={16} /> VOLTAR
          </button>
          
          <h1 className="text-lg lg:text-xl font-bold text-[#E3922A] text-center">
            ESCOLHA SUA ROTA
          </h1>
          
          <div className="bg-[#E3922A] text-black text-sm lg:text-base font-bold px-3 py-1.5 rounded-md shadow-lg border-2 border-black">
            R$ {availableMoney.toFixed(2)}
          </div>
        </div>
      </div>

      {/* Conte√∫do principal */}
      <div className="flex flex-col lg:flex-row gap-3 p-3 h-[calc(100vh-60px)] max-h-[calc(100vh-60px)] overflow-hidden">
        {/* Mapa usando o MapComponent existente */}
        <div className="lg:w-2/3 h-full lg:h-full flex flex-col min-h-[300px] lg:min-h-0">
          <div className="flex-1 min-h-0 overflow-hidden rounded-lg border-2 border-gray-300">
                          {selectedRoute ? (
               <div className="w-full h-full max-h-full overflow-hidden">
                <div className="w-full h-full">
                  <MapComponent 
                    preSelectedRoute={selectedRoute}
                    preSelectedVehicle={vehicle}
                    preAvailableMoney={availableMoney}
                    showControls={false}
                  />
                </div>
              </div>
            ) : (
              <div className="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                <div className="text-center text-gray-600 font-['Silkscreen'] p-4">
                  <div className="text-4xl mb-3">üó∫Ô∏è</div>
                  <p className="text-lg font-bold mb-1 text-gray-700">Selecione uma rota</p>
                  <p className="text-sm text-gray-500">para visualizar no mapa</p>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Lista de Rotas */}
        <div className="lg:w-2/5 flex flex-col h-full lg:h-full min-h-[400px] lg:min-h-0">
          {/* Header da se√ß√£o */}
          <div className="bg-[#E3922A] text-black p-2 rounded-t-lg border-2 border-black mb-0 flex-shrink-0">
            <h2 className="text-lg font-['Silkscreen'] font-bold text-center">
              ROTAS DISPON√çVEIS
            </h2>
          </div>
          
          {/* Lista scroll√°vel */}
          <div className="flex-1 min-h-0 overflow-y-auto bg-gray-100 border-x-2 border-black p-2 space-y-2">
            
            {routesList.map((route) => (
              <div
                key={route.routeId}
                className={`p-2 rounded-lg cursor-pointer transition-all duration-200 border-2
                  ${selectedRoute?.routeId === route.routeId 
                    ? 'bg-yellow-300 border-yellow-600 shadow-lg' 
                    : 'bg-white border-gray-300 hover:bg-gray-50 hover:border-gray-400'}
                  `}
                onClick={() => handleSelectRoute(route.routeId)}
              >
                <h3 className="font-['Silkscreen'] font-bold text-sm text-black mb-2 border-b border-gray-300 pb-1">
                  {route.name}
                </h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                  <div className="space-y-0.5">
                    <p className="font-['Silkscreen'] text-black text-xs">
                      <span className="font-['Silkscreen']">‚è±Ô∏è TEMPO:</span> {route.estimatedTime}
                    </p>
                    <p className="font-['Silkscreen'] text-black text-xs">
                      <span className="font-['Silkscreen']">üìè DIST√ÇNCIA:</span> {route.actualDistance ? `${route.actualDistance.toFixed(0)}` : route.distance} km
                    </p>
                  </div>
                  
                  <div className="space-y-0.5">
                    <p className="font-['Silkscreen'] text-black text-xs flex items-center">
                      <span className="font-['Silkscreen']">üõ°Ô∏è RISCO:</span>
                      <span className={`${route.safety.robberyRisk === 'Baixo' ? 'text-green-700' : 'text-red-700'} ml-1 font-['Silkscreen']`}>
                        {route.safety.robberyRisk} {route.safety.robberyRisk === 'Baixo' ? '‚úÖ' : '‚ö†Ô∏è'}
                      </span>
                    </p>
                    {route.dirtRoad && (
                      <p className="font-['Silkscreen'] text-black text-xs flex items-center">
                        <span className="font-['Silkscreen']">üõ§Ô∏è TERRENO:</span>
                        <span className="text-yellow-700 ml-1 font-['Silkscreen']">Estrada de Terra</span>
                      </p>
                    )}
                  </div>
                </div>

                

                {selectedRoute?.routeId === route.routeId && (
                  <div className="mt-2 p-2 bg-blue-50 border-l-4 border-blue-400 rounded-r-md">
                    <h4 className="font-bold text-blue-800 mb-1 text-xs">üìã DETALHES:</h4>
                    <div className="grid grid-cols-2 gap-1 text-xs text-blue-700">
                      {route.tollBooths.length > 0 && (
                        <p>üõ£Ô∏è Ped√°gios: {route.tollBooths.length}</p>
                      )}
                      {route.dangerZones && route.dangerZones.length > 0 && (
                        <p>‚ö†Ô∏è Riscos: {route.dangerZones.length}</p>
                      )}
                      {route.speedLimits.length > 0 && (
                        <p>üö¶ Velocidade: Variada</p>
                      )}
                      {route.dirtSegments && route.dirtSegments.length > 0 && (
                        <p>üåÑ Terra: {route.dirtSegments.length}</p>
                      )}
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
          
          {/* Footer com bot√£o de continuar */}
          <div className="bg-[#E3922A] border-2 border-black rounded-b-lg p-2 flex-shrink-0">
            {selectedRoute ? (
              <button
                onClick={handleContinue}
                className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 text-sm rounded-md 
                         shadow-lg border-2 border-green-800 transition-all duration-200"
              >
                üöõ CONTINUAR COM ESTA ROTA
              </button>
            ) : (
              <div className="text-center text-black font-bold py-2 text-sm">
                üëÜ Selecione uma rota para continuar
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/api/config.ts">
import axios from 'axios';

// Base URL da API - ajuste conforme seu ambiente (usando o nome do servi√ßo no Docker Compose)
const API_URL = import.meta.env.VITE_API_URL || 'http://api:8000';

// Inst√¢ncia do Axios para a API
const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para adicionar o token JWT em todas as requisi√ß√µes autenticadas
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Interceptor para tratar respostas com erro 401 (n√£o autorizado)
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    // Se o token expirou (401), tenta renovar com refresh token
    if (error.response && error.response.status === 401 && !error.config.url.includes('/auth/token/')) {
      const refreshToken = localStorage.getItem('refreshToken');

      if (refreshToken) {
        try {
          // Tenta obter um novo token
          const response = await axios.post(`${API_URL}/api/auth/token/refresh/`, {
            refresh: refreshToken
          });

          // Armazena os novos tokens
          localStorage.setItem('token', response.data.access);

          // Reexecuta a requisi√ß√£o original com o novo token
          const originalRequest = error.config;
          originalRequest.headers.Authorization = `Bearer ${response.data.access}`;
          return api(originalRequest);
        } catch (refreshError) {
          // Se n√£o conseguir renovar, faz logout
          localStorage.removeItem('token');
          localStorage.removeItem('refreshToken');
          console.error("Falha ao renovar token:", refreshError);
          window.location.href = '/login';
        }
      } else {
        // Se n√£o tem refresh token, redireciona para login
        window.location.href = '/login';
      }
    }

    return Promise.reject(error);
  }
);

export default api;
</file>

<file path="src/pages/Perfil/EditarEquipe.tsx">
import { useNavigate } from "react-router-dom";
import { useState, useEffect } from "react";
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Button } from "../../components/ui/button";
import {
  Card,
  CardContent,
} from "../../components/ui/card";
import {
  ArrowLeft,
  Copy,
  Settings,
  Crown,
  Shield,
  User,
} from 'lucide-react';
import { TeamService } from "../../api/teamService";
import { useAuth } from "../../contexts/AuthContext";

export const EditarEquipePage = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const { user } = useAuth();
  const teamId = user?.equipe;

  const [teamName, setTeamName] = useState("");

  const handleNavigateBack = () => {
    navigate(-1);
  };

  // Query para buscar dados da equipe
  const { data: teamData, isLoading, error } = useQuery({
    queryKey: ['teamDetails', teamId],
    queryFn: () => TeamService.getTeamDetails(teamId!),
    enabled: !!teamId,
  });

  // Sincronizar nome da equipe com os dados carregados
  useEffect(() => {
    if (teamData) {
      setTeamName(teamData.nome);
    }
  }, [teamData]);

  // Muta√ß√£o para atualizar nome
  const updateTeamMutation = useMutation({
    mutationFn: (newName: string) =>
      TeamService.updateTeam(teamId!, { nome: newName }),
    onSuccess: () => {
      alert("Nome da equipe atualizado com sucesso!");
      queryClient.invalidateQueries({ queryKey: ['teamDetails', teamId] });
    },
    onError: (error: any) => {
      const errorMessage = error.response?.data?.detail ||
        error.response?.data?.nome?.[0] ||
        "Erro ao atualizar equipe.";
      alert(`Erro: ${errorMessage}`);
    },
  });

  // Muta√ß√£o para regenerar c√≥digo
  const regenerateCodeMutation = useMutation({
    mutationFn: () => TeamService.regenerateCode(teamId!),
    onSuccess: () => {
      alert("Novo c√≥digo gerado com sucesso!");
      queryClient.invalidateQueries({ queryKey: ['teamDetails', teamId] });
    },
    onError: (error: any) => {
      const errorMessage = error.response?.data?.detail ||
        "Erro ao gerar novo c√≥digo.";
      alert(`Erro: ${errorMessage}`);
    },
  });

  const handleSaveChanges = () => {
    if (!teamName.trim()) {
      alert("O nome da equipe n√£o pode estar vazio.");
      return;
    }
    updateTeamMutation.mutate(teamName);
  };

  const handleGenerateNewCode = () => {
    if (confirm("Tem certeza que deseja gerar um novo c√≥digo? O c√≥digo atual ficar√° inv√°lido.")) {
      regenerateCodeMutation.mutate();
    }
  };

  const handleCopyInviteCode = () => {
    if (teamData?.codigo) {
      navigator.clipboard.writeText(teamData.codigo);
      alert("C√≥digo copiado para a √°rea de transfer√™ncia!");
    }
  };

  // Estados de loading e erro
  if (isLoading) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <div className="animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent mx-auto mb-4"></div>
              <p>Carregando dados da equipe...</p>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center text-red-500">
              <p className="mb-4">Erro ao carregar dados da equipe.</p>
              <Button onClick={() => navigate("/perfil")} className="bg-blue-500 hover:bg-blue-600 text-white">
                Voltar ao Perfil
              </Button>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  if (!teamData) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <p className="mb-4">Equipe n√£o encontrada.</p>
              <Button onClick={() => navigate("/perfil")} className="bg-blue-500 hover:bg-blue-600 text-white">
                Voltar ao Perfil
              </Button>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  // Verificar se √© o l√≠der (s√≥ ap√≥s carregar os dados)
  const isLeader = teamData && user && teamData.lider.id === user.id;
  if (teamData && user && !isLeader) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <p className="mb-4">Apenas o l√≠der da equipe pode editar estas informa√ß√µes.</p>
              <Button onClick={() => navigate("/perfil")} className="bg-blue-500 hover:bg-blue-600 text-white">
                Voltar ao Perfil
              </Button>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  const getRoleIcon = (isLider: boolean) => {
    if (isLider) {
      return <Crown size={16} className="text-yellow-500" />;
    }
    return <User size={16} className="text-gray-500" />;
  };

  const getRoleColor = (isLider: boolean) => {
    if (isLider) {
      return 'text-yellow-600';
    }
    return 'text-gray-600';
  };

  const getRoleText = (isLider: boolean) => {
    return isLider ? 'L√çDER' : 'MEMBRO';
  };

  const silkscreenFont = "[font-family:'Silkscreen',Helvetica]";
  const inputStyle = `bg-white border-2 border-black rounded-md p-2 w-full ${silkscreenFont} text-sm focus:outline-none focus:ring-2 focus:ring-blue-400`;
  const labelStyle = `text-xs ${silkscreenFont} mb-1 block text-black font-bold`;
  const buttonBaseStyle = `${silkscreenFont} border-2 border-black rounded-md px-4 py-2 text-xs font-bold flex items-center justify-center transition-all`;

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className={`w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden ${silkscreenFont}`}>
        {/* Decorative clouds */}
        <img
          className="w-[375px] h-[147px] absolute top-[80px] left-[calc(50%_-_650px)] object-cover animate-float-right opacity-80"
          alt="Cloud decoration left"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[calc(50%_-_700px)] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration right"
          src="/nuvemright.png"
        />

        {/* Back button */}
        <div className="absolute top-4 left-4 z-20">
          <Button onClick={handleNavigateBack} variant="outline" className="p-2 bg-white border-2 border-black rounded-md hover:bg-gray-200">
            <ArrowLeft size={24} className="text-black" />
          </Button>
        </div>

        {/* Main content */}
        <div className="max-w-4xl mx-auto pt-16 pb-8 px-4 relative z-10">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <CardContent className="p-6">
              {/* Header */}
              <div className="text-center mb-6">
                <h1 className={`${silkscreenFont} text-xl font-bold text-[#E3922A] border-2 border-black bg-gray-100 py-2 px-4 rounded-md inline-block`}>
                  EDITAR EQUIPE
                </h1>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Left column - Team info */}
                <div className="space-y-4">
                  {/* Team name */}
                  <div>
                    <label htmlFor="teamName" className={labelStyle}>
                      NOME DA EQUIPE
                    </label>
                    <input
                      type="text"
                      name="teamName"
                      id="teamName"
                      value={teamName}
                      onChange={(e) => setTeamName(e.target.value)}
                      className={inputStyle}
                      disabled={updateTeamMutation.isPending}
                    />
                  </div>

                  {/* Invite code */}
                  <div>
                    <label htmlFor="inviteCode" className={labelStyle}>
                      C√ìDIGO DE INVITE
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        name="inviteCode"
                        id="inviteCode"
                        value={teamData.codigo}
                        readOnly
                        className={`${inputStyle} flex-1`}
                      />
                      <Button
                        onClick={handleCopyInviteCode}
                        className={`${buttonBaseStyle} bg-green-500 hover:bg-green-600 text-white shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)]`}
                      >
                        <Copy size={14} />
                      </Button>
                      <Button
                        onClick={handleGenerateNewCode}
                        disabled={regenerateCodeMutation.isPending}
                        className={`${buttonBaseStyle} bg-red-500 hover:bg-red-600 text-white shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] disabled:opacity-50`}
                      >
                        {regenerateCodeMutation.isPending ? "..." : "GERAR NOVO"}
                      </Button>
                    </div>
                  </div>

                  {/* Team members */}
                  <div>
                    <label className={labelStyle}>
                      MEMBROS DA EQUIPE ({teamData.membros.length})
                    </label>
                    <div className="space-y-2 max-h-60 overflow-y-auto">
                      {teamData.membros.map((member) => {
                        const isLider = member.id === teamData.lider.id;
                        return (
                          <div key={member.id} className="flex items-center gap-3 bg-gray-50 border-2 border-black rounded-md p-3">
                            <img
                              src={member.avatar || "/mario.png"}
                              alt={`Avatar de ${member.nickname}`}
                              className="w-12 h-12 rounded-full border-2 border-black object-cover"
                            />
                            <div className="flex-1">
                              <div className="flex items-center gap-2">
                                {getRoleIcon(isLider)}
                                <span className={`${silkscreenFont} text-sm font-bold text-black`}>
                                  {member.nickname.toUpperCase()}
                                </span>
                              </div>
                              <div className={`${silkscreenFont} text-xs text-gray-600`}>
                                @{member.username || member.nickname}
                              </div>
                            </div>
                            <div className={`${silkscreenFont} text-xs ${getRoleColor(isLider)} font-bold`}>
                              {getRoleText(isLider)}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>

                {/* Right column - Instructions */}
                <div className="space-y-4">
                  <div>
                    <label className={`${labelStyle} mb-3`}>
                      COMO ADICIONAR MEMBROS
                    </label>

                    <div className="bg-gray-50 border-2 border-black rounded-md p-4">
                      <p className={`${silkscreenFont} text-sm text-black mb-4`}>
                        PARA ADICIONAR NOVOS MEMBROS:
                      </p>

                      <ol className="space-y-3">
                        <li className="flex items-start gap-2">
                          <span className="text-blue-500 font-bold">1.</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            COMPARTILHE O C√ìDIGO DE CONVITE COM OS JOGADORES
                          </span>
                        </li>
                        <li className="flex items-start gap-2">
                          <span className="text-blue-500 font-bold">2.</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            ELES DEVEM USAR O C√ìDIGO NA TELA "ENTRAR EM EQUIPE"
                          </span>
                        </li>
                        <li className="flex items-start gap-2">
                          <span className="text-blue-500 font-bold">3.</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            OS NOVOS MEMBROS APARECER√ÉO AUTOMATICAMENTE AQUI
                          </span>
                        </li>
                      </ol>

                      <div className="mt-4 p-3 bg-yellow-50 border border-yellow-300 rounded">
                        <p className={`${silkscreenFont} text-xs text-yellow-800`}>
                          üí° DICA: CLIQUE EM "COPIAR" PARA FACILITAR O COMPARTILHAMENTO
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Save button */}
              <div className="flex justify-center mt-8">
                <Button
                  onClick={handleSaveChanges}
                  disabled={!teamName.trim() || updateTeamMutation.isPending}
                  className={`${buttonBaseStyle} px-8 py-3 bg-[#29D8FF] hover:bg-[#20B4D2] text-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] disabled:opacity-50 disabled:cursor-not-allowed`}
                >
                  {updateTeamMutation.isPending ? (
                    <>
                      <div className="animate-spin rounded-full h-4 w-4 border-2 border-black border-t-transparent mr-2"></div>
                      SALVANDO...
                    </>
                  ) : (
                    <>
                      <Settings size={18} className="mr-2" />
                      SALVAR ALTERA√á√ïES
                    </>
                  )}
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default EditarEquipePage;
</file>

<file path="src/pages/Tutorial/TutorialPage.tsx">
import { useState, useEffect } from "react";
import { Button } from "../../components/ui/button";
import { ArrowLeft, Home } from 'lucide-react'; 
import { ButtonHomeBack } from "@/components/ButtonHomeBack";
import { useNavigate } from "react-router-dom";

export const TutorialPage = () => {
  const navigate = useNavigate();
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  
  useEffect(() => {
    const token = localStorage.getItem('userToken');
    setIsLoggedIn(!!token);
    
  }, []);

  const tutorialSteps = [
    {
      number: "1)",
      title: "ESCOLHA UM NOME PARA SUA EQUIPE.",
      description: "DEFINA OS MEMBROS E ATRIBUA FUN√á√ïES ESTRAT√âGICAS."
    },
    {
      number: "2)",
      title: "ESCOLHA O TIPO E QUANTIDADE DE CAMINH√ïES.",
      description: "DEFINA A MELHOR ROTA CONSIDERANDO CUSTO E TEMPO. RESERVE UM OR√áAMENTO PARA EMERG√äNCIAS."
    },
    {
      number: "3)",
      title: "O JOGO SIMULA O TRANSPORTE EM TEMPO REAL.",
      description: "EVENTOS ALEAT√ìRIOS PODEM IMPACTAR A VIAGEM! VOC√ä PODE TOMAR DECIS√ïES PARA MINIMIZAR ATRASOS E CUSTOS."
    },
    {
      number: "4)",
      title: "VOC√ä SER√Å AVALIADO COM BASE EM:",
      description: (
        <div className="flex flex-col">
          <div className="flex items-start">
            <div className="w-5 h-5 bg-green-500 mr-2 mt-1"></div>
            <span>EFICI√äNCIA DE CUSTOS.</span>
          </div>
          <div className="flex items-start">
            <div className="w-5 h-5 bg-blue-500 mr-2 mt-1"></div>
            <span>CUMPRIMENTO DO PRAZO.</span>
          </div>
          <div className="flex items-start">
            <div className="w-5 h-5 bg-orange-500 mr-2 mt-1"></div>
            <span>CRIATIVIDADE NA RESOLU√á√ÉO DE PROBLEMAS.</span>
          </div>
        </div>
      )
    }
  ];

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(32,2,89,1)_0%,rgba(121,70,213,1)_100%)] relative overflow-hidden">
        {}
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right"
          alt="Cloud decoration"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration"
          src="/nuvemright.png"
        />

        {}
        <div className="flex gap-5 absolute top-14 left-[33px]">
          <ButtonHomeBack onClick={() => navigate(-1)}><ArrowLeft/></ButtonHomeBack>
          <ButtonHomeBack onClick={() => navigate("/perfil")}><Home/></ButtonHomeBack>
        </div>

        {}
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[70%] max-w-[750px]">
          <div className="bg-white rounded-[18px] border-2 border-solid border-black p-6">
            {}
            <h1 className="text-center text-[35px] [font-family:'Silkscreen',Helvetica] font-bold mb-6">
              TUTORIAL
            </h1>

            {}
            <p className="text-center [font-family:'Silkscreen',Helvetica] text-[14px] mb-6">
              NESTE JOGO, VOC√ä ASSUMIR√Å O PAPEL DE UMA EMPRESA DE LOG√çSTICA E PRECISAR√Å PLANEJAR E
              EXECUTAR A ENTREGA DE MERCADORIAS DA FORMA MAIS EFICIENTE POSS√çVEL.
            </p>

            {}
            <div className="grid grid-cols-2 gap-6 mb-6">
              {tutorialSteps.map((step, index) => (
                <div key={index} className="flex">
                  <div className="mr-3">
                    <div className="text-[24px] [font-family:'Silkscreen',Helvetica] font-bold text-[#e3922a]">
                      {step.number}
                    </div>
                  </div>
                  <div>
                    <h3 className="[font-family:'Silkscreen',Helvetica] font-bold text-[14px]">
                      {step.title}
                    </h3>
                    <div className="[font-family:'Silkscreen',Helvetica] text-[12px] mt-1">
                      {step.description}
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {}
            <p className="text-center [font-family:'Silkscreen',Helvetica] text-[12px] mb-6">
              AGORA QUE VOC√ä CONHECE AS REGRAS, EST√Å PRONTO PARA O DESAFIO BOA SORTE!
            </p>
            
              <div className="flex justify-center">
                <Button 
                  onClick={() => navigate("/desafio")}
                  className="w-[230px] px-36 h-[45px] bg-[#e3922a] rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[26px] hover:bg-[#e3922a] transform transition-transform duration-300 hover:scale-105"
                >
                  INICIAR JOGO
                </Button>
              </div>
            
          </div>
        </div>

        {}
      </div>
    </div>
  );
};

export default TutorialPage;
</file>

<file path="index.html">
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Jogos Log√≠sticos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&family=Signika:wght@700&display=swap"
    rel="stylesheet">
  <link href="./src/index.css" rel="stylesheet" />
  <link href="./src/App.css" rel="stylesheet" />
</head>

<body>
  <div id="app"></div>
  <script type="module" src="./src/main.tsx"></script>
</body>

</html>
</file>

<file path="src/pages/Ranking/RankingPage.tsx">
import { useNavigate, useLocation } from "react-router-dom";
import { useState } from "react";
import { Button } from "../../components/ui/button"; 
import {
  Card,
  CardContent,
} from "../../components/ui/card"; 
import {
  ArrowLeft,
  Trophy,
  TrendingUp,
  Package,
  Target,
} from 'lucide-react';

interface TeamRanking {
  position: number;
  name: string;
  points: number;
  deliveries: number;
  efficiency: number;
  icon: string;
}

interface UserStats {
  position: number;
  points: number;
  deliveries: number;
  efficiency: number;
}

export const RankingPage = () => {
  const navigate = useNavigate();
  const location = useLocation();
  
  const [activeTab, setActiveTab] = useState<'PONTOS' | 'ENTREGAS' | 'EFICIENCIA'>('PONTOS');
  
  // Verifica se veio da tela de perfil atrav√©s do state da navega√ß√£o
  const cameFromProfile = location.state?.from === 'profile';
  
  const userStats: UserStats = {
    position: 4,
    points: 1000,
    deliveries: 4,
    efficiency: 95
  };

  const teamRankings: TeamRanking[] = [
    {
      position: 1,
      name: "FRUIT VALE",
      points: 1200,
      deliveries: 126,
      efficiency: 98,
      icon: "üèÜ"
    },
    {
      position: 2,
      name: "DEU VALE",
      points: 1000,
      deliveries: 110,
      efficiency: 92,
      icon: "ü•à"
    },
    {
      position: 3,
      name: "DEU MOLE",
      points: 999,
      deliveries: 99,
      efficiency: 89,
      icon: "ü•â"
    },
    {
      position: 4,
      name: "√â VAPO",
      points: 935,
      deliveries: 95,
      efficiency: 100,
      icon: "4"
    },
    {
      position: 5,
      name: "SCAN AI",
      points: 940,
      deliveries: 60,
      efficiency: 100,
      icon: "5"
    },
    {
      position: 6,
      name: "SACI",
      points: 299,
      deliveries: 10,
      efficiency: 80,
      icon: "6"
    }
  ];

  const handleNavigateBack = () => {
    if (cameFromProfile) {
      // Se veio do perfil, volta para o perfil
      navigate("/perfil");
    } else {
      // Caso contr√°rio, usa a navega√ß√£o padr√£o (voltar na hist√≥ria)
      navigate(-1);
    }
  };

  const handleOkClick = () => {
    if (cameFromProfile) {
      // Se veio do perfil, volta para o perfil
      navigate("/perfil");
    } else {
      // Caso contr√°rio, vai para o perfil (n√£o para home/login)
      navigate("/choose-team");
    }
  };

  const getPositionIcon = (position: number) => {
    switch (position) {
      case 1:
        return "üèÜ";
      case 2:
        return "ü•à";
      case 3:
        return "ü•â";
      default:
        return position.toString();
    }
  };

  const getRowColor = (position: number) => {
    switch (position) {
      case 1:
        return "bg-yellow-100 border-yellow-300";
      case 2:
        return "bg-gray-100 border-gray-300";
      case 3:
        return "bg-orange-100 border-orange-300";
      default:
        return "bg-white border-gray-200";
    }
  };

  const getSortedData = () => {
    switch (activeTab) {
      case 'ENTREGAS':
        return [...teamRankings].sort((a, b) => b.deliveries - a.deliveries);
      case 'EFICIENCIA':
        return [...teamRankings].sort((a, b) => b.efficiency - a.efficiency);
      default:
        return [...teamRankings].sort((a, b) => b.points - a.points);
    }
  };

  const getValueByTab = (team: TeamRanking) => {
    switch (activeTab) {
      case 'ENTREGAS':
        return team.deliveries;
      case 'EFICIENCIA':
        return `${team.efficiency}%`;
      default:
        return team.points;
    }
  };

  const silkscreenFont = "[font-family:'Silkscreen',Helvetica]";
  const buttonBaseStyle = `${silkscreenFont} border-2 border-black rounded-md px-4 py-2 text-xs font-bold flex items-center justify-center transition-all`;

  return (
    <div className="bg-white w-full h-screen overflow-hidden">
      <div className={`w-full h-full [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden ${silkscreenFont}`}>
        {/* Decorative clouds */}
        <img
          className="w-[375px] h-[147px] absolute top-[80px] left-[calc(50%_-_650px)] object-cover animate-float-right opacity-80 z-0"
          alt="Cloud decoration left"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[calc(50%_-_700px)] object-cover animate-float-left opacity-75 scale-110 z-0"
          alt="Cloud decoration right"
          src="/nuvemright.png"
        />

        {/* Navigation buttons - s√≥ mostra se veio do perfil */}
        {cameFromProfile && (
          <div className="absolute top-4 left-4 z-20">
            <Button onClick={handleNavigateBack} variant="outline" className="p-2 bg-white border-2 border-black rounded-md hover:bg-gray-200">
              <ArrowLeft size={24} className="text-black" />
            </Button>
          </div>
        )}
        
        {/* Main content */}
        <div className="h-full flex items-center justify-center px-4 relative z-10">
          <div className="max-w-4xl w-full">
            <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
              <CardContent className="p-4">
                {/* Header */}
                <div className="text-center mb-4">
                  <h1 className={`${silkscreenFont} text-xl font-bold text-[#E3922A]`} style={{textShadow: "2px 3px 0.6px #000"}}>
                    RANKING
                  </h1>
                </div>

                {/* User position card */}
                <div className="mb-4">
                  <Card className="bg-yellow-50 border-2 border-yellow-400 rounded-lg">
                    <CardContent className="p-3">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 bg-yellow-400 border-2 border-black rounded-full flex items-center justify-center">
                            <Trophy size={20} className="text-black" />
                          </div>
                          <div>
                            <p className={`${silkscreenFont} text-xs text-gray-600 mb-1`}>SUA POSI√á√ÉO</p>
                            <p className={`${silkscreenFont} text-lg font-bold text-black`}>{userStats.position}¬∞</p>
                          </div>
                        </div>
                        <div className="text-right">
                          <div className="grid grid-cols-3 gap-3 text-center">
                            <div>
                              <p className={`${silkscreenFont} text-xs text-gray-600 mb-1`}>PONTOS</p>
                              <p className={`${silkscreenFont} text-sm font-bold text-black`}>{userStats.points}</p>
                            </div>
                            <div>
                              <p className={`${silkscreenFont} text-xs text-gray-600 mb-1`}>ENTREGAS</p>
                              <p className={`${silkscreenFont} text-sm font-bold text-black`}>{userStats.deliveries}</p>
                            </div>
                            <div>
                              <p className={`${silkscreenFont} text-xs text-gray-600 mb-1`}>EFICI√äNCIA</p>
                              <p className={`${silkscreenFont} text-sm font-bold text-black`}>{userStats.efficiency}%</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Tab buttons */}
                <div className="flex justify-center mb-4">
                  <div className="flex border-2 border-black rounded-md overflow-hidden">
                    <Button
                      onClick={() => setActiveTab('PONTOS')}
                      className={`${silkscreenFont} text-xs font-bold px-3 py-2 border-r-2 border-black rounded-none ${
                        activeTab === 'PONTOS' 
                          ? 'bg-blue-500 text-white' 
                          : 'bg-white text-black hover:bg-gray-100'
                      }`}
                    >
                      <TrendingUp size={12} className="mr-1" />
                      PONTOS
                    </Button>
                    <Button
                      onClick={() => setActiveTab('ENTREGAS')}
                      className={`${silkscreenFont} text-xs font-bold px-3 py-2 border-r-2 border-black rounded-none ${
                        activeTab === 'ENTREGAS' 
                          ? 'bg-blue-500 text-white' 
                          : 'bg-white text-black hover:bg-gray-100'
                      }`}
                    >
                      <Package size={12} className="mr-1" />
                      ENTREGAS
                    </Button>
                    <Button
                      onClick={() => setActiveTab('EFICIENCIA')}
                      className={`${silkscreenFont} text-xs font-bold px-3 py-2 rounded-none ${
                        activeTab === 'EFICIENCIA' 
                          ? 'bg-blue-500 text-white' 
                          : 'bg-white text-black hover:bg-gray-100'
                      }`}
                    >
                      <Target size={12} className="mr-1" />
                      EFICI√äNCIA
                    </Button>
                  </div>
                </div>

                {/* Ranking table */}
                <div className="overflow-hidden border-2 border-black rounded-lg mb-4">
                  {/* Table header */}
                  <div className="grid grid-cols-4 bg-gray-200 border-b-2 border-black">
                    <div className={`${silkscreenFont} text-xs font-bold p-2 text-center border-r-2 border-black`}>#</div>
                    <div className={`${silkscreenFont} text-xs font-bold p-2 text-center border-r-2 border-black`}>EQUIPE</div>
                    <div className={`${silkscreenFont} text-xs font-bold p-2 text-center border-r-2 border-black`}>
                      {activeTab === 'PONTOS' ? 'PONTOS' : activeTab === 'ENTREGAS' ? 'ENTREGAS' : 'EFICI√äNCIA'}
                    </div>
                    <div className={`${silkscreenFont} text-xs font-bold p-2 text-center`}>
                      {activeTab === 'PONTOS' ? 'ENTREGAS' : activeTab === 'ENTREGAS' ? 'EFICI√äNCIA' : 'PONTOS'}
                    </div>
                  </div>

                  {/* Table rows */}
                  {getSortedData().map((team, index) => (
                    <div 
                      key={team.name} 
                      className={`grid grid-cols-4 border-b border-gray-300 last:border-b-0 ${getRowColor(index + 1)}`}
                    >
                      <div className={`${silkscreenFont} text-sm font-bold p-2 text-center border-r border-gray-300 flex items-center justify-center`}>
                        <span className="text-lg">{getPositionIcon(index + 1)}</span>
                      </div>
                      <div className={`${silkscreenFont} text-sm font-bold p-2 border-r border-gray-300 flex items-center`}>
                        {team.name}
                      </div>
                      <div className={`${silkscreenFont} text-sm p-2 text-center border-r border-gray-300 flex items-center justify-center`}>
                        {getValueByTab(team)}
                      </div>
                      <div className={`${silkscreenFont} text-sm p-2 text-center flex items-center justify-center`}>
                        {activeTab === 'PONTOS' ? team.deliveries : 
                         activeTab === 'ENTREGAS' ? `${team.efficiency}%` : 
                         team.points}
                      </div>
                    </div>
                  ))}
                </div>

                {/* OK button */}
                <div className="flex justify-center">
                  <Button 
                    onClick={handleOkClick}
                    className={`${buttonBaseStyle} px-6 py-2 bg-[#E3922A] hover:bg-[#D4821A] text-white shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px]`}
                  >
                    OK
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
};

export default RankingPage;
</file>

<file path="src/types/index.ts">
// src/types/index.ts

export interface TeamHistory {
  id: string;
  name: string;
  stats: {
    people: number;
    trophy: number;
    tasks?: number;
  };
  color: string;
}

export interface Team {
  id: number;
  nome: string;
  stats: {
    people: number;
    trophy: number;
    trucks?: number;
    tasks?: number;
  };
  color?: string;
  selected?: boolean;
  history?: TeamHistory[];
}

export interface Map {
  id: number;
  nome: string;
  descricao: string;
  rotas: any[]; // Pode ser tipado como Rota[] se necess√°rio
}

// NOVAS INTERFACES PARA EQUIPES
export interface TeamCreationData {
  nome: string;
  descricao?: string;
}

export interface TeamMember {
  id: number;
  nickname: string;
  username?: string;
  first_name?: string;
  last_name?: string;
  level?: number;
  xp?: number;
  avatar?: string;
}

export interface TeamDetails {
  id: number;
  nome: string;
  codigo: string;
  descricao?: string;
  lider: TeamMember;
  membros: TeamMember[];
  created_at: string;
  updated_at?: string;
}
</file>

<file path="src/pages/auth/Login/Login.tsx">
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { Button } from "../../../components/ui/button";
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "../../../components/ui/card";
import { Input } from "../../../components/ui/input";
import { ArrowLeft, House, AlertCircle } from 'lucide-react';
import { ButtonHomeBack } from "@/components/ButtonHomeBack";
import { useAuth } from "../../../contexts/AuthContext";

export const Login = () => {
  const navigate = useNavigate();
  const { login } = useAuth();
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");

  const handleForgotPassword = (e: React.MouseEvent) => {
    e.preventDefault();
    navigate("/forgot-password");
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!username || !password) {
      setError("Por favor, preencha todos os campos");
      return;
    }

    setLoading(true);
    setError("");

    try {
      await login(username, password);
      navigate("/ranking");
    } catch (error: any) {
      console.error("Erro completo de login:", error);
      if (error.response && error.response.status === 401) {
        setError("Nome de usu√°rio ou senha inv√°lidos");
      } else if (error.response && error.response.data) {
        if (error.response.data.detail) {
          setError(error.response.data.detail);
        } else if (typeof error.response.data === 'object') {
          try {
            const errorMessages = Object.entries(error.response.data)
              .map(([key, value]) => Array.isArray(value) ? value.join(", ") : `${key}: ${value}`)
              .join("; ");
            setError(errorMessages);
          } catch (e) {
            setError("Falha ao realizar login. Verifique suas credenciais.");
          }
        } else {
          setError("Falha ao realizar login. Verifique suas credenciais.");
        }
      } else if (error.request) {
        setError("O servidor n√£o respondeu. Verifique sua conex√£o.");
      } else {
        setError("Erro de conex√£o. Tente novamente mais tarde.");
      }
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(32,2,89,1)_0%,rgba(121,70,213,1)_100%)] relative overflow-hidden">
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right"
          alt="Nuvem"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110"
          alt="Nuvem"
          src="/nuvemright.png"
        />

        <div className="flex gap-5 absolute top-14 left-[33px]">
          <ButtonHomeBack onClick={() => navigate("/")}><ArrowLeft /></ButtonHomeBack>
          <ButtonHomeBack onClick={() => navigate("/")}><House /></ButtonHomeBack>
        </div>

        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
          <Card className="w-[700px] h-auto rounded-[18px] border-2 border-solid border-black bg-white">
            <CardHeader className="pb-0">
              <CardTitle className="text-[35px] text-center [font-family:'Silkscreen',Helvetica] font-bold">
                LOGIN
              </CardTitle>
            </CardHeader>
            <CardContent className="pt-1 px-[45px]">
              <form className="space-y-2" onSubmit={handleSubmit}>
                <div className="space-y-2">
                  <label
                    htmlFor="username"
                    className="block [font-family:'Silkscreen',Helvetica] font-bold text-black text-[25px]"
                  >
                    Usu√°rio
                  </label>
                  <Input
                    id="username"
                    type="text"
                    className="h-[55px] rounded-xl border border-solid border-black [font-family:'Silkscreen',Helvetica] text-[20px]"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                  />
                </div>

                <div className="space-y-2">
                  <label
                    htmlFor="password"
                    className="block [font-family:'Silkscreen',Helvetica] font-bold text-black text-[25px]"
                  >
                    Senha
                  </label>
                  <Input
                    id="password"
                    type="password"
                    className="h-[55px] rounded-xl border border-solid border-black [font-family:'Silkscreen',Helvetica] text-[20px]"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                  />
                </div>

                {error && (
                  <div className="text-red-500 flex items-center gap-2 my-2">
                    <AlertCircle size={20} />
                    <span>{error}</span>
                  </div>
                )}

                <div className="flex justify-end">
                  <a
                    href="#"
                    onClick={handleForgotPassword}
                    className="[font-family:'Silkscreen',Helvetica] font-normal text-[#167dd2] underline text-[20px]"
                  >
                    Esqueci a senha
                  </a>
                </div>

                <div className="flex justify-between pt-4">
                  <Button
                    type="button"
                    onClick={() => navigate("/cadastro")}
                    className="w-[274px] h-[53px] bg-[#e3922a] rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[25px] hover:bg-[#e3922a] transform transition-transform duration-300 hover:scale-105">
                    Cadastro
                  </Button>
                  <Button
                    type="submit"
                    disabled={loading}
                    className="w-[274px] h-[53px] bg-[#e3922a] rounded-md [font-family:'Silkscreen',Helvetica] font-bold text-black text-[25px] hover:bg-[#e3922a] transform transition-transform duration-300 hover:scale-105">
                    {loading ? "Carregando..." : "Login"}
                  </Button>
                </div>
              </form>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/pages/GameSelection/GameSelectionPage.tsx">
import React from 'react';
import { useNavigate } from "react-router-dom";
import { useQuery } from '@tanstack/react-query';
import GameCard from './components/GameCard';
import PixelHeading from './components/PixelHeading';
import Footer from './components/Footer';
import { ArrowLeft, ImageIcon, Loader, AlertTriangle } from 'lucide-react';
import { ButtonHomeBack } from '@/components/ButtonHomeBack';
import { GameService } from '@/api/gameService';
import { Map as GameMap } from '@/types';

const GameSelectionPage = () => {
  const navigate = useNavigate();

  // Buscando os dados da API
  const { data: maps, isLoading, isError } = useQuery<GameMap[]>({
    queryKey: ['maps'],
    queryFn: GameService.getMaps,
  });

  // L√≥gica de navega√ß√£o baseada no NOME do mapa
  const handleGameClick = (map: GameMap) => {
    // Se o mapa for "ENTREGA EFICIENTE"
    if (map.nome === "ENTREGA EFICIENTE") {
      navigate('/tutorial'); // Leva para a tela de tutorial
    } else {
      // Para outros jogos, mostra alerta de "em desenvolvimento"
      alert(`O jogo "${map.nome}" ainda est√° em desenvolvimento!`);
      // navigate('/desafio', { state: { map } }); // Descomente quando a l√≥gica estiver pronta
    }
  };

  // Fun√ß√£o de configura√ß√£o que usa o NOME do mapa vindo da API
  const getGameConfig = (mapName: string) => {
    // Mapeia o NOME do mapa para a configura√ß√£o visual
    switch (mapName) {
      case "ENTREGA EFICIENTE":
        return {
          borderColor: 'border-yellow-500',
          buttonBgColor: 'bg-yellow-500',
          buttonHoverColor: 'hover:bg-yellow-600',
          isActive: true, // Este jogo est√° ATIVO
        };
      case "Centro de Distribui√ß√£o":
        return {
          borderColor: 'border-green-400',
          buttonBgColor: 'bg-green-300',
          buttonHoverColor: 'hover:bg-green-400',
          isActive: false, // Este jogo est√° INATIVO
        };
      case "Gest√£o de Estoque":
        return {
          borderColor: 'border-blue-400',
          buttonBgColor: 'bg-blue-300',
          buttonHoverColor: 'hover:bg-blue-400',
          isActive: false, // Este jogo est√° INATIVO
        };
      // Configura√ß√£o padr√£o para qualquer outro mapa que possa existir
      default:
        return {
          borderColor: 'border-gray-400',
          buttonBgColor: 'bg-gray-300',
          buttonHoverColor: 'hover:bg-gray-400',
          isActive: false,
        };
    }
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gradient-to-b from-purple-900 to-indigo-800 flex items-center justify-center">
        <div className="text-white text-center text-2xl flex items-center" style={{ fontFamily: "'Press Start 2P', cursive" }}>
          <Loader className="mr-4 animate-spin" />
          Carregando Jogos...
        </div>
      </div>
    );
  }

  if (isError) {
    return (
      <div className="min-h-screen bg-gradient-to-b from-purple-900 to-indigo-800 flex items-center justify-center">
        <div className="text-red-500 text-center text-2xl flex items-center" style={{ fontFamily: "'Press Start 2P', cursive" }}>
          <AlertTriangle className="mr-2" />
          Erro ao carregar os jogos.
        </div>
      </div>
    );
  }

  return (
    <div
      className="min-h-screen bg-gradient-to-b from-purple-900 to-indigo-800 flex flex-col items-center justify-between py-12 px-4"
      style={{ fontFamily: "'Press Start 2P', cursive" }}
    >
      <div className="flex gap-5 absolute top-14 left-[33px]">
        <ButtonHomeBack onClick={() => navigate(-1)}><ArrowLeft /></ButtonHomeBack>
      </div>

      <div className="w-full max-w-6xl flex flex-col items-center">
        <PixelHeading text="ESCOLHA SEU JOGO" className="mb-12 mt-8" />

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8 w-full">
          {maps?.map((map) => {
            // Passa o NOME do mapa para a fun√ß√£o de configura√ß√£o
            const config = getGameConfig(map.nome);
            return (
              <GameCard
                key={map.id}
                title={map.nome}
                description={map.descricao}
                isActive={config.isActive}
                onClick={() => config.isActive && handleGameClick(map)}
                borderColor={config.borderColor}
                buttonBgColor={config.buttonBgColor}
                buttonHoverColor={config.buttonHoverColor}
                icon={<ImageIcon className="w-12 h-12" />}
              />
            );
          })}
        </div>
      </div>

      <Footer />
    </div>
  );
};

export default GameSelectionPage;
</file>

<file path="src/pages/mapaRota/routesData.ts">
// src/pages/mapaRota/routesData.ts

// Importa√ß√µes dos caminhos das rotas
import { route1Path } from './paths/route1Path';
import { route2Path } from './paths/route2Path';
import { route3Path } from './paths/route3Path';
import { route4Path } from './paths/route4Path';

// ==================== INTERFACES ====================

// Interface para segmentos de estrada de terra
export interface DirtSegment {
  startKm: number;        // Km inicial do trecho de terra (relativo ao in√≠cio da rota)
  endKm: number;          // Km final do trecho de terra
  condition: 'leve' | 'moderada' | 'severa';  // Qualidade do trecho de terra
  eventChance: number;    // Probabilidade de um evento ocorrer (0.0 a 1.0)
  speedFactor: number;    // Fator de redu√ß√£o de velocidade (ex: 0.7 para 70% da velocidade normal)
  description?: string;   // Descri√ß√£o opcional do trecho
}

// Interface principal para defini√ß√£o de rotas
export interface Route {
  routeId: number;
  name: string;
  distance: number;
  estimatedTime: string;
  estimatedTimeHours: number;
  cities: string[];
  roads: string[];
  startCoordinates: [number, number];
  endCoordinates: [number, number];
  waypoints?: [number, number][];

  // Informa√ß√µes de ped√°gios
  tollBooths: {
    totalCost: number;
    location: string;
    costPerAxle: number;
    totalCostExample4Axles: number;
    coordinates: [number, number];
  }[];

  // Limites de velocidade por estrada
  speedLimits: {
    road: string;
    limit: string,
    value?: number,
    coordinates?: [number, number]
  }[];



  // Informa√ß√µes de seguran√ßa
  safety: {
    robberyRisk: 'Baixo' | 'M√©dio' | 'Alto';
    roadHazards: string;
  };

  // Condi√ß√µes da estrada
  dirtRoad: boolean;
  dirtRoadDetails?: string;
  roadConditions: 'Boa' | 'Regular' | 'Ruim';
  constructionZones?: string;

  // Pontos de interesse e paradas
  pois?: {
    type: 'construction' | 'danger' | 'rest' | 'gas';
    location: string;
    description: string;
    coordinates: [number, number];
  }[];

  restStops?: {
    location: string;
    description: string;
    coordinates: [number, number];
    type: 'rest' | 'construction' | 'gas' | 'toll' | 'danger';
  }[];

  // Custos e coordenadas
  fuelCostPerKm: number;
  dangerZonesDetails?: string;
  pathCoordinates?: [number, number][];
  actualDistance?: number;
  actualDuration?: number;

  // Zonas de perigo
  dangerZones?: {
    location: string;
    startKm: number;
    description: string;
    coordinates: [number, number];
    riskLevel: 'Baixo' | 'M√©dio' | 'Alto';
  }[];

  dirtSegments?: DirtSegment[];
}

// ==================== FUN√á√ïES UTILIT√ÅRIAS ====================

// Fun√ß√£o para converter string de tempo em horas decimais
export const parseEstimatedTime = (timeStr: string): number => {
  // Formato "7h30min" ou "7H30"
  const timeMatch = timeStr.match(/(\d+)[hH]?(\d+)?m?i?n?/);
  if (timeMatch) {
    const hours = parseInt(timeMatch[1], 10);
    const minutes = timeMatch[2] ? parseInt(timeMatch[2], 10) : 0;
    return hours + minutes / 60;
  }

  // Formato "7-8h" (range)
  const parts = timeStr.match(/(\d+)\s*-\s*(\d+)?h/i);
  if (parts) {
    const minHours = parseInt(parts[1], 10);
    const maxHours = parts[2] ? parseInt(parts[2], 10) : minHours;
    return (minHours + maxHours) / 2;
  }

  // Formato simples "7h"
  const singleHourMatch = timeStr.match(/(\d+)h/i);
  if (singleHourMatch) {
    return parseInt(singleHourMatch[1], 10);
  }

  return 0;
};

// ==================== DEFINI√á√ÉO DAS ROTAS ====================

export const routes: Route[] = [
  // ROTA 1: Padr√£o/Eficiente
  {
    routeId: 1,
    name: "Rota Padr√£o: Juazeiro-Salvador via BR-407 e BR-324 (Eficiente)",
    distance: 513,
    estimatedTime: "7h30min",
    estimatedTimeHours: parseEstimatedTime("7h30min"),

    cities: [
      "Juazeiro", "Jaguarari", "Senhor do Bonfim", "Ponto Novo",
      "Capim Grosso", "Riach√£o do Jacu√≠pe", "Feira de Santana",
      "Am√©lia Rodrigues", "Sim√µes Filho", "Salvador"
    ],

    roads: ["BR-407", "BR-324"],
    startCoordinates: [-9.449771, -40.524226],
    endCoordinates: [-12.954121, -38.471283],
    waypoints: [[-12.2667, -38.9667]],

    tollBooths: [
      {
        location: "BR-324 - Ped√°gio 02 - Via Bahia (Am√©lia Rodrigues)",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.447111365070798, -38.71353301661456],
        totalCost: 0
      },
      {
        location: "BR-324 - BASE DE APOIO - VIA BAHIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.51369524173777, -38.62460652443481],
        totalCost: 0
      },
      {
        location: "BR-324 - Ped√°gio 01 - Via Bahia (Sim√µes Filho)",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.751127634778944, -38.43194853442343],
        totalCost: 0
      },
      {
        location: "BR-324 - BASE DE APOIO - VIA BAHIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.825310059845428, -38.40966558167229],
        totalCost: 0
      },
      {
        location: "Ped√°gio da Rodovia CIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.847055107561344, -38.36165344035957],
        totalCost: 0
      }
    ],

    speedLimits: [
      {
        road: "BR-407",
        limit: "80 km/h",
        value: 80,
        coordinates: [-9.990413, -40.239591],
      },
      {
        road: "BR-407",
        limit: "80 km/h",
        value: 80,
        coordinates: [-11.817558, -39.375948],
      },
      {
        road: "BR-407",
        limit: "60 km/h",
        value: 60,
        coordinates: [-10.517028, -40.142195]
      },
      {
        road: "BR-324",
        limit: "100 km/h",
        value: 100,
        coordinates: [-12.743087, -38.437596]
      },
      {
        road: "BR-324",
        limit: "50 km/h",
        value: 50,
        coordinates: [-12.447111365070798, -38.71353301661456]
      }
    ],

    safety: {
      robberyRisk: "M√©dio",
      roadHazards: "Tr√°fego intenso na BR-324 (Feira-Salvador). Risco de animais na BR-407. Pequeno trecho n√£o pavimentado."
    },

    dirtRoad: true,
    dirtRoadDetails: "Pequeno trecho n√£o pavimentado na BR-407 pr√≥ximo a √°reas rurais.",
    roadConditions: "Boa",
    constructionZones: "Manuten√ß√£o pontual na BR-324.",

    restStops: [{
      location: "Limite de velocidade de 50km/h",
      description: "radares pela rodovia de 50km/h",
      coordinates: [-12.447111365070798, -38.71353301661456],
      type: "gas"
    }],

    fuelCostPerKm: 4.50,
    dangerZonesDetails: "BR-324 (Feira-Salvador): alto fluxo. BR-407: animais, fadiga.",

    dangerZones: [
      {
        location: "Estradas secund√°rias em Nova F√°tima",
        description: "Vias isoladas e pouco policiadas",
        coordinates: [-11.6049, -39.6301],
        riskLevel: "M√©dio"
      },
      {
        location: "BR-324 pr√≥ximo a Feira de Santana",
        description: "Alto fluxo de ve√≠culos e hist√≥rico de roubos de carga",
        coordinates: [-12.2267, -38.9648],
        riskLevel: "Alto"
      },
      {
        location: "BR-407 trecho Jaguarari",
        description: "√Årea isolada com hist√≥rico de assaltos",
        coordinates: [-10.2550, -40.1924],
        riskLevel: "M√©dio"
      }
    ],

    dirtSegments: [{
      startKm: 180,
      endKm: 195,
      condition: 'leve',
      eventChance: 0.05,
      speedFactor: 0.85,
      description: "Trecho da BR-407 com pavimento deteriorado/em transi√ß√£o para terra."
    }],

    pathCoordinates: route1Path,
    actualDistance: 505.7681,
    actualDuration: 24512.5
  },

  // ROTA 2: Alternativa (Evitando Rodovias Expressas)
  {
    routeId: 2,
    name: "Rota Alternativa: Juazeiro-Salvador (Evitando Rodovias Expressas)",
    distance: 529,
    estimatedTime: "7h50min",
    estimatedTimeHours: parseEstimatedTime("7h50min"),

    cities: [
      "Juazeiro", "Jaguarari", "Senhor do Bonfim", "Filad√©lfia",
      "Ponto Novo", "Capim Grosso", "Nova F√°tima", "Riach√£o do Jacu√≠pe",
      "Tanquinho", "Feira de Santana", "Am√©lia Rodrigues", "Sim√µes Filho", "Salvador"
    ],

    roads: ["BR-407 (ou paralelas)", "BR-324 (ou paralelas/vias locais)"],
    startCoordinates: [-9.449771, -40.524226],
    endCoordinates: [-12.954121, -38.471283],

    tollBooths: [
      {
        location: "BR-324 - Ped√°gio 01 - Via Bahia (Sim√µes Filho)",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.751127634778944, -38.43194853442343],
        totalCost: 0
      },
      {
        location: "BR-324 - BASE DE APOIO - VIA BAHIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.825310059845428, -38.40966558167229],
        totalCost: 0
      }
    ],

    speedLimits: [
      {
        road: "BR-235",
        limit: "80 km/h",
        value: 80,
        coordinates: [-9.460458, -40.429308]
      },
      {
        road: "BR-235",
        limit: "40 km/h",
        value: 40,
        coordinates: [-12.193182, -38.418788]
      },
      {
        road: "BR-110",
        limit: "60 km/h",
        value: 60,
        coordinates: [-11.225797, -38.485761]
      },
      {
        road: "BR-324",
        limit: "100 km/h",
        value: 100,
        coordinates: [-12.5778, -38.5405]
      }
    ],

    safety: {
      robberyRisk: "M√©dio",
      roadHazards: "Qualidade vari√°vel em trechos alternativos, travessias urbanas frequentes."
    },

    dirtRoad: true,
    dirtRoadDetails: "V√°rios trechos n√£o pavimentados ou com asfalto ruim ao passar por Filad√©lfia e em desvios de cidades maiores.",
    roadConditions: "Regular",
    constructionZones: "Menos prov√°vel, mas vias alternativas podem ter m√° conserva√ß√£o.",

    restStops: [
      {
        location: "BR-324 - Pra√ßa Am√©lia Rodrigues",
        description: "Boa disponibilidade ao longo das BRs, especialmente Feira de Santana.",
        coordinates: [-38.763810, -12.398770],
        type: "rest"
      },
      {
        location: "BR-324 - Pra√ßa Am√©lia Rodrigues",
        description: "Boa disponibilidade ao longo das BRs, especialmente Feira de Santana.",
        coordinates: [-38.763810, -12.398770],
        type: "rest"
      }
    ],

    fuelCostPerKm: 4.65,
    dangerZonesDetails: "Vias alternativas com menor manuten√ß√£o, sinaliza√ß√£o prec√°ria.",

    dangerZones: [
      {
        location: "BR-235 ap√≥s Uau√°",
        description: "√Årea deserta e com pouco policiamento",
        coordinates: [-9.8367, -39.4890],
        riskLevel: "M√©dio"
      },
      {
        location: "Estradas secund√°rias em Canch√©",
        description: "Vias isoladas e pouco policiadas",
        coordinates: [-9.906043261891755, -38.78612677041902],
        riskLevel: "M√©dio"
      },
      {
        location: "Trecho entre xuqy√™ e Bjo. Grande",
        description: "√Åreas de vegeta√ß√£o densa facilitam emboscadas",
        coordinates: [-10.024041044108136, -38.51265879186026],
        riskLevel: "Alto"
      }
    ],

    dirtSegments: [
      {
        startKm: 150,
        endKm: 170,
        condition: 'moderada',
        eventChance: 0.15,
        speedFactor: 0.70,
        description: "Estrada vicinal n√£o pavimentada na regi√£o de Filad√©lfia."
      },
      {
        startKm: 350,
        endKm: 365,
        condition: 'leve',
        eventChance: 0.10,
        speedFactor: 0.80,
        description: "Trecho alternativo com pavimento irregular para evitar centro urbano."
      }
    ],

    pathCoordinates: route2Path,
    actualDistance: 658.2524000000001,
    actualDuration: 32789.1
  },

  // ROTA 3: Econ√¥mica (Evitando Ped√°gios)
  {
    routeId: 3,
    name: "Rota Econ√¥mica: Juazeiro-Salvador (Evitando Ped√°gios)",
    distance: 533,
    estimatedTime: "8h20min",
    estimatedTimeHours: parseEstimatedTime("8h20min"),

    cities: [
      "Juazeiro", "Jaguarari", "Senhor do Bonfim", "Capim Grosso",
      "Riach√£o do Jacu√≠pe", "Feira de Santana", "Santan√≥polis",
      "Concei√ß√£o da Feira", "Candeias", "Sim√µes Filho", "Salvador"
    ],

    roads: ["BR-407", "BR-324 (trechos)", "BA-504", "BA-506", "Estradas Municipais"],
    startCoordinates: [-9.449771, -40.524226],
    endCoordinates: [-12.954121, -38.471283],

    tollBooths: [{
      location: "BR-324 - BASE DE APOIO - VIA BAHIA",
      costPerAxle: 3.50,
      totalCostExample4Axles: 14.00,
      coordinates: [-12.825310059845428, -38.40966558167229],
      totalCost: 0
    }],

    speedLimits: [
      {
        road: "BR-407",
        limit: "80 km/h",
        value: 80,
        coordinates: [-9.990413, -40.239591],
      },
      {
        road: "BR-407",
        limit: "80 km/h",
        value: 80,
        coordinates: [-11.817558, -39.375948],
      },
      {
        road: "BR-407",
        limit: "60 km/h",
        value: 60,
        coordinates: [-10.517028, -40.142195]
      },
      {
        road: "BR-324",
        limit: "100 km/h",
        value: 100,
        coordinates: [-12.743087, -38.437596]
      },
      {
        road: "BR-324",
        limit: "40 km/h",
        value: 40,
        coordinates: [-12.630725, -38.622729]
      }
    ],

    safety: {
      robberyRisk: "M√©dio",
      roadHazards: "Desvios por estradas locais com baixa manuten√ß√£o, m√° sinaliza√ß√£o."
    },

    dirtRoad: true,
    dirtRoadDetails: "Extensos trechos de estradas de terra ou mal conservadas nos desvios para evitar ped√°gios, especialmente entre Santan√≥polis e Candeias.",
    roadConditions: "Ruim",
    constructionZones: "Improv√°vel em desvios, mas vias podem estar danificadas.",

    restStops: [
      {
        location: "BR-324 - Pra√ßa Am√©lia Rodrigues",
        description: "Boa disponibilidade ao longo das BRs, especialmente Feira de Santana.",
        coordinates: [-38.763810, -12.398770],
        type: "rest"
      },
      {
        location: "BR-324 - Pra√ßa Am√©lia Rodrigues",
        description: "Boa disponibilidade ao longo das BRs, especialmente Feira de Santana.",
        coordinates: [-38.763810, -12.398770],
        type: "rest"
      }
    ],

    fuelCostPerKm: 4.80,
    dangerZonesDetails: "Desvios por vias n√£o pavimentadas/mal conservadas, isoladas.",

    dangerZones: [
      {
        location: "Estradas secund√°rias em Nova F√°tima",
        startKm: 121,
        description: "Vias isoladas e pouco policiadas",
        coordinates: [-11.6049, -39.6301],
        riskLevel: "M√©dio"
      },
      {
        location: "BR-324 pr√≥ximo a Feira de Santana",
        startKm: 454,
        description: "Alto fluxo de ve√≠culos e hist√≥rico de roubos de carga",
        coordinates: [-12.2267, -38.9648],
        riskLevel: "Alto"
      },
      {
        location: "BR-407 trecho Jaguarari",
        startKm: 121,
        description: "√Årea isolada com hist√≥rico de assaltos",
        coordinates: [-10.2550, -40.1924],
        riskLevel: "M√©dio"
      },
      {
        location: "Desvio em Santan√≥polis",
        startKm: 479,
        description: "Estrada secund√°ria com pouca ilumina√ß√£o e fluxo",
        coordinates: [-12.5025, -39.0013],
        riskLevel: "Alto"
      },
      {
        location: "Entrada para Candeias",
        startKm: 502,
        description: "Ponto conhecido de abordagens a caminh√µes",
        coordinates: [-12.6737, -38.5514],
        riskLevel: "Alto"
      }
    ],

    dirtSegments: [
      {
        startKm: 250,
        endKm: 280,
        condition: 'severa',
        eventChance: 0.25,
        speedFactor: 0.50,
        description: "Estrada municipal de terra em p√©ssimas condi√ß√µes como parte do desvio de ped√°gio."
      },
      {
        startKm: 400,
        endKm: 420,
        condition: 'moderada',
        eventChance: 0.20,
        speedFactor: 0.65,
        description: "Trecho de BA n√£o pavimentada ou com muitos buracos."
      }
    ],

    pathCoordinates: route3Path,
    actualDistance: 547.4595,
    actualDuration: 28439.700000000004
  },

  // ROTA 4: Via Uau√°
  {
    routeId: 4,
    name: "Rota via Uau√°: Juazeiro-Salvador (BR-235, BR-116, BR-324)",
    distance: 558,
    estimatedTime: "8h28min",
    estimatedTimeHours: parseEstimatedTime("8h28min"),

    cities: [
      "Juazeiro", "Uau√°", "Euclides da Cunha", "Teofil√¢ndia",
      "Serrinha", "Feira de Santana", "Sim√µes Filho", "Salvador"
    ],

    roads: ["BR-235", "BR-116", "BR-324"],
    startCoordinates: [-9.449771, -40.524226],
    endCoordinates: [-12.954121, -38.471283],
    waypoints: [[-9.8364, -39.4831]],

    tollBooths: [
      {
        location: "BR-324 - Ped√°gio 02 - Via Bahia (Am√©lia Rodrigues)",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.447111365070798, -38.71353301661456],
        totalCost: 0
      },
      {
        location: "BR-324 - BASE DE APOIO - VIA BAHIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.51369524173777, -38.62460652443481],
        totalCost: 0
      },
      {
        location: "BR-324 - Ped√°gio 01 - Via Bahia (Sim√µes Filho)",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.751127634778944, -38.43194853442343],
        totalCost: 0
      },
      {
        location: "BR-324 - BASE DE APOIO - VIA BAHIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.825310059845428, -38.40966558167229],
        totalCost: 0
      },
      {
        location: "Ped√°gio da Rodovia CIA",
        costPerAxle: 3.50,
        totalCostExample4Axles: 14.00,
        coordinates: [-12.847055107561344, -38.36165344035957],
        totalCost: 0
      }
    ],

    speedLimits: [
      {
        road: "BR-324",
        limit: "100 km/h",
        value: 100,
        coordinates: [-9.961578, -39.228228]
      },
      {
        road: "BR-324",
        limit: "100 km/h",
        value: 100,
        coordinates: [-10.961665, -38.791498]
      },
      {
        road: "BR-324",
        limit: "80 km/h",
        value: 80,
        coordinates: [-12.5778, -38.5405]
      },
      {
        road: "BR-324",
        limit: "50 km/h",
        value: 50,
        coordinates: [-12.7905, -38.4055]
      }
    ],

    safety: {
      robberyRisk: "M√©dio",
      roadHazards: "BR-235: trechos com pavimento irregular/obras. BR-116: tr√°fego intenso."
    },

    dirtRoad: true,
    dirtRoadDetails: "Trechos significativos da BR-235 antes de Euclides da Cunha com pavimento ruim ou em obras, podendo incluir desvios por terra.",
    roadConditions: "Regular",
    constructionZones: "Obras na BR-235. Manuten√ß√£o pontual BR-116/324.",

    restStops: [
      {
        location: "BR-324 - Pra√ßa Am√©lia Rodrigues",
        description: "Boa disponibilidade ao longo das BRs, especialmente Feira de Santana.",
        coordinates: [-38.763810, -12.398770],
        type: "rest"
      },
      {
        location: "BR-324 - Pra√ßa Am√©lia Rodrigues",
        description: "Boa disponibilidade ao longo das BRs, especialmente Feira de Santana.",
        coordinates: [-38.763810, -12.398770],
        type: "rest"
      }
    ],

    fuelCostPerKm: 4.85,
    dangerZonesDetails: "Isolamento e m√° conserva√ß√£o em trechos da BR-235. BR-116: pontos de acidente/roubo.",

    dangerZones: [
      {
        location: "BR-235 ap√≥s Uau√°",
        startKm: 90,
        description: "√Årea deserta e com pouco policiamento",
        coordinates: [-9.8367, -39.4890],
        riskLevel: "M√©dio"
      },
      {
        location: "BR-116 pr√≥ximo a Serrinha",
        startKm: 341,
        description: "Regi√£o com hist√≥rico de roubos de carga",
        coordinates: [-11.6664, -39.0009],
        riskLevel: "Alto"
      },
      {
        location: "BR-324 pr√≥ximo a Feira de Santana",
        startKm: 453,
        description: "Alto fluxo de ve√≠culos e hist√≥rico de roubos de carga",
        coordinates: [-12.2267, -38.9648],
        riskLevel: "Alto"
      }
    ],

    dirtSegments: [
      {
        startKm: 80,
        endKm: 120,
        condition: 'moderada',
        eventChance: 0.20,
        speedFactor: 0.70,
        description: "Longo trecho da BR-235 com obras e pavimento irregular, com poss√≠veis desvios por terra."
      },
      {
        startKm: 180,
        endKm: 190,
        condition: 'leve',
        eventChance: 0.10,
        speedFactor: 0.80,
        description: "Pequeno trecho da BR-235 com manuten√ß√£o pendente."
      }
    ],

    pathCoordinates: route4Path,
    actualDistance: 552.2648,
    actualDuration: 25854.400000000005
  }
];

// ==================== COORDENADAS DE REFER√äNCIA ====================
// Coordenadas comentadas para refer√™ncia das rotas (coment√°rios originais mantidos)

/* ROTA 1 - Coordenadas principais:
[-40.524226, -9.449771],     // Juazeiro, BA
[-40.19235517511953, -10.255016465477025], // Jaguarari, BA
[-40.1827195646563, -10.452630276902312],  // Senhor do Bonfim, BA
[-40.11148486357506, -10.86341165864542],  // Ponto Novo, BA
[-40.01159638752269, -11.379139470679446], // Capim Grosso, BA
[-39.38642607361227, -11.811744075350651], // Riach√£o do Jacu√≠pe, BA
[-38.9648952037257, -12.226149840077687],  // Feira de Santana, BA
[-38.76160923261481,-12.399765572679026],  // Am√©lia Rodrigues, BA
[-38.40554149637575, -12.790457469442282], // Sim√µes Filho, BA
[-38.471283, -12.954121]     // Salvador, BA
*/

/* ROTA 2 - Coordenadas principais:
[-40.524226, -9.449771],     // Juazeiro, BA
[-39.48895352884815, -9.8367178609971],    // Uau√°
[-39.030031433610205, -9.893492609800445], // Canudos
[-38.31968694052241, -10.091972274402044], // Jeremoabo
[-38.531984239515374, -10.834185129812898], // Ribeira do Pombal
[-38.32864850143622, -11.362384601650396], // Olindina
[-38.54051707214044, -12.577808594195744], // Rotat√≥ria
[-38.471283, -12.954121]     // Salvador, BA
*/

/* ROTA 3 - Coordenadas principais:
[-40.524226, -9.449771],     // Juazeiro, BA
[-40.19235517511953, -10.255016465477025], // Jaguarari, BA
[-40.1827195646563, -10.452630276902312],  // Senhor do Bonfim, BA
[-40.12199139370722, -10.734602645529307], // Filad√©lfia, BA
[-40.11148486357506, -10.86341165864542],  // Ponto Novo, BA
[-40.01159638752269, -11.379139470679446], // Capim Grosso, BA
[-39.63012308333791, -11.604910604561683], // Nova F√°tima, BA
[-39.386016513740714, -11.812002334906955], // Riach√£o do Jacu√≠pe, BA
[-39.105426135815016, -11.977888372700807], // Tanquinho, BA
[-38.96489118234495, -12.226633662941902], // Feira de Santana, BA
[-39.00125451098019, -12.502498182414648], // Concei√ß√£o da Feira, BA
[-38.93928270420547,-12.559478928789718],  // Bel√©m da Cachoeira
[-38.551409899588734, -12.673743454857682], // Candeias, BA
[-38.40554149637575, -12.790457469442282], // Sim√µes Filho, BA
[-38.471283, -12.954121]     // Salvador, BA
*/

/* ROTA 4 - Coordenadas principais:
[-40.524226, -9.449771],     // Juazeiro, BA
[-39.48895352884815, -9.8367178609971],    // Uau√°
[-39.01174091970563, -10.501687409845562], // Euclides da Cunha, BA
[-38.99623833743285, -11.482162269661481], // Teofil√¢ndia, BA
[-39.000897603993025, -11.666422677129212], // Serrinha, BA
[-38.96489118234495, -12.226633662941902], // Feira de Santana, BA
[-38.40554149637575, -12.790457469442282], // Sim√µes Filho, BA
[-38.471283, -12.954121]     // Salvador, BA
*/
</file>

<file path="src/pages/Perfil/CriarEquipe.tsx">
import { useNavigate } from "react-router-dom";
import { useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { Button } from "../../components/ui/button";
import { Card, CardContent } from "../../components/ui/card";
import { ArrowLeft, Settings, Crown, UserPlus } from 'lucide-react';
import { TeamService } from "../../api/teamService";
import { useAuth } from "../../contexts/AuthContext";

export const CriarEquipePage = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const { user, refreshUser } = useAuth();

  const [teamName, setTeamName] = useState("");
  const [description, setDescription] = useState("");

  const handleNavigateBack = () => {
    navigate("/choose-team");
  };

  const createTeamMutation = useMutation({
    mutationFn: (data: { nome: string; descricao?: string }) =>
      TeamService.createTeam(data),
    onSuccess: async (novaEquipe) => {
      alert(`Equipe "${novaEquipe.nome}" criada com sucesso!`);
      await refreshUser();
      queryClient.invalidateQueries({ queryKey: ['teams'] });
      navigate("/game-selection");
    },
    onError: (error: any) => {
      const errorMessage = error.response?.data?.detail ||
        error.response?.data?.nome?.[0] ||
        "Erro ao criar equipe.";
      alert(`Erro: ${errorMessage}`);
    }
  });

  const handleCreateTeam = () => {
    if (!teamName.trim()) {
      alert("O nome da equipe √© obrigat√≥rio.");
      return;
    }

    createTeamMutation.mutate({
      nome: teamName,
      descricao: description || undefined
    });
  };

  // Loading do contexto de autentica√ß√£o
  if (!user) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <div className="animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent mx-auto mb-4"></div>
              <p>Carregando...</p>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  // Verificar se usu√°rio j√° est√° em uma equipe
  if (user?.equipe) {
    return (
      <div className="bg-white flex flex-row justify-center w-full">
        <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden flex items-center justify-center">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-8">
            <div className="text-center">
              <h2 className="text-xl font-bold mb-4">Voc√™ j√° faz parte de uma equipe!</h2>
              <p className="mb-6">Voc√™ n√£o pode criar uma nova equipe enquanto estiver em outra.</p>
              <Button onClick={() => navigate("/perfil")} className="bg-blue-500 hover:bg-blue-600 text-white">
                Ir para Perfil
              </Button>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  const silkscreenFont = "[font-family:'Silkscreen',Helvetica]";
  const inputStyle = `bg-white border-2 border-black rounded-md p-2 w-full ${silkscreenFont} text-sm focus:outline-none focus:ring-2 focus:ring-blue-400`;
  const labelStyle = `text-xs ${silkscreenFont} mb-1 block text-black font-bold`;
  const buttonBaseStyle = `${silkscreenFont} border-2 border-black rounded-md px-4 py-2 text-xs font-bold flex items-center justify-center transition-all`;

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className={`w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden ${silkscreenFont}`}>
        {/* Decorative clouds */}
        <img
          className="w-[375px] h-[147px] absolute top-[80px] left-[calc(50%_-_650px)] object-cover animate-float-right opacity-80"
          alt="Cloud decoration left"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[calc(50%_-_700px)] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration right"
          src="/nuvemright.png"
        />

        {/* Back button */}
        <div className="absolute top-4 left-4 z-20">
          <Button onClick={handleNavigateBack} variant="outline" className="p-2 bg-white border-2 border-black rounded-md hover:bg-gray-200">
            <ArrowLeft size={24} className="text-black" />
          </Button>
        </div>

        {/* Main content */}
        <div className="max-w-4xl mx-auto pt-16 pb-8 px-4 relative z-10">
          <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <CardContent className="p-6">
              {/* Header */}
              <div className="text-center mb-6">
                <h1 className={`${silkscreenFont} text-xl font-bold text-[#E3922A] border-2 border-black bg-gray-100 py-2 px-4 rounded-md inline-block`}>
                  CRIAR EQUIPE
                </h1>
              </div>

              {/* FORMUL√ÅRIO PRINCIPAL */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Left column - Team info */}
                <div className="space-y-4">
                  {/* Team name */}
                  <div>
                    <label htmlFor="teamName" className={labelStyle}>
                      NOME DA EQUIPE
                    </label>
                    <input
                      type="text"
                      name="teamName"
                      id="teamName"
                      value={teamName}
                      onChange={(e) => setTeamName(e.target.value)}
                      placeholder="DIGITE O NOME DA EQUIPE"
                      className={inputStyle}
                      disabled={createTeamMutation.isPending}
                    />
                  </div>

                  {/* Description */}
                  <div>
                    <label htmlFor="description" className={labelStyle}>
                      DESCRI√á√ÉO (OPCIONAL)
                    </label>
                    <textarea
                      name="description"
                      id="description"
                      value={description}
                      onChange={(e) => setDescription(e.target.value)}
                      placeholder="DIGITE UMA DESCRI√á√ÉO PARA A EQUIPE"
                      className={`${inputStyle} h-20 resize-none`}
                      disabled={createTeamMutation.isPending}
                    />
                  </div>

                  {/* Invite code */}
                  <div>
                    <label htmlFor="inviteCode" className={labelStyle}>
                      C√ìDIGO DE INVITE
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        name="inviteCode"
                        id="inviteCode"
                        value="Ser√° gerado automaticamente"
                        readOnly
                        disabled
                        className={`${inputStyle} flex-1 bg-gray-100 text-gray-500`}
                      />
                    </div>
                    <p className={`text-xs text-gray-500 mt-1 ${silkscreenFont}`}>
                      O c√≥digo ser√° gerado automaticamente ap√≥s a cria√ß√£o da equipe
                    </p>
                  </div>

                  {/* Team members */}
                  <div>
                    <label className={labelStyle}>
                      MEMBROS DA EQUIPE
                    </label>
                    <div className="space-y-2 max-h-60 overflow-y-auto">
                      <div className="flex items-center gap-3 bg-gray-50 border-2 border-black rounded-md p-3">
                        <img
                          src={"/mario.png"}
                          alt={`Avatar de ${user?.nickname || 'Usu√°rio'}`}
                          className="w-12 h-12 rounded-full border-2 border-black object-cover"
                        />
                        <div className="flex-1">
                          <div className="flex items-center gap-2">
                            <Crown size={16} className="text-yellow-500" />
                            <span className={`${silkscreenFont} text-sm font-bold text-black`}>
                              {user?.nickname?.toUpperCase() || 'L√çDER'}
                            </span>
                          </div>
                          <div className={`${silkscreenFont} text-xs text-gray-600`}>
                            N√çVEL - ‚Ä¢ XP - (Voc√™ ser√° o l√≠der)
                          </div>
                        </div>
                        <div className={`${silkscreenFont} text-xs text-yellow-600 font-bold`}>
                          L√çDER
                        </div>
                      </div>
                    </div>
                    <p className={`text-xs text-gray-500 mt-2 ${silkscreenFont}`}>
                      Voc√™ pode adicionar mais membros ap√≥s criar a equipe
                    </p>
                  </div>
                </div>

                {/* Right column - Additional info */}
                <div className="space-y-4">
                  <div>
                    <label className={`${labelStyle} mb-3`}>
                      <UserPlus size={16} className="inline mr-2" />
                      INFORMA√á√ïES ADICIONAIS
                    </label>

                    <div className="bg-gray-50 border-2 border-black rounded-md p-4">
                      <p className={`${silkscreenFont} text-sm text-black mb-4`}>
                        AO CRIAR UMA EQUIPE:
                      </p>

                      <ul className="space-y-3">
                        <li className="flex items-start gap-2">
                          <span className="text-green-500 font-bold">‚Ä¢</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            VOC√ä SER√Å O L√çDER DA EQUIPE
                          </span>
                        </li>
                        <li className="flex items-start gap-2">
                          <span className="text-green-500 font-bold">‚Ä¢</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            PODER√Å CONVIDAR OUTROS JOGADORES PARA PARTICIPAR
                          </span>
                        </li>
                        <li className="flex items-start gap-2">
                          <span className="text-green-500 font-bold">‚Ä¢</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            COMPETIR EM RANKINGS E DESAFIOS EM GRUPO
                          </span>
                        </li>
                        <li className="flex items-start gap-2">
                          <span className="text-green-500 font-bold">‚Ä¢</span>
                          <span className={`${silkscreenFont} text-xs text-gray-700`}>
                            GANHAR RECOMPENSAS EXCLUSIVAS PARA EQUIPES
                          </span>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              {/* Create button */}
              <div className="flex justify-center mt-8">
                <Button
                  onClick={handleCreateTeam}
                  disabled={!teamName.trim() || createTeamMutation.isPending}
                  className={`${buttonBaseStyle} px-8 py-3 bg-[#29D8FF] hover:bg-[#20B4D2] text-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] disabled:opacity-50 disabled:cursor-not-allowed`}
                >
                  {createTeamMutation.isPending ? (
                    <>
                      <div className="animate-spin rounded-full h-4 w-4 border-2 border-black border-t-transparent mr-2"></div>
                      CRIANDO...
                    </>
                  ) : (
                    <>
                      <Settings size={18} className="mr-2" />
                      CRIAR EQUIPE
                    </>
                  )}
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default CriarEquipePage;
</file>

<file path="src/pages/Perfil/EditarPerfil.tsx">
import { useNavigate } from "react-router-dom";
import { useState, useRef, useEffect } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { useAuth } from "../../contexts/AuthContext";
import AuthService from "../../api/authService";
import { Button } from "../../components/ui/button";
import {
  Card,
  CardContent,
} from "../../components/ui/card";
import {
  ArrowLeft,
  Camera,
  Trophy,
  Edit3,
  LogOut,
  Trash2,
  KeyRound,
  ChevronDown,
  Users,
} from 'lucide-react';

interface UserEditData {
  first_name: string;
  last_name: string;
  email: string;
  data_nascimento?: string;
}

export const EditarPerfilPage = () => {
  const navigate = useNavigate();
  const fileInputRef = useRef<HTMLInputElement>(null);
  const { user, refreshUser, logout } = useAuth();
  const queryClient = useQueryClient();

  // Estado para os dados edit√°veis
  const [userData, setUserData] = useState<UserEditData>({
    first_name: '',
    last_name: '',
    email: '',
    data_nascimento: ''
  });

  // Estado para avatar local (funcionalidade futura)
  const [localAvatar, setLocalAvatar] = useState<string>("/mario.png");

  // Dados est√°ticos para exibi√ß√£o (level, XP, equipe)
  const [displayData] = useState({
    level: 12,
    xp: 2450,
    maxXp: 3000,
    xpPercentage: 83,
    team: "FRUIT VALE",
    funcaoEquipe: "COORDENADOR",
  });

  // Carrega dados do usu√°rio quando componente monta
  useEffect(() => {
    if (user) {
      // Converter data para formato YYYY-MM-DD se necess√°rio
      let dataFormatada = '';
      if (user.data_nascimento) {
        // Se vier no formato DD/MM/YYYY, converter para YYYY-MM-DD
        if (user.data_nascimento.includes('/')) {
          const [dia, mes, ano] = user.data_nascimento.split('/');
          dataFormatada = `${ano}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
        }
        // Se vier no formato YYYY-MM-DD, usar direto
        else if (user.data_nascimento.includes('-')) {
          dataFormatada = user.data_nascimento;
        }
        // Outros formatos
        else {
          dataFormatada = user.data_nascimento;
        }
      }

      setUserData({
        first_name: user.first_name || '',
        last_name: user.last_name || '',
        email: user.email || '',
        data_nascimento: dataFormatada
      });
    }
  }, [user]);

  // Mutation para atualizar perfil
  const updateProfileMutation = useMutation({
    mutationFn: (data: UserEditData) => {
      console.log('üåê DEBUG - Enviando requisi√ß√£o PATCH para /auth/perfil/ com:', data);
      return AuthService.updateProfile(data);
    },
    onSuccess: async (response) => {
      console.log('‚úÖ DEBUG - Resposta de sucesso do backend:', response.data);

      // Atualiza os dados no contexto
      await refreshUser();

      console.log('üîÑ DEBUG - Usu√°rio atualizado no contexto');

      // Invalida queries relacionadas
      queryClient.invalidateQueries({ queryKey: ['profile'] });

      // Mostra sucesso e navega
      alert("Altera√ß√µes salvas com sucesso!");
      navigate("/perfil");
    },
    onError: (error: any) => {
      console.error("‚ùå DEBUG - Erro completo:", error);
      console.error("‚ùå DEBUG - Resposta do servidor:", error.response?.data);
      console.error("‚ùå DEBUG - Status do erro:", error.response?.status);

      const errorMessage = error.response?.data?.detail ||
        error.response?.data?.message ||
        JSON.stringify(error.response?.data) ||
        "Erro ao salvar altera√ß√µes";
      alert(`Erro: ${errorMessage}`);
    }
  });

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setUserData(prev => ({ ...prev, [name]: value }));
  };

  const handlePhotoUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const result = e.target?.result;
        if (typeof result === 'string') {
          setLocalAvatar(result);
        }
      };
      reader.readAsDataURL(file);
    } else {
      alert('Por favor, selecione apenas arquivos de imagem.');
    }
  };

  const handleClickUpload = () => {
    fileInputRef.current?.click();
  };

  const handleSalvarAlteracoes = () => {
    console.log('üíæ DEBUG - Iniciando salvamento com dados:', userData);

    // Valida dados b√°sicos
    if (!userData.email.trim()) {
      alert("Email √© obrigat√≥rio!");
      return;
    }

    // Prepara dados para envio (remove campos vazios)
    const dataToSend: Partial<UserEditData> = {};

    if (userData.first_name.trim()) dataToSend.first_name = userData.first_name.trim();
    if (userData.last_name.trim()) dataToSend.last_name = userData.last_name.trim();
    if (userData.email.trim()) dataToSend.email = userData.email.trim();
    if (userData.data_nascimento?.trim()) dataToSend.data_nascimento = userData.data_nascimento.trim();

    console.log('üì§ DEBUG - Dados que ser√£o enviados para o backend:', dataToSend);

    updateProfileMutation.mutate(dataToSend as UserEditData);
  };

  const handleNavigateBack = () => {
    navigate(-1);
  };

const handleTeamSettings = () => {
  navigate("/perfil/editar-equipe");
};

  const handleSairDaEquipe = () => {
    console.log("Sair da equipe");
    // TODO: Implementar API para sair da equipe
    alert("Funcionalidade em desenvolvimento!");
  };

  const handleExcluirEquipe = () => {
    navigate("/perfil/excluir-equipe");
  };

  const handleChangePassword = () => {
    navigate("/mudar-senha");
  };

  const handleLogout = () => {
    logout();
    navigate("/login");
  };

  // Se n√£o h√° usu√°rio logado, redireciona
  if (!user) {
    navigate("/login");
    return null;
  }

  const silkscreenFont = "[font-family:'Silkscreen',Helvetica]";
  const inputStyle = `bg-white border-2 border-black rounded-md p-2 w-full ${silkscreenFont} text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400`;
  const labelStyle = `text-xs ${silkscreenFont} mb-1 block text-black`;
  const buttonBaseStyle = `${silkscreenFont} border-2 border-black rounded-md px-4 py-2 text-xs font-bold flex items-center justify-center`;

  return (
    <div className="bg-white flex flex-row justify-center w-full h-screen overflow-hidden">
      <div className={`w-full h-full [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden ${silkscreenFont}`}>
        {/* Decorative clouds */}
        <img
          className="w-[375px] h-[147px] absolute top-[80px] left-[calc(50%_-_650px)] object-cover animate-float-right opacity-80"
          alt="Cloud decoration left"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[calc(50%_-_700px)] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration right"
          src="/nuvemright.png"
        />

        {/* Hidden file input */}
        <input
          type="file"
          ref={fileInputRef}
          onChange={handlePhotoUpload}
          accept="image/*"
          className="hidden"
        />

        {/* Back button */}
        <div className="absolute top-4 left-4 z-20">
          <Button onClick={handleNavigateBack} variant="outline" className="p-2 bg-white border-2 border-black rounded-md hover:bg-gray-200">
            <ArrowLeft size={24} className="text-black" />
          </Button>
        </div>

        {/* Main content */}
        <div className="h-full flex items-center justify-center px-4 py-4 relative z-10">
          <div className="w-full max-w-4xl h-full">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">

              {/* Left column - User profile */}
              <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] h-full">
                <CardContent className="p-4 md:p-5 h-full overflow-y-auto">
                  <div className="text-center mb-4">
                    {/* Avatar section */}
                    <div className="mt-1 flex justify-center">
                      <div className="relative">
                        <div className="w-28 h-28 rounded-full bg-[#00FFFF] border-2 border-black flex items-center justify-center overflow-hidden relative group">
                          <img
                            src={localAvatar}
                            alt="Avatar"
                            className="w-24 h-24 object-cover rounded-full"
                          />
                          <div
                            className="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer rounded-full"
                            onClick={handleClickUpload}
                          >
                            <Camera size={28} className="text-white" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <h3 className={`${silkscreenFont} font-bold text-black text-lg mt-3`}>
                      {(user.nickname || user.username).toUpperCase()}
                    </h3>

                    <div className="flex items-center justify-center mt-1">
                      <span className="text-yellow-500 mr-1">üèÜ</span>
                      <span className={`${silkscreenFont} text-black text-sm`}>
                        N√çVEL {displayData.level}
                      </span>
                    </div>

                    {/* XP Progress bar */}
                    <div className="mt-3">
                      <div className="flex justify-between text-xs text-black ${silkscreenFont} mb-1">
                        <span>XP: {displayData.xp}/{displayData.maxXp}</span>
                        <span>{displayData.xpPercentage}%</span>
                      </div>
                      <div className="w-full h-5 bg-gray-300 rounded-sm overflow-hidden border border-black">
                        <div
                          className="h-full bg-yellow-400 border-r border-black"
                          style={{ width: `${displayData.xpPercentage}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>

                  {/* Form fields */}
                  <div className="space-y-3 mt-4">
                    <div>
                      <label htmlFor="first_name" className={labelStyle}>NOME</label>
                      <input
                        type="text"
                        name="first_name"
                        id="first_name"
                        value={userData.first_name}
                        onChange={handleInputChange}
                        className={inputStyle}
                        placeholder="Seu primeiro nome"
                      />
                    </div>
                    <div>
                      <label htmlFor="last_name" className={labelStyle}>SOBRENOME</label>
                      <input
                        type="text"
                        name="last_name"
                        id="last_name"
                        value={userData.last_name}
                        onChange={handleInputChange}
                        className={inputStyle}
                        placeholder="Seu sobrenome"
                      />
                    </div>
                    <div>
                      <label className={labelStyle}>USU√ÅRIO (n√£o pode ser alterado)</label>
                      <input
                        type="text"
                        value={user.nickname || user.username}
                        className={`${inputStyle} bg-gray-200 cursor-not-allowed opacity-70`}
                        disabled
                        readOnly
                      />
                    </div>
                    <div>
                      <label htmlFor="email" className={labelStyle}>EMAIL</label>
                      <input
                        type="email"
                        name="email"
                        id="email"
                        value={userData.email}
                        onChange={handleInputChange}
                        className={inputStyle}
                        placeholder="seu@email.com"
                        required
                      />
                    </div>
                    <div>
                      <label htmlFor="data_nascimento" className={labelStyle}>DATA DE NASCIMENTO</label>
                      <input
                        type="date"
                        name="data_nascimento"
                        id="data_nascimento"
                        value={userData.data_nascimento}
                        onFocus={() => console.log('üìÖ DEBUG - Data atual no campo:', userData.data_nascimento)}
                        onChange={(e) => {
                          console.log('üìÖ DEBUG - Nova data selecionada:', e.target.value);
                          handleInputChange(e);
                        }}
                        className={inputStyle}
                      />
                    </div>
                  </div>

                  <div className="flex justify-center mt-6">
                    <Button
                      onClick={handleSalvarAlteracoes}
                      disabled={updateProfileMutation.isPending}
                      className={`${buttonBaseStyle} w-auto px-6 py-1.5 bg-[#29D8FF] hover:bg-[#20B4D2] text-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] disabled:opacity-50`}
                    >
                      {updateProfileMutation.isPending ? 'SALVANDO...' : 'SALVAR ALTERA√á√ïES'}
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Right column - Team and actions */}
              <div className="h-full flex flex-col space-y-5">
                <div className="flex-1 overflow-y-auto space-y-5">
                  <Card className="border-2 border-solid border-black rounded-lg overflow-hidden bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
                    <CardContent className="p-4">
                      <div className="flex justify-between items-center mb-3">
                        <h3 className={`${silkscreenFont} text-base text-black`}>
                          EQUIPE : <span className="text-[#E3922A] font-bold">
                            {user.equipe ? displayData.team.toUpperCase() : 'SEM EQUIPE'}
                          </span>
                        </h3>
                        <Button variant="ghost" onClick={handleTeamSettings} className="p-1 hover:bg-gray-200 rounded">
                          <Edit3 size={18} className="text-black" />
                        </Button>
                      </div>

                      {/* Team info box */}
                      <div className="bg-gray-100 border-2 border-black rounded-md p-3 mb-4">
                        <div className="flex items-center mb-3">
                          <div className="flex flex-col items-center mr-4">
                            <p className={`${silkscreenFont} text-black text-sm mb-1 text-center`}>
                              {user.equipe ? 'L√çDER' : 'SEM EQUIPE'}
                            </p>
                            <img
                              src="/avatar-placeholder.png"
                              alt="Team Leader Avatar"
                              className="w-12 h-12 rounded-sm bg-gray-300 border border-black"
                            />
                          </div>
                          <div className={`${silkscreenFont} text-black text-xs flex flex-col space-y-1`}>
                            <div className="flex items-center"><Trophy size={16} className="mr-1 text-yellow-500" /> 4</div>
                            <div className="flex items-center"><Users size={16} className="mr-1" /> 5</div>
                            <div className="flex items-center"><Trophy size={16} className="mr-1 text-orange-400" /> 9</div>
                          </div>
                        </div>

                        {user.equipe ? (
                          <div className="flex space-x-2">
                            <Button
                              onClick={handleSairDaEquipe}
                              className={`${buttonBaseStyle} flex-1 bg-white hover:bg-gray-100 text-black text-[10px] leading-tight shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)]`}
                            >
                              <LogOut size={14} className="mr-1 md:mr-2" /> SAIR DA EQUIPE
                            </Button>
                            <Button
                              onClick={handleExcluirEquipe}
                              className={`${buttonBaseStyle} flex-1 bg-red-500 hover:bg-red-600 text-white text-[10px] leading-tight shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)]`}
                            >
                              <Trash2 size={14} className="mr-1 md:mr-2" /> EXCLUIR EQUIPE
                            </Button>
                          </div>
                        ) : (
                          <div className="text-center">
                            <Button
                              onClick={() => navigate('/equipes')}
                              className={`${buttonBaseStyle} bg-green-500 hover:bg-green-600 text-white text-sm`}
                            >
                              ENTRAR EM UMA EQUIPE
                            </Button>
                          </div>
                        )}
                      </div>

                      {/* Team role selector */}
                      {user.equipe && (
                        <div>
                          <label htmlFor="funcaoEquipe" className={`${labelStyle} mb-1`}>FUN√á√ÉO</label>
                          <div className="relative">
                            <select
                              name="funcaoEquipe"
                              id="funcaoEquipe"
                              value={displayData.funcaoEquipe}
                              onChange={() => { }} // TODO: Implementar mudan√ßa de fun√ß√£o
                              className={`${inputStyle} appearance-none pr-8`}
                              disabled
                            >
                              <option value="COORDENADOR">COORDENADOR</option>
                              <option value="MEMBRO">MEMBRO</option>
                              <option value="VICE-LIDER">VICE-LIDER</option>
                            </select>
                            <ChevronDown size={20} className="absolute right-2 top-1/2 -translate-y-1/2 text-black pointer-events-none" />
                          </div>
                        </div>
                      )}
                    </CardContent>
                  </Card>

                  {/* Action buttons */}
                  <div className="space-y-3">
                    <Button
                      onClick={handleChangePassword}
                      className={`${buttonBaseStyle} w-full bg-white hover:bg-gray-100 text-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px]`}
                    >
                      <KeyRound size={18} className="mr-2" /> ALTERAR SENHA
                    </Button>
                    <Button
                      onClick={handleLogout}
                      className={`${buttonBaseStyle} w-full bg-white hover:bg-gray-100 text-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px]`}
                    >
                      <LogOut size={18} className="mr-2" /> SAIR
                    </Button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default EditarPerfilPage;
</file>

<file path="src/pages/Game-truck/game.tsx">
import { useEffect, useRef, useState } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import kaboom from "kaboom";
import './game.css'
import { Vehicle } from "../../types/vehicle";
import { GameMiniMap } from "./GameMiniMap";
import { MapComponent } from "../mapaRota/MapComponent";
import { PauseMenu } from "../PauseMenu/PauseMenu"; 
import type {
  GameObj,
  SpriteComp,
  PosComp,
  ZComp,
  AreaComp,
  BodyComp,
  ScaleComp
} from "kaboom";


export function GameScene() {
  const location = useLocation();
  const navigate = useNavigate();
  const canvasRef = useRef<HTMLCanvasElement | null>(null);
  const [showPopup, setShowPopup] = useState(false);
  const [playerChoice, setPlayerChoice] = useState<string | null>(null);
  const [isPaused, setIsPaused] = useState(false);
  const gamePaused = useRef(false);
  const collidedObstacle = useRef<GameObj | null>(null);
  const destroyRef = useRef<((obj: GameObj) => void) | null>(null); // <-- Aqui
  const [eventoAtual, setEventoAtual] = useState<{ texto: string; desc: string, opcoes: string[] } | null>(null);
  const processingEvent = useRef(false); // Flag para evitar eventos duplicados
  const [gameEnded, setGameEnded]  = useState(false);
  const [showEndMessage, setShowEndMessage] = useState(false);
  const [gameLoaded, setGameLoaded] = useState(false);
  const [loadingError, setLoadingError] = useState<string | null>(null);
  const gameInitialized = useRef(false); // Flag para evitar m√∫ltiplas inicializa√ß√µes
  const progressRef = useRef(0);
  const [progress, setProgress] = useState(0);
  const distanceTravelled = useRef(0);
  
  // Novos estados para progresso baseado nos pontos do caminho
  const [currentPathIndex, setCurrentPathIndex] = useState(0);
  const pathProgressRef = useRef(0); // Progresso dentro do segmento atual (0-1)
  const currentPathIndexRef = useRef(0); // Ref para uso dentro do onUpdate do Kaboom
  const gameSpeedMultiplier = useRef(1); // Multiplicador de velocidade baseado na rota
  const obstacleTimerRef = useRef(0); // Timer para cria√ß√£o de obst√°culos
  // Cooldown curto ap√≥s uma colis√£o para evitar detec√ß√µes duplicadas
  const collisionCooldownRef = useRef(0);
  const obstacleSystemLockedRef = useRef(false); // Sistema travado durante eventos
  const handleResizeRef = useRef<(() => void) | null>(null); // Ref para fun√ß√£o de resize
  
  // Novos estados para melhorias
  const [gameTime, setGameTime] = useState(0); // Tempo decorrido em segundos
  const gameStartTime = useRef<number>(Date.now());
  const manualTimeAdjustment = useRef<number>(0); // Ajuste manual do tempo pelos eventos
  const [currentFuel, setCurrentFuel] = useState<number>(() => {
    // Inicializar com o combust√≠vel do ve√≠culo desde o in√≠cio
    const vehicleData = location.state?.selectedVehicle || location.state?.vehicle;
    return vehicleData?.currentFuel || 0;
  });
  const [totalDistance, setTotalDistance] = useState<number>(500); // Dist√¢ncia padr√£o

  // Estados para o modal do mapa
  const [showMapModal, setShowMapModal] = useState(false);

  // Estados que agora v√™m dos par√¢metros de navega√ß√£o
  const [vehicle, setVehicle] = useState<Vehicle>(() => {
    console.log("Estado recebido no jogo:", location.state);
    
    if (location.state && location.state.selectedVehicle) {
      console.log("Ve√≠culo encontrado:", location.state.selectedVehicle);
      return location.state.selectedVehicle;
    }
    
    console.warn("Nenhum ve√≠culo encontrado, redirecionando...");
    // Se n√£o houver dados, redirecionar para sele√ß√£o de ve√≠culo
    navigate('/select-vehicle');
    return { id: 'default', name: 'Caminh√£o Padr√£o', capacity: 1000, consumption: { asphalt: 3, dirt: 2 }, image: '/assets/truck.png', maxCapacity: 100, currentFuel: 0, cost: 1000 };
  });

  const [money, setMoney] = useState(() => {
    const money = location.state?.availableMoney;
    console.log("Dinheiro recebido:", money);
    return money !== undefined ? money : 1000;
  });

  const [selectedRoute, setSelectedRoute] = useState(() => {
    const route = location.state?.selectedRoute;
    console.log("Rota recebida:", route);
    return route || null;
  });

  // Fun√ß√£o central para pausar e despausar o jogo
  const togglePause = () => {
    const nextPausedState = !gamePaused.current;
    gamePaused.current = nextPausedState; // Atualiza a ref para a l√≥gica do Kaboom
    setIsPaused(nextPausedState); // Atualiza o state para a UI do React
    console.log(`Jogo ${nextPausedState ? "pausado" : "despausado"}`);
  };

  // Fun√ß√£o para reiniciar o jogo (a forma mais simples √© recarregar a p√°gina)
  const handleRestart = () => {
    window.location.reload();
  };

  // Fun√ß√£o para salvar e ir para o perfil (reaproveitando sua l√≥gica)
  const handleGoToProfile = () => {
    // Salva o progresso no localStorage
    const gameProgress = {
      vehicle, 
      money,
      selectedRoute,
      currentFuel,
      progress,
      currentPathIndex,
      pathProgress: pathProgressRef.current,
      gameTime,
      manualTimeAdjustment: manualTimeAdjustment.current,
      timestamp: Date.now()
    };
    localStorage.setItem('savedGameProgress', JSON.stringify(gameProgress));
    
    // Navega para o perfil
    navigate('/perfil');
  };

    // Listener para a tecla ESC
    useEffect(() => {
      const handleKeyDown = (e: KeyboardEvent) => {
        if (e.key === 'Escape') {
          // N√£o pausar se um evento j√° estiver na tela
          if (!eventoAtual && !gameEnded) {
            togglePause();
          }
        }
      };

      window.addEventListener('keydown', handleKeyDown);

      // Fun√ß√£o de limpeza para remover o listener quando o componente for desmontado
      return () => {
        window.removeEventListener('keydown', handleKeyDown);
      };
    }, [eventoAtual, gameEnded]); // Depend√™ncias para evitar pausar em momentos indevidos

    const handleSaveAndPause = () => {
    console.log("üíæ Salvando progresso e pausando o jogo...");

    // Salva o progresso no localStorage (mesma l√≥gica que voc√™ j√° tinha)
    const gameProgress = {
      vehicle, 
      money,
      selectedRoute,
      currentFuel,
      progress,
      currentPathIndex,
      pathProgress: pathProgressRef.current,
      gameTime,
      manualTimeAdjustment: manualTimeAdjustment.current,
      timestamp: Date.now()
    };
    localStorage.setItem('savedGameProgress', JSON.stringify(gameProgress));

    // Pausa o jogo e abre o modal
    togglePause();
  };

  // Inicializar estados baseados nos dados recebidos
  useEffect(() => {
    console.log("Inicializando currentFuel com:", vehicle.currentFuel);
    
    // Verificar se h√° progresso salvo sendo carregado
    const savedProgressData = location.state?.savedProgress;
    
    if (savedProgressData) {
      // Log de carregamento removido
      
      // Restaurar estados salvos
      setCurrentFuel(savedProgressData.currentFuel);
      setProgress(savedProgressData.progress);
      setCurrentPathIndex(savedProgressData.currentPathIndex);
      setGameTime(savedProgressData.gameTime);
      
      // Restaurar refs
      progressRef.current = savedProgressData.progress;
      currentPathIndexRef.current = savedProgressData.currentPathIndex;
      pathProgressRef.current = savedProgressData.pathProgress;
      
      // Ajustar o tempo de in√≠cio do jogo para considerar o tempo j√° jogado
      gameStartTime.current = Date.now() - (savedProgressData.gameTime * 1000);
      manualTimeAdjustment.current = savedProgressData.manualTimeAdjustment || 0; // Restaurar ajuste manual
      
      console.log("Estados restaurados do save:", {
        currentFuel: savedProgressData.currentFuel,
        progress: savedProgressData.progress,
        currentPathIndex: savedProgressData.currentPathIndex,
        gameTime: savedProgressData.gameTime,
        manualTimeAdjustment: manualTimeAdjustment.current
      });
      console.log(`üïê gameStartTime ajustado para save: ${new Date(gameStartTime.current).toLocaleTimeString()}`);
      console.log(`üîß Ajuste manual restaurado: ${manualTimeAdjustment.current}s`);
    } else {
      // Inicializa√ß√£o normal
    setCurrentFuel(vehicle.currentFuel || vehicle.maxCapacity);
    }
    
    if (selectedRoute) {
      console.log("Definindo dist√¢ncia total:", selectedRoute.actualDistance || selectedRoute.distance);
      setTotalDistance(selectedRoute.actualDistance || selectedRoute.distance);
      
      // Calcular multiplicador de velocidade baseado no tempo estimado da rota
      const estimatedHours = selectedRoute.estimatedTimeHours || 7.5; // Padr√£o 7.5 horas
      const targetGameDurationMinutes = 3; // Queremos que o jogo dure ~3 minutos
      gameSpeedMultiplier.current = (estimatedHours * 60) / targetGameDurationMinutes;
      
      console.log("Rota estimada:", estimatedHours, "horas");
      console.log("Multiplicador de velocidade:", gameSpeedMultiplier.current);
      console.log("PathCoordinates dispon√≠veis:", selectedRoute.pathCoordinates?.length, "pontos");
    }
  }, [vehicle, selectedRoute, location.state]);

  const [gasoline, setGasoline] = useState(() => {
    // Calcular porcentagem do combust√≠vel com base no ve√≠culo
    const fuelPercent = (currentFuel / vehicle.maxCapacity) * 100;
    console.log("Inicializando gasoline com:", fuelPercent, "%");
    return fuelPercent;
  });

  // Debug dos dados recebidos
  useEffect(() => {
    // Verificar se todos os dados essenciais est√£o presentes apenas na primeira execu√ß√£o
    if (!vehicle || !vehicle.name || !vehicle.image) {
      console.error("ERRO: Dados do ve√≠culo incompletos!");
      console.log("Redirecionando para sele√ß√£o de ve√≠culo...");
      setTimeout(() => {
        navigate('/select-vehicle');
      }, 1000);
    }
  }, []); // Executar apenas uma vez

  // Timer do jogo
  useEffect(() => {
    const interval = setInterval(() => {
      if (!gamePaused.current && !gameEnded && !processingEvent.current) {
        const currentTime = Date.now();
        const baseElapsedSeconds = Math.floor((currentTime - gameStartTime.current) / 1000);
        const finalElapsedSeconds = baseElapsedSeconds + manualTimeAdjustment.current;
        
        // Log apenas a cada 30 segundos para n√£o poluir o console
        if (finalElapsedSeconds % 30 === 0 && finalElapsedSeconds > 0) {
          console.log(`üïê Timer: ${formatTime(finalElapsedSeconds)} (base: ${baseElapsedSeconds}s + ajuste: ${manualTimeAdjustment.current}s)`);
        }
        
        setGameTime(finalElapsedSeconds);
      }
    }, 1000);

    return () => clearInterval(interval);
  }, [gameEnded]);

  // Sincronizar progresso para debug
  useEffect(() => {
    // Debug removido
  }, [progress, currentPathIndex]);

  // Verificar condi√ß√µes de game over
  const checkGameOver = () => {
    // S√≥ verificar game over se o jogo estiver carregado e inicializado
    if (!gameLoaded || !gameInitialized.current) {
      console.log("Game Over check skipped - jogo n√£o carregado ainda");
      return false;
    }
    
    // Aguardar pelo menos 1 segundo ap√≥s carregar para evitar false positives
    if (Date.now() - gameStartTime.current < 1000) {
      console.log("Game Over check skipped - aguardando estabiliza√ß√£o");
      return false;
    }
    
    if (currentFuel <= 0) {
      console.log("Game Over: Combust√≠vel esgotado - currentFuel:", currentFuel);
      gamePaused.current = true;
      alert("Combust√≠vel esgotado! Jogo encerrado.");
      navigate('/routes');
      return true;
    }
    
    if (money <= 0) {
      console.log("Game Over: Sem recursos financeiros - money:", money);
      gamePaused.current = true;
      alert("Sem recursos financeiros! Jogo encerrado.");
      navigate('/routes');
      return true;
    }
    
    return false;
  };

  // Formatar tempo para exibi√ß√£o (HH:MM:SS)
  const formatTime = (seconds: number) => {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  // Handler para abrir/fechar modal do mapa
  const handleMapModalToggle = () => {
    setShowMapModal(!showMapModal);
  };

  // Calcular progresso baseado nos pontos reais do caminho
  const calculatePathProgress = (deltaTime: number) => {
    if (!selectedRoute?.pathCoordinates || selectedRoute.pathCoordinates.length < 2) {
      // Fallback para l√≥gica antiga se n√£o houver pathCoordinates
      console.log("Usando fallback - sem pathCoordinates");
      return calculateFallbackProgress(deltaTime);
    }

    const pathCoords = selectedRoute.pathCoordinates;
    const totalSegments = pathCoords.length - 1;
    
    // Velocidade calibrada para completar a rota em ~3 minutos (180 segundos) AJUSTE DE DURA√á√ÉO DO JOGO
    const targetDurationSeconds = 180;
    const segmentsPerSecond = totalSegments / targetDurationSeconds;
    const segmentSpeed = segmentsPerSecond * deltaTime; // Segmentos por frame
    
    // Avan√ßar progresso no segmento atual
    pathProgressRef.current += segmentSpeed;
    
    // Se completou o segmento atual, avan√ßar para o pr√≥ximo
    if (pathProgressRef.current >= 1.0 && currentPathIndexRef.current < totalSegments - 1) {
      currentPathIndexRef.current += 1;
      setCurrentPathIndex(currentPathIndexRef.current);
      pathProgressRef.current = 0;
      // Log de segmento removido
    }
    
    // Calcular progresso total: (segmentos completos + progresso no segmento atual) / total
    const totalProgress = (currentPathIndexRef.current + pathProgressRef.current) / totalSegments;
    const progressPercent = Math.min(100, Math.max(0, totalProgress * 100));
    
    // Log de progresso removido
    
    return progressPercent;
  };

  // Fallback para quando n√£o h√° pathCoordinates
  const calculateFallbackProgress = (deltaTime: number) => {
    const routeDistance = totalDistance || 500;
    distanceTravelled.current += deltaTime * gameSpeedMultiplier.current * 0.1;
    const progressKm = (distanceTravelled.current * routeDistance) / 5000; // Ajustado para ser mais lento
    return Math.min(100, Math.max(0, (progressKm / routeDistance) * 100));
  };

  // Converter caminho da imagem do ve√≠culo para URL p√∫blica
  const getVehicleImageUrl = (vehicleImage: string) => {
    console.log("Convertendo imagem do ve√≠culo:", vehicleImage);
    
    // Se j√° √© uma URL que come√ßa com /assets/, usar diretamente
    if (vehicleImage.startsWith('/assets/')) {
      console.log("J√° √© uma URL p√∫blica:", vehicleImage);
      return vehicleImage;
    }
    
    // Se √© um caminho de m√≥dulo (/src/assets/), extrair o nome do arquivo
    if (vehicleImage.startsWith('/src/assets/')) {
      const fileName = vehicleImage.replace('/src/assets/', '');
      console.log("Nome do arquivo extra√≠do de /src/assets/:", fileName);
      return `/assets/${fileName}`;
    }
    
    // Se √© uma URL completa (ESModule import ou blob), extrair o nome do arquivo
    const fileName = vehicleImage.split('/').pop()?.split('?')[0]; // Remove query params se houver
    console.log("Nome do arquivo extra√≠do da URL:", fileName);
    
    // Mapear os nomes dos arquivos para URLs p√∫blicas
    const imageMap: { [key: string]: string } = {
      'caminhao_medio.png': '/assets/caminhao_medio.png',
      'caminhao_pequeno.png': '/assets/caminhao_pequeno.png', 
      'caminhonete.png': '/assets/caminhonete.png',
      'carreta.png': '/assets/carreta.png',
      'truck.png': '/assets/truck.png'
    };
    
    if (fileName && imageMap[fileName]) {
      console.log("URL encontrada no mapeamento:", imageMap[fileName]);
      return imageMap[fileName];
    }
    
    // Fallback para truck.png se n√£o encontrar
    console.log("Usando fallback truck.png");
    return '/assets/truck.png';
  };



  useEffect(() => {
    if (!vehicle || !vehicle.name) {
      console.error("Dados do ve√≠culo n√£o encontrados");
      return;
    }

    // Evitar m√∫ltiplas inicializa√ß√µes
    if (gameInitialized.current) {
      console.log("Jogo j√° foi inicializado, pulando...");
      return;
    }


    // Aguardar o canvas estar completamente montado
    const initializeGame = () => {
      if (!canvasRef.current) {
        console.error("Canvas n√£o encontrado, tentando novamente...");
        setTimeout(initializeGame, 100);
        return;
      }

      console.log("Canvas encontrado:", canvasRef.current);
      console.log("Canvas dimens√µes:", canvasRef.current.width, "x", canvasRef.current.height);

      // Verificar se o canvas est√° no DOM
      if (!document.contains(canvasRef.current)) {
        console.error("Canvas n√£o est√° no DOM, aguardando...");
        setTimeout(initializeGame, 100);
        return;
      }

      // Marcar como inicializado para evitar re-execu√ß√µes
      gameInitialized.current = true;

      // Resetar flag do kaboom para permitir reinicializa√ß√£o
      if ((window as any).__kaboom_initiated__) {
        (window as any).__kaboom_initiated__ = false;
      }

      console.log("Inicializando jogo com ve√≠culo:", vehicle.name, "Imagem:", vehicle.image);
      console.log("Combust√≠vel atual no in√≠cio:", currentFuel);

      // Definir fun√ß√£o de resize fora do try/catch para acessibilidade no cleanup
      handleResizeRef.current = () => {
        if (canvasRef.current) {
          canvasRef.current.width = window.innerWidth;
          canvasRef.current.height = window.innerHeight;
          // Reinicializar o jogo com as novas dimens√µes seria complexo,
          // ent√£o vamos manter as dimens√µes fixas durante a sess√£o
        }
      };

      try {
        setGameLoaded(false);
        setLoadingError(null);
        
        // Verificar suporte WebGL
        const testContext = canvasRef.current!.getContext('webgl') || canvasRef.current!.getContext('experimental-webgl');
        if (!testContext) {
          throw new Error("WebGL n√£o suportado neste navegador");
        }
        
        const k = kaboom({
          canvas: canvasRef.current!,
          width: window.innerWidth,
          height: window.innerHeight,
          background: [0, 0, 0],
          crisp: true, // Para imagens mais n√≠tidas em diferentes escalas
        });

        // Adicionar listener para redimensionamento da janela
        window.addEventListener('resize', handleResizeRef.current!);

        (window as any).__kaboom_initiated__ = true;

    const {
      loadSprite,
      scene,
      go,
      add,
      sprite,
      pos,
      area,
      body,
      isKeyDown,
      width,
      height,
      dt,
      onUpdate,
      z,
      scale,
      destroy,
    } = k;

    // Minimap removido - agora usando GameMiniMap component
    
   
   

    // Armazena a fun√ß√£o destroy fora do useEffect
    destroyRef.current = destroy;

    // Carregar sprites com tratamento de erro
    try {
      console.log("Tentando carregar sprites...");
      loadSprite("background", "/assets/backgroundd.png");
      
      const vehicleImageUrl = getVehicleImageUrl(vehicle.image);
      console.log("Imagem original do ve√≠culo:", vehicle.image);
      console.log("URL convertida para kaboom:", vehicleImageUrl);
      loadSprite("car", vehicleImageUrl);
      
      loadSprite("obstacle", "/assets/obstaclee.png");
      
      console.log("Todos os sprites carregados com sucesso");
      console.log("Ve√≠culo carregado:", vehicle.name, "Imagem URL:", vehicleImageUrl);
    } catch (error) {
      console.error("Erro ao carregar sprites:", error);
    }

    const eventos = [
      // EVENTOS NEGATIVOS (Problemas)
      {texto: "Pneu Furado üöõüí•", 
      desc:"Voc√™ precisa chamar o borracheiro!" , 
      opcoes: ["Borracheiro pr√≥ximo - R$300 | 1h | 0L", "Borracheiro barato - R$100 | 3h | 0L"]},
      
      {texto: "Greve dos caminhoneiros üößüöõ", 
      desc:"Caminhoneiros bloquearam a rota!" , 
      opcoes: ["Contratar motoristas extras - R$300 | 0h | 0L", "Esperar acabar - R$0 | 6h | 0L"]},

      {texto: "Aumento de ped√°gio üí∏üõ£Ô∏è", 
      desc:"Houve um ajuste inesperado no ped√°gio!" , 
      opcoes: ["Pagar o ped√°gio - R$120 | 0h | 0L", "Mudar de rota - R$0 | 2h | -5L"]},

      {texto: "Combust√≠vel adulterado ‚ö†Ô∏è‚õΩ", 
      desc:"O caminh√£o apresentou falhas por combust√≠vel adulterado!" , 
      opcoes: ["Consertar no mec√¢nico - R$800 | 8h | -10L", "Trocar de ve√≠culo - R$700 | 4h | 0L"]},
    
      {texto: "Eixo Quebrado üõ†Ô∏èüöõ", 
      desc:"O eixo quebrou e o ve√≠culo n√£o pode continuar!" , 
      opcoes: ["Socorro mec√¢nico - R$1000 | 6h | 0L", "Outro caminh√£o - R$900 | 4h | 0L"]},
    
      {texto: "Rota Interditada üößüõ£Ô∏è", 
      desc:"Acidente grave interditou a rota!" , 
      opcoes: ["Rota alternativa - R$200 | 3h | -8L", "Aguardar libera√ß√£o - R$0 | 5h | 0L"]},
    
      {texto: "Carga Molhada üåßÔ∏èüì¶", 
      desc:"Chuva danificou parte da carga!" , 
      opcoes: ["Reembalar carga - R$150 | 2h | 0L", "Seguir mesmo assim - R$0 | 0h | 0L"]},

      {texto: "Fiscaliza√ß√£o Rodovi√°ria üöîüìã", 
      desc:"Fiscaliza√ß√£o detectou documenta√ß√£o irregular!" , 
      opcoes: ["Regularizar documentos - R$400 | 3h | 0L", "Multa e seguir - R$600 | 1h | 0L"]},

      {texto: "Problema Mec√¢nico üîß‚öôÔ∏è", 
      desc:"O motor apresentou superaquecimento!" , 
      opcoes: ["Oficina especializada - R$500 | 4h | 0L", "Reparo improvisado - R$200 | 2h | -12L"]},

      // EVENTOS POSITIVOS (Oportunidades)
      {texto: "Promo√ß√£o de Combust√≠vel ‚õΩüéâ", 
      desc:"Posto oferece desconto especial no diesel!" , 
      opcoes: ["Abastecer completo - R$-200 | 1h | +30L", "Abastecer parcial - R$-100 | 0h | +15L"]},
    
      {texto: "Estrada Reformada üõ£Ô∏èüéâ", 
      desc:"Trecho rec√©m asfaltado permite maior velocidade!" , 
      opcoes: ["Acelerar e ganhar tempo - R$0 | -2h | -6L", "Velocidade normal - R$0 | 0h | +2L"]},

      {texto: "Clima Favor√°vel üå§Ô∏èüéâ", 
      desc:"Vento a favor e clima seco!" , 
      opcoes: ["Aproveitar e acelerar - R$0 | -1h | -3L", "Economizar combust√≠vel - R$0 | 0h | +8L"]},

      {texto: "Ped√°gio Gratuito üõ£Ô∏èüéâ", 
      desc:"Promo√ß√£o liberou o ped√°gio!" , 
      opcoes: ["Usar rota liberada - R$-120 | 0h | 0L", "Rota alternativa - R$-60 | +1h | -3L"]},

      {texto: "Carona Solid√°ria üë•üöõ", 
      desc:"Outro motorista ofereceu ajuda com combust√≠vel!" , 
      opcoes: ["Aceitar ajuda - R$0 | 0h | +20L", "Recusar educadamente - R$0 | 0h | 0L"]},

      {texto: "Desconto na Manuten√ß√£o üîßüí∞", 
      desc:"Oficina parceira oferece desconto!" , 
      opcoes: ["Fazer manuten√ß√£o preventiva - R$-150 | 2h | +5L", "N√£o fazer agora - R$0 | 0h | 0L"]},
    ];



scene("main", () => {
  const speed = 5000;

  // Calcular escala para o background cobrir toda a tela
  // Assumindo que a imagem original do background √© 1365x762
  const bgScaleX = width() / 1365;
  const bgScaleY = height() / 762;
  const bgScale = Math.max(bgScaleX, bgScaleY); // Usar o maior para cobrir toda a tela

  // Ajustar posi√ß√£o Y do background para alinhar a pista com o caminh√£o
  const bgOffsetY = -height() * 0.15; // Subir o background 15% da altura da tela

  const bg1 = add([
    sprite("background"),
    pos(0, bgOffsetY),
    scale(bgScale),
    z(0),
    { speed },
  ]);

  const bg2 = add([
    sprite("background"),
    pos(1365 * bgScale, bgOffsetY), // Posicionar baseado no tamanho escalado da imagem original
    scale(bgScale),
    z(0),
    { speed },
  ]);

  // Posicionar o caminh√£o na pista (ajustar com base no offset do background)
  // Ajustar a posi√ß√£o Y baseada no tamanho da tela e no offset do background
  const roadYPosition = height() * 0.68; // Ajustar para 68% devido ao background ter subido
  const carScale = Math.min(width() / 1365, height() / 762) * 0.6; // Escala um pouco menor para propor√ß√£o melhor

  const car = add([
    sprite("car"),
    pos(width() * 0.08, roadYPosition), // 8% da largura da tela, um pouco mais √† direita
    area(),
    body(),
    z(2),
    scale(carScale),
  ]);

  type Obstacle = GameObj<
    SpriteComp |
    PosComp |
    ZComp |
    AreaComp |
    BodyComp |
    ScaleComp
  > & { collided: boolean; };

  // Sistema de gest√£o de obst√°culos mais robusto
  const obstacles: Obstacle[] = [];
  const maxObstacles = 1;
  const obstacleSpawnInterval = 10; // Aumentar para 10 segundos
  let lastObstacleCreatedTime = 0; // Timestamp da √∫ltima cria√ß√£o
  
  // Fun√ß√£o para criar um novo obst√°culo (simplificada)
  const createObstacle = () => {
    const currentTime = Date.now();
    
    // Verifica√ß√µes b√°sicas (sistema j√° deve estar travado quando chega aqui)
    if (obstacles.length >= maxObstacles) {
      console.log("üö´ Limite de obst√°culos atingido:", obstacles.length);
      return;
    }
    
    // Verificar tempo m√≠nimo entre cria√ß√µes
    if (currentTime - lastObstacleCreatedTime < 3000) {
      console.log("üö´ Muito cedo para criar obst√°culo:", currentTime - lastObstacleCreatedTime, "ms");
      return;
    }
    
    // Posicionar obst√°culo bem longe da tela inicial para evitar colis√£o imediata
    const roadYPosition = height() * 0.68; // Mesma posi√ß√£o Y da pista do caminh√£o (ajustada)
    const obstacleScale = Math.min(width() / 1365, height() / 762) * 0.12; // Escala um pouco menor
    const safeDistance = width() + 300; // Dist√¢ncia segura da borda direita da tela
    
    const obs = add([
      sprite("obstacle"),
      pos(safeDistance + Math.random() * 200, roadYPosition + Math.random() * 40 - 20), // Posi√ß√£o mais distante e com varia√ß√£o
      area(),
      body(),
      z(1),
      scale(obstacleScale),
      "obstacle",
      { collided: false },
    ]) as Obstacle;

    obstacles.push(obs);
    lastObstacleCreatedTime = Date.now();
    console.log("üî¥ Novo obst√°culo criado. Total:", obstacles.length, "Posi√ß√£o:", obs.pos.x, obs.pos.y);
  };

  onUpdate(() => {
    // DEBUG: Verificar se o jogo est√° pausado
    if (gamePaused.current) {
      return; // N√£o processar se o jogo estiver pausado
    }

    const deltaTime = dt();

    // Reduzir o cooldown (se houver) a cada frame, mas n√£o deixar ficar negativo
    if (collisionCooldownRef.current > 0) {
      collisionCooldownRef.current = Math.max(0, collisionCooldownRef.current - deltaTime);
    }

    const moveAmount = -speed * deltaTime;

    bg1.move(moveAmount, 0);
    bg2.move(moveAmount, 0);

    // Atualizar timer para cria√ß√£o de obst√°culos
    obstacleTimerRef.current += deltaTime;
    
    // Sistema de cria√ß√£o de obst√°culos ULTRA rigoroso - apenas UM por vez
    const canCreateObstacle = (
      obstacleTimerRef.current >= obstacleSpawnInterval &&
      obstacles.length === 0 &&
      !eventoAtual &&
      !processingEvent.current &&
      !obstacleSystemLockedRef.current &&
      collisionCooldownRef.current === 0
    );
    
    if (canCreateObstacle) {
      // TRAVAR IMEDIATAMENTE para evitar cria√ß√µes m√∫ltiplas
      obstacleSystemLockedRef.current = true;
      console.log("‚è∞ Condi√ß√µes atendidas - TRAVANDO sistema e criando obst√°culo");
      console.log("üìä Estado atual:", {
        timer: obstacleTimerRef.current.toFixed(2),
        obstaculos: obstacles.length,
        evento: !!eventoAtual,
        processing: processingEvent.current,
        cooldown: collisionCooldownRef.current
      });
      
      createObstacle();
      obstacleTimerRef.current = -10; // Resetar com delay muito longo
      
      // Destravar ap√≥s o obst√°culo ser criado e posicionado
      setTimeout(() => {
        obstacleSystemLockedRef.current = false;
        console.log("üîì Sistema destravado ap√≥s cria√ß√£o de obst√°culo");
      }, 2000); // 2 segundos para garantir que o obst√°culo foi criado e posicionado
    }

    // Processar obst√°culos existentes (itera√ß√£o reversa para remo√ß√£o segura)
    for (let i = obstacles.length - 1; i >= 0; i--) {
      const obs = obstacles[i];
      
      obs.move(moveAmount, 0);

      // Remover obst√°culos que sa√≠ram completamente da tela
      if (obs.pos.x < -obs.width - 100) {
        obs.destroy(); // Destruir o objeto do jogo
        obstacles.splice(i, 1); // Remover do array
        console.log("üóëÔ∏è Obst√°culo removido da tela. Total restante:", obstacles.length);
        continue;
      }

      // Verificar colis√£o apenas para obst√°culos que est√£o efetivamente na √°rea de jogo
      // e n√£o colididos, com verifica√ß√µes mais rigorosas
      const obstacleInGameArea = obs.pos.x > 0 && obs.pos.x < width() - 50; // Margem de seguran√ßa
      const obstacleVisible = obs.pos.x > -obs.width && obs.pos.x < width();
      
      if (
        collisionCooldownRef.current === 0 &&
        obstacleVisible &&
        obstacleInGameArea &&
        !obs.collided &&
        !eventoAtual &&
        !processingEvent.current &&
        car.isColliding(obs)
      ) {
        const eventoSorteado = eventos[Math.floor(Math.random() * eventos.length)];

        // TRAVAR SISTEMA COMPLETAMENTE durante colis√£o
        obstacleSystemLockedRef.current = true;
        processingEvent.current = true; // Marcar que est√° processando evento
        setEventoAtual(eventoSorteado);
        obs.collided = true; // Marcar como colidido
        gamePaused.current = true; // Pausar o jogo
        collidedObstacle.current = obs; // Armazenar o obst√°culo colidido

        console.log("üí• COLIS√ÉO DETECTADA! Obst√°culo pos:", obs.pos.x, obs.pos.y, "Caminh√£o pos:", car.pos.x, car.pos.y);
        console.log("üîç Estado antes da colis√£o - cooldown:", collisionCooldownRef.current, "eventoAtual:", !!eventoAtual, "processing:", processingEvent.current);

        // Remover o obst√°culo imediatamente para evitar detec√ß√£o dupla
        obs.destroy();
        obstacles.splice(i, 1);

        console.log("üßπ Obst√°culo removido ap√≥s colis√£o. Total restante:", obstacles.length);
        console.log("üé≤ Evento disparado:", eventoSorteado.texto);
        setShowPopup(true); // Mostrar o popup
        break; // Sair do loop ap√≥s detectar a colis√£o
      }
    }

    // Reposicionar os fundos para criar o efeito de loop
    // Considerar a escala aplicada aos backgrounds
    const bgWidth = bg1.width * bgScale;
    
    if (bg1.pos.x + bgWidth <= 0) {
      bg1.pos.x = bg2.pos.x + bgWidth;
    }
    if (bg2.pos.x + bgWidth <= 0) {
      bg2.pos.x = bg1.pos.x + bgWidth;
    }

    // Calcular progresso baseado nos pontos reais do caminho da rota (APENAS quando n√£o pausado)
    const progressPercent = calculatePathProgress(deltaTime);
    const previousProgress = progressRef.current;
    progressRef.current = progressPercent;
    setProgress(progressPercent);
    
    // Debug inicial do movimento removido

    // Consumir combust√≠vel de forma mais realista baseado no progresso
    const routeDistance = totalDistance || 500; // Usar dist√¢ncia da rota ou padr√£o
    const progressDelta = progressPercent - previousProgress; // Mudan√ßa no progresso
    const distanceInKm = (progressDelta / 100) * routeDistance; // Dist√¢ncia percorrida em km
    const consumptionRate = vehicle.consumption?.asphalt || 10; // km/L
    const fuelConsumption = Math.abs(distanceInKm) / consumptionRate; // Litros consumidos
    
    if (fuelConsumption > 0.001) { // S√≥ processar se houver consumo significativo
      const newFuelLevel = Math.max(0, currentFuel - fuelConsumption);
      
      setCurrentFuel((prevFuel) => {
        const updatedFuel = Math.max(0, prevFuel - fuelConsumption);
        setGasoline((updatedFuel / vehicle.maxCapacity) * 100);
        
        // Verificar game over apenas se combust√≠vel mudou significativamente
        if (prevFuel > 0 && updatedFuel <= 0) {
          setTimeout(() => checkGameOver(), 100); // Delay para garantir atualiza√ß√£o do estado
        }
        
        return updatedFuel;
      });
    }

    // Verificar se chegou ao destino
    if (progressPercent >= 100) {
      setGameEnded(true);
      gamePaused.current = true;
    }

  });

  // Minimap canvas removido - agora usando GameMiniMap component

});

    go("main");
    
    // Resetar estados de progresso para nova partida
    setCurrentPathIndex(0);
    currentPathIndexRef.current = 0;
    pathProgressRef.current = 0;
    progressRef.current = 0;
    setProgress(0);
    distanceTravelled.current = 0;
    
    // Resetar timer de cria√ß√£o de obst√°culos para dar um tempo antes do pr√≥ximo
    obstacleTimerRef.current = 0;
    
    // Garantir que o jogo n√£o esteja pausado ao inicializar
    gamePaused.current = false;
    
    // DEBUG: Log inicial removido
    
    // Marcar jogo como carregado ap√≥s tudo estar configurado
    setGameLoaded(true);
    
    // S√≥ resetar gameStartTime se n√£o houver progresso salvo
    if (!location.state?.savedProgress) {
      gameStartTime.current = Date.now();
      manualTimeAdjustment.current = 0; // Reset adjustment para novo jogo
      console.log("üïê gameStartTime inicializado para novo jogo:", new Date(gameStartTime.current).toLocaleTimeString());
    } else {
      console.log("üïê gameStartTime mantido do save carregado:", new Date(gameStartTime.current).toLocaleTimeString());
    }
    
    console.log("Jogo inicializado com sucesso!");

      } catch (error) {
        console.error("Erro ao inicializar o jogo:", error);
        setLoadingError(`Erro ao carregar o jogo: ${error}`);
        setGameLoaded(false);
        (window as any).__kaboom_initiated__ = false;
      }
    };

    // Iniciar o jogo ap√≥s um pequeno delay para garantir que o DOM esteja pronto
    setTimeout(initializeGame, 50);

    // Cleanup function
    return () => {
      console.log("Limpando recursos do jogo...");
      (window as any).__kaboom_initiated__ = false;
      gameInitialized.current = false;
      setGameLoaded(false);
      
      // Remover listener de resize
      if (handleResizeRef.current) {
        window.removeEventListener('resize', handleResizeRef.current);
      }
    };
    
  }, [vehicle.image, vehicle.name, vehicle.id]); // Depend√™ncias corretas

  useEffect(() => {
  if (gameEnded) {
    console.log("Jogo finalizado. Mostrando mensagem final.");
    // Limpar progresso salvo quando o jogo terminar
    localStorage.removeItem('savedGameProgress');
    // Log de progresso removido
    setShowEndMessage(true);
  }
}, [gameEnded]);


  const handleOptionClick = (choice: string) => {
    console.log("üéØ Processando escolha do evento:", choice);
    console.log("üîß Cooldown atual:", collisionCooldownRef.current);
    setPlayerChoice(choice);
    
    // Novo formato: "Descri√ß√£o - R$valor | tempo | combust√≠vel"
    // Extrair os valores usando regex
    const eventMatch = choice.match(/R\$(-?\d+)\s*\|\s*([+-]?\d+(?:\.\d+)?)h\s*\|\s*([+-]?\d+)L/);
    
    if (eventMatch) {
      const moneyChange = parseInt(eventMatch[1]);
      const timeChange = parseFloat(eventMatch[2]);
      const fuelChange = parseInt(eventMatch[3]);
      
             console.log("‚úÖ Impactos do evento:", { 
         dinheiro: moneyChange !== 0 ? `${moneyChange > 0 ? '+' : ''}${-moneyChange}` : '0',
         tempo: timeChange !== 0 ? `${timeChange > 0 ? '+' : ''}${timeChange}h` : '0h',
         combust√≠vel: fuelChange !== 0 ? `${fuelChange > 0 ? '+' : ''}${fuelChange}L` : '0L'
       });
       
       // Aplicar mudan√ßa no dinheiro
       if (moneyChange !== 0) {
         setMoney((prev: number) => {
           const newMoney = Math.max(0, prev - moneyChange); // Negativo pra custo, positivo pra economia
           const impact = -moneyChange;
           console.log(`üí∞ Dinheiro: R$${prev.toFixed(2)} ‚Üí R$${newMoney.toFixed(2)} (${impact > 0 ? '+' : ''}${impact})`);
           return newMoney;
         });
       }
       
       // Aplicar mudan√ßa no tempo
       if (timeChange !== 0) {
         const secondsChange = timeChange * 3600; // Converter horas para segundos
         
         // Aplicar ajuste manual que ser√° somado ao tempo base
         const oldAdjustment = manualTimeAdjustment.current;
         manualTimeAdjustment.current += secondsChange;
         
         setGameTime((prev: number) => {
           const newTime = Math.max(0, prev + secondsChange);
           
           console.log(`‚è±Ô∏è Evento aplicado - Tempo: ${formatTime(prev)} ‚Üí ${formatTime(newTime)} (${timeChange > 0 ? '+' : ''}${timeChange}h)`);
           console.log(`üîß Ajuste manual: ${oldAdjustment}s ‚Üí ${manualTimeAdjustment.current}s (${secondsChange > 0 ? '+' : ''}${secondsChange}s)`);
           console.log(`üîí Mudan√ßa de tempo permanente aplicada: ${timeChange}h`);
           
           return newTime;
         });
         
         // Log adicional para verificar se o ajuste permanece
         setTimeout(() => {
           console.log(`üîç Verifica√ß√£o p√≥s-evento - Ajuste manual mantido: ${manualTimeAdjustment.current}s`);
           console.log(`üîç Tempo atual no estado: ${formatTime(gameTime)}`);
         }, 2000);
       }
       
       // Aplicar mudan√ßa no combust√≠vel
       if (fuelChange !== 0) {
        setCurrentFuel((prev: number) => {
          const newFuel = Math.max(0, Math.min(vehicle.maxCapacity, prev + fuelChange));
          setGasoline((newFuel / vehicle.maxCapacity) * 100);
           console.log(`‚õΩ Combust√≠vel: ${prev.toFixed(1)}L ‚Üí ${newFuel.toFixed(1)}L (${fuelChange > 0 ? '+' : ''}${fuelChange}L)`);
          return newFuel;
        });
      }

       // Mostrar notifica√ß√£o visual dos impactos
       const showImpactNotification = () => {
         const impacts = [];
         if (moneyChange !== 0) {
           const impact = -moneyChange;
           impacts.push(`üí∞ ${impact > 0 ? '+' : ''}R$${impact}`);
         }
         if (timeChange !== 0) {
           impacts.push(`‚è±Ô∏è ${timeChange > 0 ? '+' : ''}${timeChange}h`);
         }
         if (fuelChange !== 0) {
           impacts.push(`‚õΩ ${fuelChange > 0 ? '+' : ''}${fuelChange}L`);
         }

         if (impacts.length > 0) {
           const notification = document.createElement('div');
           notification.innerHTML = `<strong>Impactos:</strong><br>${impacts.join('<br>')}`;
           notification.style.cssText = `
             position: fixed;
             top: 20%;
             left: 50%;
             transform: translateX(-50%);
             background: rgba(0, 0, 0, 0.9);
             color: white;
             padding: 15px 20px;
             border-radius: 10px;
             z-index: 3000;
             font-family: "Silkscreen", sans-serif;
             font-size: 14px;
             text-align: center;
             border: 2px solid #ffcc00;
             animation: impactFade 3s ease-in-out;
           `;

           const style = document.createElement('style');
           style.textContent = `
             @keyframes impactFade {
               0% { opacity: 0; transform: translateX(-50%) scale(0.8); }
               15% { opacity: 1; transform: translateX(-50%) scale(1); }
               85% { opacity: 1; transform: translateX(-50%) scale(1); }
               100% { opacity: 0; transform: translateX(-50%) scale(0.8); }
             }
           `;
           document.head.appendChild(style);
           document.body.appendChild(notification);

           setTimeout(() => {
             notification.remove();
             style.remove();
           }, 3000);
         }
       };

       // Mostrar notifica√ß√£o ap√≥s pequeno delay para garantir que os estados foram atualizados
       setTimeout(showImpactNotification, 100);
       
     } else {
       console.warn("Formato de evento n√£o reconhecido:", choice);
    }
    
    setEventoAtual(null);
    setShowPopup(false);
      collidedObstacle.current = null;
    processingEvent.current = false; // Resetar flag de processamento

    // Verificar condi√ß√µes de game over ap√≥s processar evento
    if (gameLoaded && checkGameOver()) {
      return;
    }

    if (gameEnded) {
      console.log("Jogo finalizado ap√≥s evento");
      setShowEndMessage(true);
      return;
    }

    // Despausar o jogo e resetar timer para dar um tempo maior ao jogador
    gamePaused.current = false;
    obstacleTimerRef.current = -8; // Dar 8 segundos antes do pr√≥ximo obst√°culo

    // Ativar um cooldown longo e destravar sistema depois de um tempo
    collisionCooldownRef.current = 3.0; // 3 segundos de cooldown
    
    // Destravar sistema de obst√°culos ap√≥s 8 segundos
    setTimeout(() => {
      obstacleSystemLockedRef.current = false;
      console.log("üîì Sistema de obst√°culos destravado ap√≥s evento");
    }, 8000);

    console.log("üéÆ Jogo despausado - sistema travado por 5s, cooldown:", collisionCooldownRef.current);
  };

  return (

    <div style={{ position: "relative" }}>
      
      {/* Indicador de carregamento */}
      {!gameLoaded && !loadingError && (
        <div style={{
          position: "fixed",
          top: "50%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          zIndex: 2000,
          backgroundColor: "rgba(0, 0, 0, 0.8)",
          color: "white",
          padding: "20px",
          borderRadius: "10px",
          textAlign: "center",
          fontSize: "18px"
        }}>
          <div>üéÆ Carregando jogo...</div>
          <div style={{ fontSize: "14px", marginTop: "10px" }}>
            Ve√≠culo: {vehicle.name}
          </div>
        </div>
      )}
      
      {/* Indicador de erro */}
      {loadingError && (
        <div style={{
          position: "fixed",
          top: "50%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          zIndex: 2000,
          backgroundColor: "rgba(220, 20, 60, 0.9)",
          color: "white",
          padding: "20px",
          borderRadius: "10px",
          textAlign: "center",
          fontSize: "16px"
        }}>
          <div>‚ùå Erro ao carregar o jogo</div>
          <div style={{ fontSize: "12px", marginTop: "10px" }}>
            {loadingError}
          </div>
          <button 
            onClick={() => window.location.reload()}
            style={{
              marginTop: "15px",
              padding: "8px 16px",
              backgroundColor: "white",
              color: "red",
              border: "none",
              borderRadius: "5px",
              cursor: "pointer"
            }}
          >
            Recarregar
          </button>
        </div>
      )}

     <div style={{
  position: "fixed",
  top: "2vh",
  left: "2vw",
  zIndex: 1000
}}>
  <button
    onClick={handleSaveAndPause} 
    style={{
      backgroundColor: "#E3922A",
      border: "2px solid #000",
      borderRadius: "8px",
      padding: "min(1.5vh, 10px)",
      cursor: "pointer",
      display: "flex",
      alignItems: "center",
      justifyContent: "center",
      boxShadow: "2px 2px 4px rgba(0,0,0,0.3)",
      transition: "all 0.2s ease",
      width: "min(6vh, 50px)",
      height: "min(6vh, 50px)"
    }}
    title="Pausar e Salvar Progresso" 
    onMouseOver={(e) => e.currentTarget.style.backgroundColor = "#FFC06F"}
    onMouseOut={(e) => e.currentTarget.style.backgroundColor = "#E3922A"}
  >
    <img 
      src="src/assets/pausa.png"
      alt="Pausar" 
      style={{ 
        width: 'min(3vh, 24px)', 
        height: 'min(3vh, 24px)' 
      }}
    />
  </button>
</div>


{/* Barra de progresso  */}
<div style={{
  position: "fixed",
  top: "2vh", // 2% da altura da viewport
  left: "50%",
  transform: "translateX(-50%)",
  width: "min(60vw, 800px)", // M√°ximo de 800px ou 60% da largura
  height: "min(4vh, 30px)", // M√°ximo de 30px ou 4% da altura
  backgroundColor: "#eee",
  zIndex: 1000,
  overflow: "hidden",
  borderRadius: "20px",
  padding: "2px"
}}>
  {/* Barra de progresso azul */}
  <div style={{
    width: `${progress}%`,
    height: "100%",
    backgroundColor: "#0077cc",
    borderRadius: "20px 20px"
  }}></div>

  {/* Checkpoints fixos */}
  {[25, 50, 75].map((p) => (
    <div key={p} style={{
      position: "absolute",
      left: `${p}%`,
      top: "15%",
      transform: "translateX(-50%)",
      width: "20px",
      height: "20px",
      backgroundColor: "#fff",
      border: "2px solid #999",
      borderRadius: "50%",
      zIndex: 101,
    }}></div>
  ))}

  {/* Porcentagem atual */}
  <span style={{
    position: "absolute",
    right: "10px",
    top: "7px",
    fontSize: "12px",
    fontWeight: "bold",
    color: "#333",
    zIndex: 102,
    display: "flex",
    alignItems: "center"
  }}>
    {Math.floor(progress)}%
  </span>
</div>

  {/* Container para minimapa e informa√ß√µes no canto superior direito */}
  <div style={{
    position: "fixed",
    top: "2vh",
    right: "2vw",
    zIndex: 1000,
    display: "flex",
    flexDirection: "column",
    gap: "1vh",
    alignItems: "flex-end"
  }}>
    {/* Mapa em tempo real mostrando a posi√ß√£o do caminh√£o na rota */}
    {selectedRoute?.pathCoordinates && (
      <div 
        style={{
          width: "min(12vw, 180px)",
          height: "min(12vw, 180px)",
          cursor: "pointer",
          transition: "transform 0.2s ease, box-shadow 0.2s ease",
          borderRadius: "50%",
          overflow: "hidden"
        }}
        onClick={handleMapModalToggle}
        onMouseOver={(e) => {
          e.currentTarget.style.transform = "scale(1.05)";
          e.currentTarget.style.boxShadow = "0 4px 15px rgba(0,0,0,0.3)";
        }}
        onMouseOut={(e) => {
          e.currentTarget.style.transform = "scale(1)";
          e.currentTarget.style.boxShadow = "none";
        }}
        title="Clique para abrir o mapa completo"
      >
      <GameMiniMap
        pathCoordinates={selectedRoute.pathCoordinates}
        currentPathIndex={currentPathIndex}
        pathProgress={pathProgressRef.current}
        vehicle={vehicle}
        progress={progress}
          className="w-full h-full border-2 border-white rounded-full overflow-hidden"
      />
      </div>
    )}

    {/* Informa√ß√µes do jogo: dinheiro, combust√≠vel e tempo */}
    <div style={{
      padding: "min(2vh, 15px)",
      backgroundColor: "rgba(255, 255, 255, 0.9)",
      borderRadius: "12px",
      fontFamily: "monospace",
      width: "min(18vw, 220px)",
      boxShadow: "0 2px 10px rgba(0,0,0,0.1)",
      fontSize: "min(2vw, 16px)"
    }}>
      {/* Dinheiro */}
      <div style={{ fontSize: "16px", marginBottom: "10px", color: "#333" }}>
        üí∞ <strong>R$ {money.toFixed(2)}</strong>
      </div>
      
      {/* Combust√≠vel */}
      <div style={{ marginBottom: "10px" }}>
        <div style={{
          display: "flex",
          alignItems: "center",
          gap: "8px",
          marginBottom: "4px"
        }}>
          <span style={{ fontSize: "16px" }}>‚õΩ</span>
          <div style={{
            height: "10px",
            width: "120px",
            backgroundColor: "#ddd",
            borderRadius: "5px",
            overflow: "hidden"
          }}>
            <div style={{
              width: `${gasoline}%`,
              height: "100%",
              backgroundColor: gasoline > 30 ? "#00cc66" : gasoline > 15 ? "#ffaa00" : "#cc3300",
              transition: "width 0.3s ease"
            }}></div>
          </div>
        </div>
        <div style={{ fontSize: "12px", color: "#666", paddingLeft: "24px" }}>
          {currentFuel.toFixed(1)}L / {vehicle.maxCapacity}L
        </div>
      </div>

      {/* Tempo de viagem */}
      <div style={{ fontSize: "14px", color: "#333" }}>
        <div style={{ display: "flex", alignItems: "center", gap: "8px" }}>
          <span style={{ fontSize: "16px" }}>‚è±Ô∏è</span>
          <strong>{formatTime(gameTime)}</strong>
        </div>
      </div>

      {/* Informa√ß√µes da rota */}
      {selectedRoute && (
        <div style={{ fontSize: "12px", color: "#666", marginTop: "8px", borderTop: "1px solid #eee", paddingTop: "8px" }}>
          <div>{selectedRoute.name}</div>
          <div>{selectedRoute.distance} km</div>
        </div>
      )}
    </div>
  </div>

      <canvas 
        ref={canvasRef} 
        width={window.innerWidth} 
        height={window.innerHeight}
        style={{
          display: "block",
          width: "100vw",
          height: "100vh",
          position: "fixed",
          top: 0,
          left: 0,
          zIndex: 1
        }}
      />

      
  
    {eventoAtual && !gameEnded && (

  <div
    style={{
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      backgroundColor: "#f9f9f9",
      padding: "30px",
      borderRadius: "15px",
      boxShadow: "0 8px 25px rgba(0,0,0,0.2)",
      textAlign: "center",
      minWidth: "400px",
      maxWidth: "600px",
      zIndex: 2000,
      border: "3px solid #333"
    }}
  >
   
    {/* Texto e descri√ß√£o separados */}
    <div className="tittle" style={{ marginBottom: "10px" }}>
      <p style={{ fontSize: "28px",
        color: "#333",
        marginBottom: "5px",
        fontWeight: "bold" }}>
        {eventoAtual.texto}
      </p>
      <p style={{ fontSize: "16px",
         color: "#555" }}>
        {eventoAtual.desc}
      </p>
    </div>

    {/* Bot√µes separados */}
    <div
      style={{
        display: "flex",
        justifyContent: "center",
        gap: "20px",
        flexWrap: "wrap",
        marginTop: "20px"
      }}
    >
      {eventoAtual.opcoes.map((opcao, index) => {
        // Extrair descri√ß√£o e impactos para melhor formata√ß√£o
        const parts = opcao.split(' - ');
        const description = parts[0];
        const impacts = parts[1] || '';
        
        return (
        <button
          key={index}
          onClick={() => handleOptionClick(opcao)}
          style={{
              padding: "15px 20px",
              borderRadius: "10px",
              border: "2px solid #fff",
            backgroundColor: index % 2 === 0 ? "#0077cc" : "#e63946",
            color: "white",
              fontSize: "14px",
            cursor: "pointer",
              transition: "all 0.3s ease",
              minWidth: "200px",
              textAlign: "center",
              lineHeight: "1.4",
              boxShadow: "0 2px 4px rgba(0,0,0,0.2)"
            }}
            onMouseOver={(e) => {
              e.currentTarget.style.backgroundColor = index % 2 === 0 ? "#005fa3" : "#c92a2a";
              e.currentTarget.style.transform = "scale(1.02)";
              e.currentTarget.style.boxShadow = "0 4px 8px rgba(0,0,0,0.3)";
            }}
            onMouseOut={(e) => {
              e.currentTarget.style.backgroundColor = index % 2 === 0 ? "#0077cc" : "#e63946";
              e.currentTarget.style.transform = "scale(1)";
              e.currentTarget.style.boxShadow = "0 2px 4px rgba(0,0,0,0.2)";
            }}
          >
            <div style={{ fontWeight: "bold", marginBottom: "5px" }}>
              {description}
            </div>
            <div style={{ 
              fontSize: "12px", 
              opacity: "0.9", 
              fontFamily: "monospace",
              backgroundColor: "rgba(255,255,255,0.1)",
              padding: "4px 8px",
              borderRadius: "4px",
              letterSpacing: "0.5px"
            }}>
              {impacts}
            </div>
        </button>
        );
      })}
    </div>
  </div>
)}
{showEndMessage && (
  <div className="endMessage"
    style={{
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      backgroundColor: "white",
      padding: "30px",
      borderRadius: "15px",
      boxShadow: "0 8px 25px rgba(0,0,0,0.3)",
      zIndex: 2000,
      textAlign: "center",
      maxWidth: "400px",
      minWidth: "350px"
    }}
  >
    <h2 style={{ color: "#00cc66", marginBottom: "20px" }}>üèÅ Parab√©ns!</h2>
    <p style={{ fontSize: "18px", marginBottom: "20px" }}>Voc√™ completou a viagem com sucesso!</p>
    
    <div style={{ 
      backgroundColor: "#f8f9fa", 
      padding: "15px", 
      borderRadius: "8px", 
      marginBottom: "20px",
      textAlign: "left"
    }}>
      <h3 style={{ margin: "0 0 10px 0", color: "#333" }}>Resultados Finais:</h3>
      <p style={{ margin: "5px 0" }}>üöõ Ve√≠culo: <strong>{vehicle.name}</strong></p>
      {selectedRoute && (
        <p style={{ margin: "5px 0" }}>üó∫Ô∏è Rota: <strong>{selectedRoute.name}</strong></p>
      )}
      <p style={{ margin: "5px 0" }}>‚è±Ô∏è Tempo total: <strong>{formatTime(gameTime)}</strong></p>
      <p style={{ margin: "5px 0" }}>üí∞ Dinheiro final: <strong>R$ {money.toFixed(2)}</strong></p>
      <p style={{ margin: "5px 0" }}>‚õΩ Combust√≠vel restante: <strong>{currentFuel.toFixed(1)}L ({gasoline.toFixed(1)}%)</strong></p>
    </div>
    
    <div style={{ display: "flex", gap: "10px", justifyContent: "center" }}>
      <button
        onClick={() => navigate('/routes')}
        style={{
          padding: "12px 20px",
          backgroundColor: "#0077cc",
          color: "white",
          border: "none",
          borderRadius: "8px",
          cursor: "pointer",
          fontSize: "16px",
          fontWeight: "bold"
        }}
      >
        Nova Viagem
      </button>
      <button
        onClick={() => navigate('/select-vehicle')}
        style={{
          padding: "12px 20px",
          backgroundColor: "#6c757d",
          color: "white",
          border: "none",
          borderRadius: "8px",
          cursor: "pointer",
          fontSize: "16px"
        }}
      >
        Trocar Ve√≠culo
      </button>
    </div>
  </div>
)}

{/* Modal do Mapa Completo */}
{showMapModal && selectedRoute && (
  <div 
    style={{
      position: "fixed",
      top: 0,
      left: 0,
      width: "100vw",
      height: "100vh",
      backgroundColor: "rgba(0, 0, 0, 0.8)",
      zIndex: 3000,
      display: "flex",
      justifyContent: "center",
      alignItems: "center",
      padding: "20px"
    }}
    onClick={handleMapModalToggle}
  >
    <div 
      style={{
        width: "95%",
        height: "95%",
        backgroundColor: "white",
        borderRadius: "10px",
        overflow: "hidden",
        position: "relative",
        boxShadow: "0 10px 30px rgba(0,0,0,0.5)"
      }}
      onClick={(e) => e.stopPropagation()}
    >
      {/* Bot√£o para fechar o modal */}
      <button
        onClick={handleMapModalToggle}
        style={{
          position: "absolute",
          top: "15px",
          right: "15px",
          zIndex: 3001,
          backgroundColor: "#e63946",
          color: "white",
          border: "none",
          borderRadius: "50%",
          width: "40px",
          height: "40px",
          fontSize: "20px",
          fontWeight: "bold",
          cursor: "pointer",
          boxShadow: "0 2px 10px rgba(0,0,0,0.3)",
          display: "flex",
          alignItems: "center",
          justifyContent: "center"
        }}
        title="Fechar mapa"
      >
        √ó
      </button>

      {/* T√≠tulo do modal */}
      <div 
        style={{
          position: "absolute",
          top: "15px",
          left: "15px",
          zIndex: 3001,
          backgroundColor: "rgba(0, 0, 0, 0.7)",
          color: "white",
          padding: "10px 15px",
          borderRadius: "5px",
          fontFamily: '"Silkscreen", monospace',
          fontSize: "16px",
          fontWeight: "bold"
        }}
      >
        üó∫Ô∏è {selectedRoute.name} - Posi√ß√£o Atual do Caminh√£o
      </div>

      {/* MapComponent dentro do modal */}
      <div style={{ width: "100%", height: "100%" }}>
        <MapComponent 
          preSelectedRoute={selectedRoute}
          preSelectedVehicle={vehicle}
          preAvailableMoney={money}
          showControls={false}
          externalProgress={{
            currentPathIndex: currentPathIndex,
            pathProgress: pathProgressRef.current,
            totalProgress: progress
          }}
        />
      </div>
    </div>
  </div>
)}
{/* NOVO: Renderiza o menu de pausa */}
      <PauseMenu
        isVisible={isPaused}
        onResume={togglePause}
        onRestart={handleRestart}
        onGoToProfile={handleGoToProfile}
      />
</div>


  );
}
</file>

<file path="src/pages/mapaRota/FuelModal.tsx">
// src/pages/mapaRota/FuelModal.tsx

import React, { useState } from 'react';
import { Vehicle } from '../../types/vehicle';

interface FuelModalProps {
  vehicle: Vehicle;
  availableMoney: number;
  onRefuel: (updatedVehicle: Vehicle, newBalance: number) => void;
  onClose: () => void;
}

export const FuelModal: React.FC<FuelModalProps> = ({
  vehicle,
  availableMoney,
  onRefuel,
  onClose
}) => {
  const [selectedVehicle, setSelectedVehicle] = useState<Vehicle>({ ...vehicle });
  const [fuelAmount, setFuelAmount] = useState<'full' | 'half' | 'quarter'>('full');
  const [availableBalance, setAvailableBalance] = useState(availableMoney);
  const [previewFuel, setPreviewFuel] = useState<number>(vehicle.maxCapacity); // Preview inicia com a op√ß√£o 'full' selecionada

  const fuelCostPerLiter = 5.5;

  const calculateFuelCost = (option: 'full' | 'half' | 'quarter') => {
    const maxCapacity = selectedVehicle.maxCapacity;
    let fuelToAdd = 0;

    // Como o tanque sempre come√ßa vazio, calculamos a quantidade total desejada
    switch (option) {
      case 'full':
        fuelToAdd = maxCapacity;
        break;
      case 'half':
        fuelToAdd = maxCapacity / 2;
        break;
      case 'quarter':
        fuelToAdd = maxCapacity / 4;
        break;
    }

    return fuelToAdd * fuelCostPerLiter;
  };

  const handleRefuel = () => {
    const cost = calculateFuelCost(fuelAmount);

    if (cost <= availableBalance) {
      // Calcular o novo combust√≠vel baseado na op√ß√£o selecionada
      const newCurrentFuel = fuelAmount === 'full'
        ? selectedVehicle.maxCapacity
        : fuelAmount === 'half'
          ? selectedVehicle.maxCapacity / 2
          : selectedVehicle.maxCapacity / 4;

      const updatedVehicle = {
        ...selectedVehicle,
        currentFuel: newCurrentFuel
      };

      const newBalance = availableBalance - cost;

      setSelectedVehicle(updatedVehicle);
      setAvailableBalance(newBalance);

      onRefuel(updatedVehicle, newBalance);
    } else {
      alert('Saldo insuficiente para abastecer!');
    }
  };

  const calculatePreviewFuel = (option: 'full' | 'half' | 'quarter'): number => {
    const max = selectedVehicle.maxCapacity;

    switch (option) {
      case 'full':
        return max;
      case 'half':
        return max / 2;
      case 'quarter':
        return max / 4;
      default:
        return 0; // Tanque vazio por padr√£o
    }
  };


  return (
    <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[9999] p-4 overflow-y-auto">
      <div className="bg-[#200259] rounded-lg shadow-2xl border-4 border-black max-w-4xl w-full p-6 my-8">
        <h1 className="text-2xl font-['Silkscreen'] font-bold text-[#E3922A] text-center mb-4">
          ABASTECER VE√çCULO
        </h1>
        <p className="font-['Silkscreen'] text-white text-center text-md font-bold text-xl">
          Saldo ap√≥s: R$ {(availableMoney - calculateFuelCost(fuelAmount)).toFixed(2)}
        </p>

        <div className="bg-[#FFC06F] p-4 rounded-lg shadow-md border-2 border-black mb-6">
          <div className="flex flex-col md:flex-row gap-4">
            <div className="flex justify-center items-center md:w-1/3">
              <img
                src={selectedVehicle.image}
                alt={selectedVehicle.name}
                className="h-40 object-contain"
              />
            </div>

            <div className="md:w-2/3">
              <h2 className="text-xl font-['Silkscreen'] font-bold mb-3 text-black text-center border-b-2 border-black pb-2">
                {selectedVehicle.name.toUpperCase()}
              </h2>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <h3 className="font-['Silkscreen'] text-lg font-bold text-black mb-2">CONSUMO</h3>
                  <p className="font-sans text-black text-md mb-1">- ASFALTO: {selectedVehicle.consumption.asphalt}KM/L</p>
                  <p className="font-sans text-black text-md mb-3">- TERRA: {selectedVehicle.consumption.dirt}KM/L</p>
                </div>

                <div>
                  <h3 className="font-['Silkscreen'] text-lg font-bold text-black mb-2">COMBUST√çVEL</h3>
                  <p className="font-sans text-black text-md mb-1">ATUAL: 0L</p>
                  <p className="font-sans text-black text-md mb-3">M√ÅXIMO: {selectedVehicle.maxCapacity}L</p>
                </div>
              </div>

              <p className="font-sans text-black text-md mb-2">N√çVEL DO TANQUE</p>
              <div className="w-full bg-gray-200 rounded-full h-6 border-2 border-black mb-4 relative overflow-hidden shadow-inner">
                {/* Fundo branco (tanque vazio) */}
                <div className="w-full h-full bg-white rounded-full"></div>
                
                {/* Barra de preview - quantidade que ser√° abastecida (verde) */}
                <div
                  className="bg-gradient-to-r from-green-400 via-green-500 to-green-600 h-full absolute top-0 left-0 transition-all duration-300"
                  style={{ width: `${(previewFuel / selectedVehicle.maxCapacity) * 100}%` }}
                ></div>
                
                <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-black">
                  0L ‚Üí {previewFuel.toFixed(0)}L / {selectedVehicle.maxCapacity}L
                </div>
              </div>
            </div>
          </div>

          <div className="mt-4">
            <h3 className="font-['Silkscreen'] text-lg font-bold text-black mb-2">ABASTECER</h3>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <p className="font-sans text-black text-md mb-2">PRE√áO DO DIESEL: R$ {fuelCostPerLiter.toFixed(2)}/L</p>
              </div>

              <div className="md:col-span-2">
                <div className="flex space-x-2 mb-2">
                  <button
                    onClick={() => {
                      const newPreview = calculatePreviewFuel('quarter');
                      setFuelAmount('quarter');
                      setPreviewFuel(newPreview);
                    }}
                    className={`flex-1 py-2 border-2 border-black rounded-md ${fuelAmount === 'quarter' ? 'bg-[#E3922A]' : 'bg-gray-200'}`}
                  >
                    1/4
                  </button>
                  <button
                    onClick={() => {
                      const newPreview = calculatePreviewFuel('half');
                      setFuelAmount('half');
                      setPreviewFuel(newPreview);
                    }}
                    className={`flex-1 py-2 border-2 border-black rounded-md ${fuelAmount === 'half' ? 'bg-[#E3922A]' : 'bg-gray-200'}`}
                  >
                    1/2
                  </button>
                  <button
                    onClick={() => {
                      const newPreview = calculatePreviewFuel('full');
                      setFuelAmount('full');
                      setPreviewFuel(newPreview);
                    }}
                    className={`flex-1 py-2 border-2 border-black rounded-md ${fuelAmount === 'full' ? 'bg-[#E3922A]' : 'bg-gray-200'}`}
                  >
                    CHEIO
                  </button>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
              <p className="font-sans text-black text-md font-bold text-xl">
                Custo: R$ {calculateFuelCost(fuelAmount).toFixed(2)}
              </p>

              <button
                onClick={handleRefuel}
                className="bg-[#E3922A] text-black font-bold py-2 px-4 rounded-md w-full shadow-md border-2 border-black hover:bg-[#FFC06F]"
              >
                ABASTECER
              </button>
            </div>
          </div>
        </div>

        <div className="flex justify-center">
          <button
            onClick={onClose}
            className="bg-gray-600 text-white font-bold py-3 px-8 rounded-md shadow-md border-2 border-black hover:bg-gray-700"
          >
            FECHAR
          </button>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/pages/Perfil/PerfilPage.tsx">
import { useNavigate } from "react-router-dom";
import { useState, useRef } from "react";
import { useQuery } from "@tanstack/react-query";
import { useAuth } from "../../contexts/AuthContext";
import { TeamService } from "../../api/teamService";
import { Button } from "../../components/ui/button";
import {
  Card,
  CardContent,
} from "../../components/ui/card";
import { PlayIcon, Trophy, TruckIcon, MapPin, DollarSign, Camera } from 'lucide-react';

interface UserStats {
  deliveries: number;
  distance: number;
  earnings: number;
  victories: number;
}

export const PerfilPage = () => {
  const navigate = useNavigate();
  const fileInputRef = useRef<HTMLInputElement>(null);
  const { user, logout } = useAuth();

  // Buscar dados da equipe se o usu√°rio estiver em uma
  const { data: teamData } = useQuery({
    queryKey: ['teamDetails', user?.equipe],
    queryFn: () => TeamService.getTeamDetails(user!.equipe!),
    enabled: !!user?.equipe, // S√≥ busca se o usu√°rio estiver em uma equipe
  });

  // Stats ainda est√°ticos (podem ser implementados depois)
  const [userStats] = useState<UserStats>({
    deliveries: 12,
    distance: 12,
    earnings: 12,
    victories: 12
  });

  // Avatar local (melhoria futura: integrar com backend)
  const [localAvatar, setLocalAvatar] = useState<string>("/mario.png");

  const handlePlayNow = () => {
    navigate("/select-vehicle");
  };

  const handleContinueGame = () => {
    // Verificar se h√° progresso salvo
    const savedProgress = localStorage.getItem('savedGameProgress');
    
    if (savedProgress) {
      try {
        const gameProgress = JSON.parse(savedProgress);
        console.log('Carregando progresso salvo:', gameProgress);
        
        // Navegar para o jogo com o progresso salvo
        navigate('/game', {
          state: {
            selectedVehicle: gameProgress.vehicle,
            availableMoney: gameProgress.money,
            selectedRoute: gameProgress.selectedRoute,
            savedProgress: {
              currentFuel: gameProgress.currentFuel,
              progress: gameProgress.progress,
              currentPathIndex: gameProgress.currentPathIndex,
              pathProgress: gameProgress.pathProgress,
              gameTime: gameProgress.gameTime
            }
          }
        });
      } catch (error) {
        console.error('Erro ao carregar progresso:', error);
        alert('Erro ao carregar o jogo salvo. Iniciando novo jogo...');
        navigate("/select-vehicle");
      }
    } else {
      // Se n√£o h√° progresso salvo, mostrar op√ß√£o de novo jogo
      const startNewGame = window.confirm('N√£o h√° jogo salvo. Deseja iniciar um novo jogo?');
      if (startNewGame) {
        navigate("/select-vehicle");
      }
    }
  };

  const handleCheckRanking = () => {
    // Navega para o ranking passando informa√ß√£o de que veio do perfil
    navigate("/ranking", { state: { from: 'profile' } });
  };

  const handlePhotoUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (file) {
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const result = e.target?.result;
          if (typeof result === 'string') {
            setLocalAvatar(result);
          }
        };
        reader.readAsDataURL(file);
      } else {
        alert('Por favor, selecione apenas arquivos de imagem (PNG, JPG, GIF, etc.)');
      }
    }
  };

  const handleClickUpload = () => {
    fileInputRef.current?.click();
  };

  const handleEditProfile = () => {
    navigate("/perfil/editar");
  };

  const handleChangePassword = () => {
    navigate("/mudar-senha");
  };

  const handleLogout = () => {
    logout();
    navigate("/login");
  };

  const handleManageTeam = () => {
    if (user?.equipe) {
      // Se est√° em uma equipe, vai para editar
      navigate("/perfil/editar-equipe");
    } else {
      // Se n√£o est√° em uma equipe, vai para escolher
      navigate("/choose-team");
    }
  };

  // Se n√£o h√° usu√°rio logado, redireciona
  if (!user) {
    navigate("/login");
    return null;
  }

  // Calcula dados din√¢micos baseados no usu√°rio real
  // PRIORIZAR NOME COMPLETO - se existir first_name E last_name, usa eles
  const displayName = user.first_name && user.last_name
    ? `${user.first_name} ${user.last_name}`
    : user.nickname || user.username;

  // Level e XP podem ser calculados baseado nas stats (implementa√ß√£o futura)
  const level = 12;
  const xp = 2450;
  const maxXp = 3000;
  const xpPercentage = Math.round((xp / maxXp) * 100);

  // Nome da equipe - agora din√¢mico
  const teamDisplayName = teamData?.nome || "SEM EQUIPE";

  const titleStyle = {
    color: "#E3922A",
    textShadow: "2px 3px 0.6px #000"
  };

  return (
    <div className="bg-white flex flex-row justify-center w-full">
      <div className="w-full min-h-screen [background:linear-gradient(180deg,rgba(57,189,248,1)_0%,rgba(154,102,248,1)_100%)] relative overflow-hidden">
        {/* Decorative clouds */}
        <img
          className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right"
          alt="Cloud decoration"
          src="/nuvemleft.png"
        />
        <img
          className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110"
          alt="Cloud decoration"
          src="/nuvemright.png"
        />

        {/* Hidden file input for photo upload */}
        <input
          type="file"
          ref={fileInputRef}
          onChange={handlePhotoUpload}
          accept="image/*"
          className="hidden"
        />

        {/* Main content */}
        <div className="max-w-5xl mx-auto pt-20 px-4 relative z-10">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">

            {/* Left column - Profile info */}
            <div className="space-y-4">
              <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
                <CardContent className="p-4">
                  <div className="text-center">
                    <h2 className="[font-family:'Silkscreen',Helvetica] font-bold text-2xl pb-1 border-b-2 border-black" style={titleStyle}>
                      SEU PERFIL
                    </h2>

                    {/* Avatar section */}
                    <div className="mt-3 flex justify-center">
                      <div className="relative">
                        <div className="w-24 h-24 rounded-full bg-teal-100 border-4 border-teal-500 flex items-center justify-center overflow-hidden relative group">
                          <img
                            src={localAvatar}
                            alt="Avatar"
                            className="w-20 h-20 object-cover"
                          />

                          {/* Upload overlay */}
                          <div
                            className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer rounded-full"
                            onClick={handleClickUpload}
                          >
                            <Camera size={20} className="text-white" />
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* User name - usando dados reais */}
                    <h3 className="[font-family:'Silkscreen',Helvetica] font-bold text-center text-xl mt-2">
                      {displayName.toUpperCase()}
                    </h3>

                    {/* Level display */}
                    <div className="flex items-center justify-center mt-1">
                      <span className="text-yellow-500 mr-1">üèÜ</span>
                      <span className="[font-family:'Silkscreen',Helvetica]">
                        N√çVEL {level}
                      </span>
                    </div>

                    {/* XP Progress bar */}
                    <div className="mt-4">
                      <div className="flex justify-between text-xs [font-family:'Silkscreen',Helvetica] mb-1">
                        <span>XP: {xp}/{maxXp}</span>
                        <span>{xpPercentage}%</span>
                      </div>
                      <div className="w-full h-4 bg-gray-200 rounded-full overflow-hidden border border-black">
                        <div
                          className="h-full bg-yellow-500"
                          style={{ width: `${xpPercentage}%` }}
                        ></div>
                      </div>
                    </div>

                    {/* Team info - usando dados reais do backend */}
                    <div
                      className="mt-4 [font-family:'Silkscreen',Helvetica] cursor-pointer hover:bg-gray-100 p-2 rounded transition-colors"
                      onClick={handleManageTeam}
                    >
                      <span className="font-bold">EQUIPE: </span>
                      <span className={`font-bold ${user.equipe ? 'text-orange-500' : 'text-gray-500'}`}>
                        {teamDisplayName}
                      </span>
                      <div className="text-xs text-gray-600 mt-1">
                        {user.equipe ? 'Clique para gerenciar' : 'Clique para entrar em uma equipe'}
                      </div>
                    </div>

                    {/* Action buttons */}
                    <div className="grid grid-cols-3 gap-2 mt-3">
                      <Button
                        variant="outline"
                        className="flex flex-col items-center justify-center h-16 border-2 border-black"
                        onClick={handleEditProfile}
                      >
                        <span className="text-2xl">üë§</span>
                        <span className="text-xs [font-family:'Silkscreen',Helvetica]">EDITAR PERFIL</span>
                      </Button>
                      <Button
                        variant="outline"
                        className="flex flex-col items-center justify-center h-16 border-2 border-black"
                        onClick={handleChangePassword}
                      >
                        <span className="text-2xl">üîë</span>
                        <span className="text-xs [font-family:'Silkscreen',Helvetica]">SENHA</span>
                      </Button>
                      <Button
                        variant="outline"
                        className="flex flex-col items-center justify-center h-16 border-2 border-black"
                        onClick={handleLogout}
                      >
                        <span className="text-2xl">‚Ü™Ô∏è</span>
                        <span className="text-xs [font-family:'Silkscreen',Helvetica]">SAIR</span>
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Right column - Game info and stats */}
            <div className="space-y-4">
              {/* Play game card */}
              <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
                <CardContent className="p-4">
                  {/* Game title and play button */}
                  <div className="flex justify-between items-center">
                    {/* Game info */}
                    <div>
                      <h2 className="[font-family:'Silkscreen',Helvetica] font-bold text-2xl" style={titleStyle}>
                        ENTREGA EFICIENTE
                      </h2>
                      <p className="[font-family:'Silkscreen',Helvetica] text-sm mt-1">
                        CONTINUE SUA JORNADA DE ENTREGAS!
                      </p>
                    </div>

                    {/* Play button */}
                    <Button
                      onClick={handlePlayNow}
                      className="bg-orange-400 text-black hover:bg-orange-500 h-12 flex items-center justify-between px-4 rounded border-2 border-black [font-family:'Silkscreen',Helvetica] font-bold"
                    >
                      <span>JOGAR AGORA</span>
                      <PlayIcon className="ml-2" />
                    </Button>
                  </div>

                  {/* Other games link */}
                  <div className="text-center mt-1">
                    <button
                      onClick={() => navigate("/game-selection")}
                      className="text-xs underline [font-family:'Silkscreen',Helvetica] text-blue-500"
                    >
                      JOGAR OUTRO JOGO!
                    </button>
                  </div>
                </CardContent>
              </Card>

              {/* Stats grid */}
              <div className="grid grid-cols-4 gap-3">
                {/* Deliveries */}
                <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
                  <CardContent className="py-3 px-4 flex flex-col items-center">
                    <TruckIcon size={24} />
                    <div className="[font-family:'Silkscreen',Helvetica] text-center mt-1">
                      <span className="text-xs">ENTREGAS</span>
                      <div className="font-bold">{userStats.deliveries}</div>
                    </div>
                  </CardContent>
                </Card>

                {/* Distance */}
                <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
                  <CardContent className="py-3 px-4 flex flex-col items-center">
                    <MapPin size={24} color="#4ade80" />
                    <div className="[font-family:'Silkscreen',Helvetica] text-center mt-1">
                      <span className="text-xs">DIST√ÇNCIA</span>
                      <div className="font-bold">{userStats.distance}</div>
                    </div>
                  </CardContent>
                </Card>

                {/* Earnings */}
                <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
                  <CardContent className="py-3 px-4 flex flex-col items-center">
                    <DollarSign size={24} color="#eab308" />
                    <div className="[font-family:'Silkscreen',Helvetica] text-center mt-1">
                      <span className="text-xs">GANHOS</span>
                      <div className="font-bold">{userStats.earnings}</div>
                    </div>
                  </CardContent>
                </Card>

                {/* Victories */}
                <Card className="border-2 border-solid border-black rounded-lg overflow-hidden">
                  <CardContent className="py-3 px-4 flex flex-col items-center">
                    <span className="text-2xl">üèÜ</span>
                    <div className="[font-family:'Silkscreen',Helvetica] text-center mt-1">
                      <span className="text-xs">VIT√ìRIAS</span>
                      <div className="font-bold">{userStats.victories}</div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Action cards */}
              <div className="grid grid-cols-2 gap-3">
                {/* Ranking card - agora com cursor pointer */}
                <Card className="border-2 border-solid border-black rounded-lg overflow-hidden cursor-pointer hover:bg-gray-50 transition-colors">
                  <CardContent className="p-4" onClick={handleCheckRanking}>
                    <div className="flex items-center">
                      <Trophy size={32} className="text-yellow-500" />
                      <div className="ml-3">
                        <h3 className="[font-family:'Silkscreen',Helvetica] font-bold" style={titleStyle}>
                          RANKING
                        </h3>
                        <p className="[font-family:'Silkscreen',Helvetica] text-xs">
                          VEJA OS MELHORES JOGADORES
                        </p>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                {/* Continue game card */}
                <Card className="border-2 border-solid border-black rounded-lg overflow-hidden cursor-pointer hover:bg-gray-50 cursor-pointer hover:bg-gray-50 transition-colors">
                  <CardContent className="p-4" onClick={handleContinueGame}>
                    <div className="flex items-center">
                      <div className="w-8 h-8 bg-purple-700 rounded-full flex items-center justify-center">
                        <span className="text-white text-2xl">{localStorage.getItem('savedGameProgress') ? '‚è±Ô∏è' : 'üéÆ'}</span>
                      </div>
                      <div className="ml-3">
                        <h3 className="[font-family:'Silkscreen',Helvetica] font-bold" style={titleStyle}>
                          {localStorage.getItem('savedGameProgress') ? 'CONTINUAR' : 'NOVO JOGO'}
                        </h3>
                        <p className="[font-family:'Silkscreen',Helvetica] text-xs">
                          {localStorage.getItem('savedGameProgress') 
                            ? 'RETOMAR A √öLTIMA PARTIDA' 
                            : 'INICIAR NOVA AVENTURA'}
                        </p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PerfilPage;
</file>

<file path="package.json">
{
  "name": "app",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@radix-ui/react-dialog": "^1.1.14",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slot": "^1.2.3",
    "@tanstack/react-query": "^5.80.6",
    "@tanstack/react-query-devtools": "^5.80.6",
    "@types/react-router-dom": "^5.3.3",
    "axios": "^1.9.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "embla-carousel": "^8.6.0",
    "embla-carousel-react": "^8.6.0",
    "http-proxy-middleware": "^3.0.5",
    "kaboom": "^3000.1.17",
    "leaflet": "^1.9.4",
    "lucide-react": "^0.506.0",
    "radix-ui": "^1.3.4",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-leaflet": "^5.0.0",
    "react-router-dom": "^7.6.2",
    "tailwind-merge": "^3.3.1",
    "tailwindcss-animate": "^1.0.7"
  },
  "devDependencies": {
    "@eslint/js": "^9.21.0",
    "@types/leaflet": "^1.9.17",
    "@types/node": "^22.15.3",
    "@types/react": "^19.1.4",
    "@types/react-dom": "^19.1.5",
    "@vitejs/plugin-react": "^4.3.4",
    "autoprefixer": "^10.4.21",
    "eslint": "^9.21.0",
    "eslint-plugin-react-hooks": "^5.1.0",
    "eslint-plugin-react-refresh": "^0.4.19",
    "globals": "^15.15.0",
    "postcss": "^8.5.3",
    "tailwindcss": "^3.4.17",
    "typescript": "~5.7.2",
    "typescript-eslint": "^8.24.1",
    "vite": "^6.2.0"
  }
}
</file>

<file path="src/pages/ChooseTeam/ChooseTeam.tsx">
// src/pages/ChooseTeam/ChooseTeam.tsx

import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { TeamService } from '../../api/teamService';
import { Team } from '../../types';
import { useAuth } from '../../contexts/AuthContext';
import TeamCard from '../../components/TeamCard';
import CreateTeamButton from '../../components/CreateTeamButton';
import SelectTeamButton from '../../components/SelectTeamButton';
import { ButtonHomeBack } from '@/components/ButtonHomeBack';
import { ArrowLeft, House } from 'lucide-react';

export const ChooseTeam = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const { refreshUser } = useAuth();

  const [selectedTeamId, setSelectedTeamId] = useState<number | null>(null);

  // Busca as equipes da API
  const { data: teams, isLoading, isError } = useQuery<Team[]>({
    queryKey: ['teams'],
    queryFn: TeamService.getTeams,
  });

  // Muta√ß√£o para entrar em uma equipe (caso precise dessa l√≥gica aqui)
  const joinTeamMutation = useMutation({
    mutationFn: (code: string) => TeamService.joinTeam(code),
    onSuccess: async () => {
      await refreshUser();
      queryClient.invalidateQueries({ queryKey: ['teams'] });
      alert("Voc√™ entrou na equipe!");
      navigate("/game-selection");
    },
    onError: (err: any) => alert(`Erro: ${err.response?.data?.detail || "C√≥digo inv√°lido"}`),
  });

  const handleTeamClick = (id: number) => {
    setSelectedTeamId(id);
  };

  const handleCreateTeam = () => {
    navigate("/create-team");
  };

  const handleSelectTeam = () => {
    const team = teams?.find(t => t.id === selectedTeamId);
    if (team) {
      // A l√≥gica de "entrar" na equipe deve ser feita aqui se o usu√°rio ainda n√£o tiver uma
      // Por simplicidade, vamos assumir que o backend associa o usu√°rio ao selecionar
      // ou que isso ser√° feito em outra tela. Apenas navegamos.
      // Para uma integra√ß√£o completa, poder√≠amos chamar joinTeamMutation.mutate(team.codigo);
      navigate("/game-selection");
    }
  };

  if (isLoading) return <div className="text-white text-center">Carregando equipes...</div>;
  if (isError) return <div className="text-red-500 text-center">Erro ao carregar equipes.</div>;

  return (
    <div className="h-screen bg-gradient-to-b from-indigo-900 to-purple-700 font-pixel relative overflow-hidden flex flex-col">
      <img className="w-[375px] h-[147px] absolute top-[120px] left-[157px] object-cover animate-float-right z-0" alt="Nuvem" src="/nuvemleft.png" />
      <img className="w-[436px] h-[170px] absolute bottom-[30px] right-[27px] object-cover animate-float-left opacity-75 scale-110 z-0" alt="Nuvem" src="/nuvemright.png" />

      {/* <<< MUDAN√áA: Adicionamos 'relative' e 'z-10' a este cont√™iner para coloc√°-lo na frente das nuvens */}
      <div className="relative z-10 flex flex-col flex-1">
        <div className="flex gap-5 absolute top-14 left-[33px]">
          <ButtonHomeBack onClick={() => navigate(-1)}><ArrowLeft /></ButtonHomeBack>
          <ButtonHomeBack onClick={() => navigate("/perfil")}><House /></ButtonHomeBack>
        </div>
        <div className="flex-1 overflow-auto container mx-auto px-4 py-4">
          <h1 className="text-2xl md:text-2xl text-yellow-300 font-bold text-center mt-2 mb-8 tracking-wide" style={{ textShadow: '2px 3px 2px black' }}>
            ESCOLHA SUA EQUIPE
          </h1>
          <div className="bg-white/5 backdrop-blur-sm border-2 border-white/20 rounded-lg p-2.5 mb-2 mt-20">
            <CreateTeamButton onClick={handleCreateTeam} />
          </div>
          <div className="mb-6">
            <h2 className="text-2xl text-center text-yellow-300 font-bold mb-4 z-10" style={{ textShadow: '2px 3px 2px black' }}>EQUIPES</h2>
            <div className="space-y-4">
              {teams?.map(team => (
                <TeamCard
                  key={team.id}
                  team={team}
                  onClick={() => handleTeamClick(team.id)}
                  selected={team.id === selectedTeamId}
                />
              ))}
            </div>
          </div>
          <div className="justify-center flex">
            <SelectTeamButton onClick={handleSelectTeam} />
          </div>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/pages/escolherVeiculo/VehicleSelectionPage.tsx">
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Vehicle } from '../../types/vehicle';
import {
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselNext,
  CarouselPrevious,
  type CarouselApi,
} from '@/components/ui/carousel';
import {
  Dialog,
  DialogContent,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  CalendarDays,
  MapPin,
  DollarSign,
} from 'lucide-react';
import { Button } from "@/components/ui/button";

// TODO: Ajustar imagens, (adicionar imagens ao banco?)
import caminhaoMedioPng from '@/assets/caminhao_medio.png';
import camihaoPequenoPng from '@/assets/caminhao_pequeno.png';
import carretaPng from '@/assets/carreta.png';
import camhionetePng from '@/assets/caminhonete.png';

// FIXME: Ajustar imagens para cada tipo de veiculo (permitir o envio de imagens ou ter um conjunto de imagens selecionaveis via admin?)
const getVehicleImage = (modelName: string) => {
  switch (modelName.toLowerCase()) {
    case 'caminhonete':
      return camhionetePng;
    case 'caminhao pequeno':
      return camihaoPequenoPng;
    case 'caminhao medio':
      return caminhaoMedioPng;
    case 'carreta':
      return carretaPng;
    default:
      return camihaoPequenoPng;
  }
};


// O componente VehicleCard permanece o mesmo
const VehicleCard: React.FC<{
  vehicle: Vehicle;
  isSelected: boolean;
  onSelect: () => void;
}> = ({ vehicle, isSelected, onSelect }) => (
  <div
    className={`
      relative min-w-[280px] max-w-[320px] mx-4 cursor-pointer transition-transform duration-300
      ${isSelected ? 'scale-105 border-4 border-orange-500' : 'hover:scale-105 border border-gray-200'}
      bg-white p-4 rounded-xl shadow-md flex flex-col justify-between
    `}
    onClick={onSelect}
  >
    <div>
      <div className="flex justify-center mb-2">
        <img src={vehicle.image} alt={vehicle.name} className="h-48 object-contain" />
      </div>

      <h3 className="font-['Silkscreen'] text-center text-xl font-bold mb-2">{vehicle.name}</h3>
      <ul className="text-sm space-y-1">
        <li>üß± Capacidade: {vehicle.capacity} Kg</li>
        <li>üõ¢Ô∏è Tanque: {vehicle.maxCapacity} L</li>
        <li>üöó Asfalto: {vehicle.consumption.asphalt} KM/L</li>
      </ul>
    </div>

    <p className="font-['Silkscreen'] text-orange-600 font-bold text-center mt-3 text-lg">
      R$ {vehicle.cost.toLocaleString()}
    </p>
  </div>
);

export const VehicleSelectionPage = () => {
  const navigate = useNavigate();

  // NOVO: Estados para guardar os ve√≠culos da API, o estado de loading e poss√≠veis erros.
  const [vehicles, setVehicles] = useState<Vehicle[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const [selectedIndex, setSelectedIndex] = useState<number | null>(null); // Inicia como nulo
  const [showConfirmation, setShowConfirmation] = useState(false);
  const [availableMoney] = useState(100000);
  const [api, setApi] = useState<CarouselApi>();

  // NOVO: useEffect para buscar os dados da API quando o componente for montado.
  useEffect(() => {
    const fetchVehicles = async () => {
      try {
        const apiUrl = `${import.meta.env.VITE_API_URL}/jogo1/veiculos/`;
        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const dataFromApi = await response.json();

        const formattedVehicles: Vehicle[] = dataFromApi.map((apiVehicle: any) => ({
          id: String(apiVehicle.id),
          name: apiVehicle.modelo,
          capacity: apiVehicle.capacidade_carga,
          consumption: {
            asphalt: parseFloat((apiVehicle.autonomia / apiVehicle.capacidade_combustivel).toFixed(2)),
            dirt: parseFloat(((apiVehicle.autonomia / apiVehicle.capacidade_combustivel) * 0.8).toFixed(2))
          },
          image: getVehicleImage(apiVehicle.modelo),
          maxCapacity: apiVehicle.capacidade_combustivel,
          currentFuel: 0, // Tanque sempre vazio - usu√°rio deve abastecer
          cost: parseFloat(apiVehicle.preco),
        }));

        setVehicles(formattedVehicles);
        if (formattedVehicles.length > 0) {
            setSelectedIndex(0); // Define o primeiro ve√≠culo como selecionado por padr√£o
        }

      } catch (e) {
        if (e instanceof Error) {
            setError(`Falha ao buscar ve√≠culos: ${e.message}`);
        } else {
            setError("Ocorreu um erro desconhecido.");
        }
        console.error(e);
      } finally {
        setIsLoading(false);
      }
    };

    fetchVehicles();
  }, []); // O array vazio [] garante que este efeito rode apenas uma vez.

  useEffect(() => {
    if (!api || selectedIndex === null) return;
    api.scrollTo(selectedIndex);
    const onSelect = () => {
      setSelectedIndex(api.selectedScrollSnap());
    };
    api.on('select', onSelect);
    return () => {
      api.off('select', onSelect);
    };
  }, [api, selectedIndex]);

  const handleVehicleSelect = (index: number) => {
    setSelectedIndex(index);
    setShowConfirmation(true);
  };

   const handleConfirm = () => {
    if (selectedIndex === null) return; // Prote√ß√£o extra
    const selectedVehicle = vehicles[selectedIndex];
    if (selectedVehicle.cost <= availableMoney) {
      navigate('/routes', {
        state: {
          selectedVehicle: selectedVehicle,
          availableMoney: availableMoney - selectedVehicle.cost
        }
      });
    }
   };

  if (isLoading) {
    return <div className="bg-sky-100 min-h-screen flex items-center justify-center font-['Silkscreen'] text-2xl">Carregando ve√≠culos...</div>;
  }

  if (error) {
    return <div className="bg-red-100 min-h-screen flex items-center justify-center font-['Silkscreen'] text-2xl text-red-700">{error}</div>;
  }

  const selectedVehicle = selectedIndex !== null ? vehicles[selectedIndex] : null;

  return (
    <div className="bg-sky-100 min-h-screen flex flex-col items-center justify-center px-4 py-8">
      {/* Bot√£o de Voltar */}
      <div className="absolute top-4 left-4">
        <Button
          onClick={() => navigate(-1)}
          className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 border border-black rounded-md shadow-md font-['Silkscreen'] h-10"
        >
          ‚Üê Voltar
        </Button>
      </div>

      {/* Saldo dispon√≠vel */}
      <div className="absolute top-4 right-4 font-['Silkscreen'] bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 border border-black rounded-md shadow-md flex items-center justify-center h-10">
        R$ {availableMoney.toLocaleString()}
      </div>

      <h1 className="font-['Silkscreen'] text-3xl mb-8 text-center">
        ESCOLHA UM CAMINH√ÉO
      </h1>

      <div className="relative w-full max-w-[1200px] px-16">
        <Carousel
          setApi={setApi}
          className="w-full"
          opts={{
            align: "center",
            loop: true,
          }}
        >
          <CarouselContent className="-ml-4 py-4 font-['Silkscreen'] ">
            {vehicles.map((vehicle, index) => (
              <CarouselItem key={vehicle.id} className="basis-auto md:basis-1/2 lg:basis-1/3 pl-4">
                <VehicleCard
                  vehicle={vehicle}
                  isSelected={selectedIndex === index}
                  onSelect={() => handleVehicleSelect(index)}
                />
              </CarouselItem>
            ))}
          </CarouselContent>

          <CarouselPrevious className="hidden md:flex opacity-100 -left-4 h-14 w-14 bg-orange-500 hover:bg-orange-600 transition-all duration-300 ease-in-out hover:scale-110 text-white border-none rounded-sm" />
          <CarouselNext className="hidden transition-all duration-300 ease-in-out hover:scale-110 md:flex opacity-100 -right-4 h-14 w-14 bg-orange-500 hover:bg-orange-600 text-white border-none rounded-sm" />
        </Carousel>
      </div>

      {selectedVehicle && (
        <Dialog open={showConfirmation} onOpenChange={setShowConfirmation}>
            <DialogContent className="sm:max-w-md font-['Silkscreen']">
                <DialogHeader>
                    <DialogTitle className="font-['Silkscreen'] flex items-center gap-2 text-xl">
                        Ve√≠culo Selecionado
                    </DialogTitle>
                </DialogHeader>
                <div className="space-y-3 text-sm">
                    <div>
                        <div className="flex items-center gap-4">
                            <img src={selectedVehicle.image} className="h-16 w-16 object-contain" />
                            <div>
                                <p className="font-['Silkscreen'] font-bold text-base">{selectedVehicle.name}</p>
                                <ul className="text-xs">
                                    <li>Capacidade: {selectedVehicle.capacity} Kg</li>
                                    <li>Tanque: {selectedVehicle.maxCapacity} L</li>
                                    <li>Asfalto: {selectedVehicle.consumption.asphalt} KM/L</li>
                                    <li>Terra: {selectedVehicle.consumption.dirt} KM/L</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 className="font-semibold mb-1 text-base">Detalhes da Compra</h4>
                        <div className="text-sm space-y-1">
                            <p className="flex items-center gap-2">
                                <CalendarDays size={16} /> Data/Hora: Agora
                            </p>
                            <p className="flex items-center gap-2">
                                <MapPin size={16} /> Local de Retirada: Base
                            </p>
                            <p className="font-['Silkscreen'] flex items-center gap-2 text-lg font-bold">
                                <DollarSign size={16} /> Total: R$ {selectedVehicle.cost.toLocaleString()}
                            </p>
                        </div>
                    </div>
                </div>
                <DialogFooter className="pt-4 font-['Silkscreen']">
                    <Button onClick={handleConfirm} className="bg-green-600 hover:bg-green-700 font-['Silkscreen']" disabled={availableMoney < selectedVehicle.cost}>
                        {availableMoney < selectedVehicle.cost ? "Dinheiro Insuficiente" : "Confirmar"}
                    </Button>
                    <Button variant="destructive" onClick={() => setShowConfirmation(false)} className="font-['Silkscreen']">
                        Cancelar
                    </Button>
                </DialogFooter >
            </DialogContent>
        </Dialog>
      )}
    </div>
  );
};
</file>

<file path="src/main.tsx">
import { StrictMode } from "react";
import { BrowserRouter, Route, Routes } from "react-router-dom";
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { HomePage } from "./pages/Home/HomePage";
import { VehicleSelectionPage } from './pages/escolherVeiculo';
import { Login } from "./pages/auth/Login/Login";
import { Cadastro } from "./pages/auth/Cadastro/Cadastro";
import { ForgotPassword } from "./pages/auth/ForgotPassword/ForgotPassword";
import { ChangePassword } from "./pages/Perfil/ChangePassword"; 
import { TutorialPage } from "./pages/Tutorial/TutorialPage";
import { PerfilPage } from "./pages/Perfil/PerfilPage";
import { AuthProvider } from "./contexts/AuthContext";
import { ProtectedRoute } from "./components/ProtectedRoute";
import { EditarPerfilPage } from "./pages/Perfil/EditarPerfil";
import { ExcluirEquipePage } from "./pages/Perfil/ExcluirEquipe";
import { MapComponent } from "./pages/mapaRota/MapComponent";
import { EditarEquipePage } from "./pages/Perfil/EditarEquipe";
import { CriarEquipePage} from "./pages/Perfil/CriarEquipe";
import { createRoot } from "react-dom/client";
import GameSelectionPage from "./pages/GameSelection/GameSelectionPage";
import { ApresentacaoDesafioPage} from "./pages/Desafio/ApresentacaoDesafio";
import { RankingPage } from "./pages/Ranking/RankingPage";
import { ChooseTeam } from "./pages/ChooseTeam/ChooseTeam";
import { GameScene } from "./pages/Game-truck/game";
import { FuelPage } from "./pages/fuel/FuelPage";
import { RoutesPage } from "./pages/RoutesPage/RoutesPage";

import { PauseMenu } from "./pages/PauseMenu/PauseMenu.tsx";// Criar inst√¢ncia do QueryClient
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5, // 5 minutos
      retry: 1,
    },
  },
});

createRoot(document.getElementById("app") as HTMLElement).render(
  <StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <AuthProvider>
          <Routes>
            {/* Rotas p√∫blicas */}
            <Route path="/" element={<HomePage />} />
            {/* <Route path="/select-vehicle" element={<HomePage />} />
            <Route path="/mapa-rota" element={<MapComponent />} /> */}
            
            <Route path="/game" element={<GameScene />} />
            <Route path="/login" element={<Login />} />
            <Route path="/cadastro" element={<Cadastro />} />
            <Route path="/forgot-password" element={<ForgotPassword />} />
            <Route path="/reset-password/:uidb64/:token" element={<ForgotPassword />} />
            <Route path="/tutorial" element={<TutorialPage />} /> 

            {/* Rotas protegidas */}
            <Route path="/perfil" element={
             <ProtectedRoute>
                <PerfilPage />
             </ProtectedRoute>
            } />
            <Route path="/perfil/editar" element={
             <ProtectedRoute>
                <EditarPerfilPage />
             </ProtectedRoute>
            } />
            <Route path="/perfil/excluir-equipe" element={
             <ProtectedRoute>
                <ExcluirEquipePage />
             </ProtectedRoute>
            } />
            <Route path="/perfil/editar-equipe" element={
             <ProtectedRoute>
                <EditarEquipePage />
             </ProtectedRoute>
            } />
            <Route path="/mudar-senha" element={
             <ProtectedRoute>
                <ChangePassword />
             </ProtectedRoute>
            } />
            <Route path="/ranking" element={
             <ProtectedRoute>
                <RankingPage />
             </ProtectedRoute>
            } />
            <Route path="/game" element={
             <ProtectedRoute>
                <HomePage />
             </ProtectedRoute>
            } />
            <Route path="/games" element={
             <ProtectedRoute>
                <HomePage />
             </ProtectedRoute>
            } />
            <Route path="/select-vehicle" element={
             <ProtectedRoute>
                <VehicleSelectionPage />
             </ProtectedRoute>
            } />
            <Route path="/mapa-rota" element={
             <ProtectedRoute>
                <MapComponent />
             </ProtectedRoute>
            } />
            <Route path="/mapa" element={
             <ProtectedRoute>
                <MapComponent />
             </ProtectedRoute>
            } />
            <Route path="/choose-team" element={
             <ProtectedRoute>
                <ChooseTeam />
             </ProtectedRoute>
            } />
            <Route path="/create-team" element={
              <ProtectedRoute>
                <CriarEquipePage/>
               </ProtectedRoute>
            } />
            <Route path="/desafio" element={
             <ProtectedRoute>
               <ApresentacaoDesafioPage />
              </ProtectedRoute>
            } />  
            <Route path="/game-selection" element={
             <ProtectedRoute>
               <GameSelectionPage />
             </ProtectedRoute>
            } /> 
            
            {/* Rota para o PauseMenu para testes */}
            <Route path="/pause-menu" element={
             <ProtectedRoute>
               <PauseMenu 
                 isVisible={true}
                 onResume={() => console.log('Resume')}
                 onGoToProfile={() => console.log('Go to Profile')}
                 onRestart={() => console.log('Restart')}
               />
             </ProtectedRoute>
            } />

            <Route path="/routes" element={<RoutesPage />} />
            <Route path="/fuel" element={<FuelPage />} />
            <Route path="/map" element={<MapComponent />} />

          </Routes>
        </AuthProvider>
      </BrowserRouter>
      {/* DevTools apenas em desenvolvimento */}
      {import.meta.env.DEV && <ReactQueryDevtools initialIsOpen={false} />}
    </QueryClientProvider>
  </StrictMode>
);
</file>

<file path="src/pages/mapaRota/MapComponent.tsx">
// src/pages/mapaRota/MapComponent.tsx

import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';
import { MapContainer, TileLayer, Polyline, Marker, Popup, useMapEvents } from 'react-leaflet';
import 'leaflet/dist/leaflet.css';
import L from 'leaflet';
import { Route } from './routesData';
import { useLocation, useNavigate } from 'react-router-dom';
import { Vehicle } from '../../types/vehicle';
import { ArrowLeft } from 'lucide-react';

// --- Corre√ß√£o para o √≠cone padr√£o do Leaflet ---
import defaultIcon from 'leaflet/dist/images/marker-icon.png';
import iconShadow from 'leaflet/dist/images/marker-shadow.png';

let DefaultIcon = L.icon({
  iconUrl: defaultIcon,
  shadowUrl: iconShadow,
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34]
});
L.Marker.prototype.options.icon = DefaultIcon;


// --- √çcones Customizados ---
// rest, construction, gas, toll, danger
const tollIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/2297/2297592.png', iconSize: [30, 30], iconAnchor: [15, 15] });
const dangerIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/1008/1008928.png', iconSize: [30, 30], iconAnchor: [15, 15] });
const restStopIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/6807/6807796.png', iconSize: [30, 30], iconAnchor: [15, 15] });
const constructionIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/4725/4725077.png', iconSize: [30, 30], iconAnchor: [15, 15] });
const gasStationIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/465/465090.png', iconSize: [30, 30], iconAnchor: [15, 15] });


// --- √çcones para √°reas de risco ---
const lowRiskIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/6276/6276686.png', iconSize: [30, 30], iconAnchor: [15, 15] });
const mediumRiskIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/4751/4751259.png', iconSize: [30, 30], iconAnchor: [15, 15] });
const highRiskIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/900/900532.png', iconSize: [30, 30], iconAnchor: [15, 15] });

// --- √çcones de velocidade ---
 const speedLimitIcon20 = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/1670/1670172.png', iconSize: [30, 30], iconAnchor: [15, 15] });
 const speedLimitIcon40 = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/5124/5124881.png', iconSize: [30, 30], iconAnchor: [15, 15] });
 const speedLimitIcon50 = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/752/752738.png', iconSize: [30, 30], iconAnchor: [15, 15] });
 const speedLimitIcon60 = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/15674/15674424.png', iconSize: [30, 30], iconAnchor: [15, 15] });
 const speedLimitIcon80 = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/3897/3897785.png', iconSize: [30, 30], iconAnchor: [15, 15] });
 const speedLimitIcon100 = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/10392/10392769.png', iconSize: [30, 30], iconAnchor: [15, 15] });



  // logica para obter o √≠cone de limite de velocidade
  const getSpeedLimitIcon = (speed: number): L.Icon => {
    switch (speed) {
      case 20: return speedLimitIcon20;
      case 40: return speedLimitIcon40;
      case 50: return speedLimitIcon50;
      case 60: return speedLimitIcon60;
      case 80: return speedLimitIcon80;
      case 100: return speedLimitIcon100;
      default: return speedLimitIcon60; // √≠cone padr√£o caso a velocidade n√£o corresponda
    }
  };

// NOVA INTERFACE PARA OS SEGMENTOS RENDERIZ√ÅVEIS
interface RenderSegment {
  path: [number, number][];
  isDirt: boolean;
  style: L.PathOptions;
}

// Componente para animar o caminh√£o
interface TruckAnimationProps {
  routePath: [number, number][];
  speed: number; // Velocidade m√©dia em km/h
  playing: boolean;
  onTripEnd: () => void;
  onFuelEmpty: () => void;
  vehicle: Vehicle;
  setCurrentFuel: (fuel: number) => void;
  isDirtRoad: boolean;
}

const TruckAnimation: React.FC<TruckAnimationProps> = ({
  routePath,
  speed,
  playing,
  onTripEnd,
  onFuelEmpty,
  vehicle,
  setCurrentFuel,
  isDirtRoad
}) => {
  const truckRef = useRef<L.Marker>(null);
  const animationFrameRef = useRef<number | null>(null);
  const currentSegment = useRef<number>(0);
  const segmentProgress = useRef<number>(0);
  const startTimeRef = useRef<number>(0);
  const lastTimeRef = useRef<number>(0);
  const totalDistanceTraveledRef = useRef<number>(0);
  const lastFuelUpdateRef = useRef<number>(0);
  const currentFuelRef = useRef<number>(vehicle.currentFuel);
  const visualizationSpeedFactor = 300; // Fator de acelera√ß√£o da visualiza√ß√£o

  // Criar √≠cone personalizado para o ve√≠culo
  const vehicleIcon = useMemo(() => {
    return L.icon({
      iconUrl: vehicle.image,
      iconSize: [40, 40],
      iconAnchor: [20, 20],
      popupAnchor: [0, -20]
    });
  }, [vehicle.image]);

  // Calcular consumo de combust√≠vel com base no tipo de estrada
  const calculateFuelConsumption = useCallback((distanceTraveled: number) => {
    const consumption = isDirtRoad ? vehicle.consumption.dirt : vehicle.consumption.asphalt;
    return distanceTraveled / consumption;
  }, [isDirtRoad, vehicle.consumption]);

  // Atualizar o combust√≠vel do ve√≠culo
  const updateFuel = useCallback((distanceTraveled: number) => {
    const fuelConsumed = calculateFuelConsumption(distanceTraveled);
    const newFuel = Math.max(0, currentFuelRef.current - fuelConsumed);

    currentFuelRef.current = newFuel;
    setCurrentFuel(newFuel);

    // Se o combust√≠vel acabou, parar o caminh√£o
    if (newFuel <= 0) {
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
        animationFrameRef.current = null;
      }
      onFuelEmpty();
      return true;
    }
    return false;
  }, [calculateFuelConsumption, onFuelEmpty, setCurrentFuel]);

  const animateTruck = useCallback(() => {
    if (!playing || !truckRef.current || !routePath || routePath.length < 2) {
      return;
    }

    // Se estamos no final da rota
    if (currentSegment.current >= routePath.length - 1) {
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
      }
      onTripEnd();
      return;
    }

    const now = performance.now();

    // Para a primeira execu√ß√£o ou ap√≥s resumir de uma pausa
    if (startTimeRef.current === 0) {
      startTimeRef.current = now;
      lastTimeRef.current = now;
    }

    const elapsed = now - startTimeRef.current;
    const deltaTime = now - lastTimeRef.current;
    lastTimeRef.current = now;

    // Pontos do segmento atual
    const startPoint = routePath[currentSegment.current];
    const endPoint = routePath[currentSegment.current + 1];

    // Calcular dist√¢ncia em metros do segmento (usando a f√≥rmula de Haversine)
    const R = 6371e3; // Raio da Terra em metros
    const œÜ1 = startPoint[0] * Math.PI / 180;
    const œÜ2 = endPoint[0] * Math.PI / 180;
    const ŒîœÜ = (endPoint[0] - startPoint[0]) * Math.PI / 180;
    const ŒîŒª = (endPoint[1] - startPoint[1]) * Math.PI / 180;

    const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
      Math.cos(œÜ1) * Math.cos(œÜ2) *
      Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const segmentDistanceMeters = R * c;
    const segmentDistanceKm = segmentDistanceMeters / 1000;

    // Tempo para percorrer este segmento em milissegundos (considerando a velocidade)
    const timeToCompleteMsec = (segmentDistanceKm / speed) * 3600 * 1000;

    // Ajustar para uma velocidade de visualiza√ß√£o acelerada
    const adjustedTimeToCompleteMsec = timeToCompleteMsec / visualizationSpeedFactor;

    // Calcular progresso neste segmento (0 a 1)
    segmentProgress.current = Math.min(elapsed / adjustedTimeToCompleteMsec, 1);

    // Calcular dist√¢ncia percorrida neste frame
    const previousProgress = (elapsed - deltaTime) / adjustedTimeToCompleteMsec;
    const previousDistanceFraction = Math.min(previousProgress, 1);
    const currentDistanceFraction = segmentProgress.current;
    const distanceDiff = currentDistanceFraction - previousDistanceFraction;
    const distanceThisFrameKm = segmentDistanceKm * distanceDiff;

    // Atualizar a dist√¢ncia total percorrida
    totalDistanceTraveledRef.current += distanceThisFrameKm;

    // Atualizar o combust√≠vel a cada 1km ou quando o combust√≠vel estiver abaixo de 10%
    if (totalDistanceTraveledRef.current - lastFuelUpdateRef.current >= 1 ||
      currentFuelRef.current <= (vehicle.maxCapacity * 0.1)) {
      const distanceSinceLastUpdate = totalDistanceTraveledRef.current - lastFuelUpdateRef.current;
      lastFuelUpdateRef.current = totalDistanceTraveledRef.current;

      // Se o combust√≠vel acabou, parar a anima√ß√£o
      if (updateFuel(distanceSinceLastUpdate)) {
        return;
      }
    }

    // Se completou este segmento, avan√ßar para o pr√≥ximo
    if (segmentProgress.current >= 1) {
      currentSegment.current += 1;
      segmentProgress.current = 0;
      startTimeRef.current = now;

      // Se ainda tem segmentos a percorrer, continua a anima√ß√£o
      if (currentSegment.current < routePath.length - 1) {
        animationFrameRef.current = requestAnimationFrame(animateTruck);
      } else {
        onTripEnd();
      }
      return;
    }

    const newLat = startPoint[0] + (endPoint[0] - startPoint[0]) * segmentProgress.current;
    const newLng = startPoint[1] + (endPoint[1] - startPoint[1]) * segmentProgress.current;
    const newPosition = L.latLng(newLat, newLng);

    truckRef.current.setLatLng(newPosition);
    animationFrameRef.current = requestAnimationFrame(animateTruck);
  }, [playing, routePath, speed, onTripEnd, updateFuel, vehicle.maxCapacity, onFuelEmpty]);

  // Iniciar ou reiniciar a anima√ß√£o quando o estado de playing mudar
  useEffect(() => {
    if (playing && routePath && routePath.length > 1) {
      if (!truckRef.current || (currentSegment.current === 0 && segmentProgress.current === 0)) {
        truckRef.current?.setLatLng(L.latLng(routePath[0][0], routePath[0][1]));
      }

      if (currentSegment.current === 0 && segmentProgress.current === 0) {
        totalDistanceTraveledRef.current = 0;
        lastFuelUpdateRef.current = 0;
        currentFuelRef.current = vehicle.currentFuel;
      }

      if (segmentProgress.current === 0) {
        startTimeRef.current = 0;
      }

      animationFrameRef.current = requestAnimationFrame(animateTruck);
    } else if (!playing && animationFrameRef.current) {
      cancelAnimationFrame(animationFrameRef.current);
      animationFrameRef.current = null;
    }

    return () => {
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
      }
    };
  }, [playing, routePath, animateTruck, vehicle.currentFuel]);

  if (!routePath || routePath.length === 0) return null;

  return (
    <Marker
      position={L.latLng(routePath[0][0], routePath[0][1])} // Posi√ß√£o inicial
      icon={vehicleIcon}
      ref={truckRef}
    >
      <Popup>
        <div className="text-sm">
          <p className="font-bold">{vehicle.name}</p>
          <p>Combust√≠vel: {Math.round(currentFuelRef.current)} de {vehicle.maxCapacity}L</p>
        </div>
      </Popup>
    </Marker>
  );
};

// Componente para mostrar o caminh√£o em uma posi√ß√£o espec√≠fica baseada nos dados externos
interface StaticTruckMarkerProps {
  routePath: [number, number][];
  currentPathIndex: number;
  pathProgress: number;
  vehicle: Vehicle;
}

const StaticTruckMarker: React.FC<StaticTruckMarkerProps> = ({
  routePath,
  currentPathIndex,
  pathProgress,
  vehicle
}) => {
  // Criar √≠cone personalizado para o ve√≠culo
  const vehicleIcon = useMemo(() => {
    // Converter URL da imagem para uso no mapa
    let imageUrl = vehicle.image;
    if (imageUrl.startsWith('/src/assets/')) {
      imageUrl = imageUrl.replace('/src/assets/', '/assets/');
    }
    if (!imageUrl.startsWith('/assets/') && !imageUrl.startsWith('http')) {
      imageUrl = `/assets/${imageUrl.split('/').pop()}`;
    }

    return L.icon({
      iconUrl: imageUrl,
      iconSize: [40, 40],
      iconAnchor: [20, 20],
      popupAnchor: [0, -20]
    });
  }, [vehicle.image]);

  // Calcular posi√ß√£o atual do caminh√£o baseada nos dados externos
  const currentPosition = useMemo(() => {
    if (!routePath || routePath.length < 2) {
      return routePath?.[0] || [0, 0];
    }

    const totalSegments = routePath.length - 1;
    
    // Garantir que o √≠ndice esteja dentro dos limites
    const segmentIndex = Math.min(Math.max(0, currentPathIndex), totalSegments - 1);
    const nextIndex = Math.min(segmentIndex + 1, totalSegments);
    
    const startPoint = routePath[segmentIndex];
    const endPoint = routePath[nextIndex];
    
    // Interpolar entre os dois pontos
    const progress = Math.min(Math.max(0, pathProgress), 1);
    const lat = startPoint[0] + (endPoint[0] - startPoint[0]) * progress;
    const lng = startPoint[1] + (endPoint[1] - startPoint[1]) * progress;
    
    return [lat, lng] as [number, number];
  }, [routePath, currentPathIndex, pathProgress]);

  if (!routePath || routePath.length === 0) return null;

  return (
    <Marker
      position={currentPosition}
      icon={vehicleIcon}
    >
      <Popup>
        <div className="text-sm">
          <p className="font-bold">{vehicle.name}</p>
          <p>üöõ Posi√ß√£o Atual do Jogo</p>
          <p>Segmento: {currentPathIndex + 1}/{routePath.length - 1}</p>
          <p>Progresso: {(pathProgress * 100).toFixed(1)}%</p>
        </div>
      </Popup>
    </Marker>
  );
};

interface MapComponentProps {
  preSelectedRoute?: Route | null;
  preSelectedVehicle?: Vehicle | null;
  preAvailableMoney?: number;
  showControls?: boolean;
  // Novos props para sincronizar com o progresso do jogo
  externalProgress?: {
    currentPathIndex: number;
    pathProgress: number;
    totalProgress: number;
  };
}

export const MapComponent: React.FC<MapComponentProps> = ({
  preSelectedRoute = null,
  preSelectedVehicle = null,
  preAvailableMoney = null,
  showControls = true,
  externalProgress = null
}) => {
  const [simulatedTime, setSimulatedTime] = useState<number>(0);
  const location = useLocation();
  const navigate = useNavigate();
  const juazeiroCoordinates: [number, number] = [-9.44977115369502, -40.52422616182216];
  const salvadorCoordinates: [number, number] = [-12.954121960174133, -38.47128319030249];

  // Dados recebidos da tela anterior ou props
  const selectedRoute = preSelectedRoute || location.state?.selectedRoute || null;
  const [isPlaying, setIsPlaying] = useState(false);

  useEffect(() => {
  let interval: NodeJS.Timeout;

  if (isPlaying) {
    const start = Date.now();
    interval = setInterval(() => {
      const elapsedRealMs = Date.now() - start;
      const accelerationFactor = 8 / 3;
      const simulatedMinutes = (elapsedRealMs / 60000) * accelerationFactor;
      setSimulatedTime(simulatedMinutes);
    }, 1000);
  }

    return () => clearInterval(interval);
  }, [isPlaying]);


  // Estado para ve√≠culo e saldo
  const [vehicle, setVehicle] = useState<Vehicle>(() => {
    if (preSelectedVehicle) {
      return preSelectedVehicle;
    }
    if (location.state && location.state.selectedVehicle) {
      return location.state.selectedVehicle;
    }
    if (showControls) {
      navigate('/routes');
    }
    // Retornar um ve√≠culo padr√£o
    return { id: 'carreta', name: 'Carreta', capacity: 60, consumption: { asphalt: 2, dirt: 1.5 }, image: '/carreta.png', maxCapacity: 495, currentFuel: 0, cost: 4500 };
  });

  // Estado para o saldo dispon√≠vel
  const [availableMoney] = useState<number>(() => {
    if (preAvailableMoney !== null) {
      return preAvailableMoney;
    }
    if (location.state && location.state.availableMoney !== undefined) {
      return location.state.availableMoney;
    }
    return 5500; // Valor padr√£o
  });

  // Estado para controlar a exibi√ß√£o do modal de fim de jogo
  const [showGameOverModal, setShowGameOverModal] = useState(false);
  const [gameOverReason, setGameOverReason] = useState('');

  // Vari√°vel para controlar se o mapa deve ser ajustado automaticamente
  const [initialMapViewSet, setInitialMapViewSet] = useState(false);

  // NOVO ESTADO PARA ARMAZENAR OS SEGMENTOS DA ROTA
  const [renderedSegments, setRenderedSegments] = useState<RenderSegment[]>([]);

  // Centraliza o mapa nos pontos inicial e final da rota selecionada
  function MapViewControl({ route }: { route: Route | null }) {
    const map = useMapEvents({});

    useEffect(() => {
      // S√≥ ajuste o mapa automaticamente quando uma rota for selecionada pela primeira vez
      // ou quando isPlaying for false (n√£o est√° em execu√ß√£o)
      if (route && route.pathCoordinates && route.pathCoordinates.length > 1 && (!initialMapViewSet || !isPlaying)) {
        const bounds = L.latLngBounds(route.pathCoordinates);
        map.fitBounds(bounds, { padding: [50, 50] }); // Ajusta o zoom para caber a rota
        setInitialMapViewSet(true);
      } else if (!route && !initialMapViewSet) {
        // Se nenhuma rota estiver selecionada, centraliza em Juazeiro/Salvador
        const bounds = L.latLngBounds(juazeiroCoordinates, salvadorCoordinates);
        map.fitBounds(bounds, { padding: [100, 100] });
        setInitialMapViewSet(true);
      }
    }, [map, route, isPlaying]); // Adicionado isPlaying para reajustar o zoom quando pausado

    return null;
  }

  // NOVA L√ìGICA PARA SEGMENTAR A ROTA
  useEffect(() => {
    if (!selectedRoute || !selectedRoute.pathCoordinates) {
      setRenderedSegments([]);
      return;
    }

    const segments: RenderSegment[] = [];
    const totalPoints = selectedRoute.pathCoordinates.length;
    const totalDistance = selectedRoute.actualDistance || selectedRoute.distance;
    let lastIndex = 0;

    const sortedDirtSegments = (selectedRoute.dirtSegments || []).sort((a: any, b: any) => a.startKm - b.startKm);

    sortedDirtSegments.forEach((dirtSegment: any) => {
      const startIndex = Math.floor((dirtSegment.startKm / totalDistance) * totalPoints);
      const endIndex = Math.floor((dirtSegment.endKm / totalDistance) * totalPoints);

      if (startIndex > lastIndex) {
        segments.push({
          path: selectedRoute.pathCoordinates!.slice(lastIndex, startIndex + 1),
          isDirt: false,
          style: { color: '#1e40af', weight: 6, opacity: 1 }
        });
      }

      segments.push({
        path: selectedRoute.pathCoordinates!.slice(startIndex, endIndex + 1),
        isDirt: true,
        style: { color: '#8B4513', weight: 7, opacity: 0.9, dashArray: '10, 10' }
      });

      lastIndex = endIndex;
    });

    if (lastIndex < totalPoints - 1) {
      segments.push({
        path: selectedRoute.pathCoordinates.slice(lastIndex),
        isDirt: false,
        style: { color: '#1e40af', weight: 6, opacity: 1 }
      });
    }

    // Se n√£o houver nenhum segmento (rota sem trechos de terra), desenha a rota inteira
    if (segments.length === 0 && selectedRoute.pathCoordinates.length > 0) {
      segments.push({
        path: selectedRoute.pathCoordinates,
        isDirt: false,
        style: { color: '#1e40af', weight: 6, opacity: 1 }
      });
    }

    setRenderedSegments(segments);

  }, [selectedRoute]);

  const handleTripEnd = useCallback(() => {
    setIsPlaying(false);
    alert('Viagem conclu√≠da!');
  }, []);



  // √çcone para √°reas de risco
  const getRiskIcon = (riskLevel: 'Baixo' | 'M√©dio' | 'Alto'): L.Icon => {
    switch (riskLevel) {
      case 'Baixo': return lowRiskIcon;
      case 'M√©dio': return mediumRiskIcon;
      case 'Alto': return highRiskIcon;
      default: return mediumRiskIcon;
    }
  };

  const handleChangeRoute = () => {
    navigate('/routes', {
      state: {
        selectedVehicle: vehicle,
        availableMoney: availableMoney
      }
    });
  };

  const handleFuelEmpty = useCallback(() => {
    setIsPlaying(false);
    setGameOverReason('combust√≠vel');
    setShowGameOverModal(true);
  }, []);

  return (
    <div className="flex flex-col lg:flex-row h-screen p-4 font-['Silkscreen'] bg-[#200259]">
      {showControls && (
        <div className="absolute top-0 left-0 w-full flex items-center justify-between px-8 py-4 z-40">
          <button
            className="flex items-center px-6 py-2 bg-[#E3922A] text-black font-bold text-lg rounded-md shadow-lg
                     hover:bg-[#FFC06F] transition-all duration-200 border-2 border-black"
            onClick={handleChangeRoute}
          >
            <ArrowLeft /> TROCAR ROTA
          </button>
          <h1 className="text-3xl font-bold text-[#E3922A] text-center flex-1 -ml-16">
            {selectedRoute?.name || 'MAPA DA ROTA'}
          </h1>
          <div className="bg-[#E3922A] text-black text-2xl font-bold px-6 py-2 rounded-md shadow-lg border-2 border-black">
            R$ {availableMoney.toFixed(2)}
          </div>
        </div>
      )}

              <div className={`flex-1 w-full relative bg-gray-200 rounded-lg shadow-inner border-4 border-black ${showControls ? 'mt-20' : ''}`}>
        {selectedRoute && showControls && (
          <div className="absolute top-4 right-4 flex space-x-2 z-[1000]">
            <button
              className="px-4 py-2 bg-green-500 text-white font-bold text-md rounded-md shadow-lg hover:bg-green-600 transition-all duration-200 border-2 border-black"
              onClick={() => setIsPlaying(true)}
              disabled={isPlaying || !selectedRoute.pathCoordinates || selectedRoute.pathCoordinates.length < 2 || vehicle.currentFuel <= 0}
            >
              {isPlaying ? 'EM ANDAMENTO' : 'INICIAR'}
            </button>
            <button
              className="px-4 py-2 bg-blue-500 text-white font-bold text-md rounded-md shadow-lg hover:bg-blue-600 transition-all duration-200 border-2 border-black"
              onClick={() => navigate('/game', { 
                state: { 
                  vehicle, 
                  availableMoney 
                } 
              })}
              disabled={!selectedRoute || vehicle.currentFuel <= 0}
            >
              JOGO 2D
            </button>
            {isPlaying && (
              <div className="px-4 py-2 bg-white text-black font-['Silkscreen'] text-md rounded shadow-md border-2 border-black">
                Tempo: {Math.floor(simulatedTime / 60).toString().padStart(2, '0')}h:{Math.floor(simulatedTime % 60).toString().padStart(2, '0')}
              </div>
            )}
            <button
              className="px-4 py-2 bg-yellow-500 text-black font-bold text-md rounded-md shadow-lg hover:bg-yellow-600 transition-all duration-200 border-2 border-black"
              onClick={() => setIsPlaying(false)}
              disabled={!isPlaying}
            >
              PAUSAR
            </button>
          </div>
        )}
        <MapContainer
          center={juazeiroCoordinates}
          zoom={7}
          scrollWheelZoom={true}
          className="w-full h-full rounded-lg"
        >
          <TileLayer
            attribution='¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          />
          <MapViewControl route={selectedRoute} />

          {/* Apenas a rota selecionada ser√° exibida */}

          {/* Renderiza a rota selecionada em segmentos */}
          {renderedSegments.map((segment, index) => (
            <Polyline
              key={`segment-${selectedRoute?.routeId}-${index}`}
              positions={segment.path}
              pathOptions={segment.style}
            >
              <Popup>
                {segment.isDirt ?
                  <span className="font-bold text-yellow-800">Trecho de Terra</span> :
                  <span className="font-bold text-blue-700">{selectedRoute?.name}</span>
                }
              </Popup>
            </Polyline>
          ))}

          {/* Linha do progresso percorrido (quando h√° dados externos) */}
          {externalProgress && selectedRoute?.pathCoordinates && externalProgress.currentPathIndex > 0 && (
            <Polyline
              positions={selectedRoute.pathCoordinates.slice(0, externalProgress.currentPathIndex + 1)}
              pathOptions={{
                color: '#00cc66',
                weight: 6,
                opacity: 0.9
              }}
            >
              <Popup>
                <span className="font-bold text-green-700">Percurso Conclu√≠do - {externalProgress.totalProgress.toFixed(1)}%</span>
              </Popup>
            </Polyline>
          )}
          {/* Marcadores de Velocidade para a Rota Selecionada */}
          {selectedRoute?.speedLimits.map((speedLimit: any, index: number) => (
            speedLimit.coordinates && (
              <Marker
                key={`speed-${selectedRoute.routeId}-${index}`}
                position={speedLimit.coordinates}
                icon={getSpeedLimitIcon(speedLimit.value ?? 60)}
              >
                <Popup>
                  <span className="font-bold">Limite de Velocidade:</span><br />
                  {speedLimit.limit} na {speedLimit.road}
                </Popup>
              </Marker>
            )
          ))}

          {/* Renderiza os marcadores */}
          {selectedRoute?.tollBooths.map((toll: any, index: number) => <Marker key={`toll-${index}`} position={toll.coordinates as L.LatLngTuple} icon={tollIcon}><Popup>{toll.location}</Popup></Marker>)}
          {selectedRoute?.dangerZones?.map((zone: any, index: number) => <Marker key={`danger-${index}`} position={zone.coordinates as L.LatLngTuple} icon={getRiskIcon(zone.riskLevel)}><Popup>{zone.description}</Popup></Marker>)}
          <Marker position={juazeiroCoordinates}><Popup>Ponto de Partida: Juazeiro</Popup></Marker>
          <Marker position={salvadorCoordinates}><Popup>Destino: Salvador</Popup></Marker>

          {/* Componente de anima√ß√£o do caminh√£o */}
          {selectedRoute?.pathCoordinates && (
            externalProgress ? (
              // Usar posi√ß√£o externa quando fornecida (para modal do jogo)
              <StaticTruckMarker
                routePath={selectedRoute.pathCoordinates}
                currentPathIndex={externalProgress.currentPathIndex}
                pathProgress={externalProgress.pathProgress}
                vehicle={vehicle}
              />
            ) : (
              // Usar anima√ß√£o normal quando n√£o h√° dados externos
              <TruckAnimation
                routePath={selectedRoute.pathCoordinates}
                speed={(selectedRoute.actualDistance || selectedRoute.distance) / selectedRoute.estimatedTimeHours}
                playing={isPlaying}
                onTripEnd={handleTripEnd}
                onFuelEmpty={handleFuelEmpty}
                vehicle={vehicle}
                setCurrentFuel={(fuel) => setVehicle(prev => ({ ...prev, currentFuel: fuel }))}
                isDirtRoad={selectedRoute.dirtRoad || false}
              />
            )
          )}
        </MapContainer>
      </div>
      {showControls && (
        <div className="lg:w-1/4 w-full p-4 rounded-lg shadow-lg overflow-y-auto mb-4 lg:mb-0 lg:ml-4 mt-20">
          <div className="bg-[#FFC06F] p-4 rounded-lg shadow-md border-2 border-black mb-6">
            <h2 className="text-xl font-['Silkscreen'] font-bold mb-3 text-black text-center border-b-2 border-black pb-2">
              INFORMA√á√ïES DA ROTA
            </h2>
            
            {selectedRoute && (
              <div>
                <h3 className="font-['Silkscreen'] text-lg font-bold text-black mb-2">
                  {selectedRoute.name.toUpperCase()}
                </h3>
                <p className="font-sans text-black text-md mb-1">
                  <span className="font-bold">TEMPO ESTIMADO:</span> {selectedRoute.estimatedTime}
                </p>
                <p className="font-sans text-black text-md mb-1">
                  <span className="font-bold">DIST√ÇNCIA:</span> {selectedRoute.actualDistance ? `${selectedRoute.actualDistance.toFixed(0)}` : selectedRoute.distance} km
                </p>
                <p className="font-sans text-black text-md mb-3">
                  <span className="font-bold">RISCO:</span> {selectedRoute.safety.robberyRisk}
                </p>
              </div>
            )}

            <div className="bg-black h-px my-4"></div>
            
            <h3 className="font-['Silkscreen'] text-lg font-bold text-black mb-2">
              VE√çCULO: {vehicle.name.toUpperCase()}
            </h3>
            <p className="font-sans text-black text-md mb-1">- ASFALTO: {vehicle.consumption.asphalt}KM/L</p>
            <p className="font-sans text-black text-md mb-3">- TERRA: {vehicle.consumption.dirt}KM/L</p>

            <p className="font-sans text-black text-md mb-2">N√çVEL DO TANQUE</p>
            <div className="w-full bg-gray-300 rounded-full h-6 border-2 border-black">
              <div
                className="bg-green-500 h-full rounded-full flex items-center justify-center text-xs font-bold text-white"
                style={{ width: `${(vehicle.currentFuel / vehicle.maxCapacity) * 100}%` }}
              >
                {vehicle.currentFuel.toFixed(0)}/{vehicle.maxCapacity}L
              </div>
            </div>
          </div>
        </div>
      )}

      {showGameOverModal && (
        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[9999] p-4">
          <div className="bg-[#200259] rounded-lg shadow-2xl border-4 border-red-500 max-w-md w-full p-6">
            <h1 className="text-2xl font-['Silkscreen'] font-bold text-red-500 text-center mb-4">FIM DE JOGO!</h1>
            <p className="text-xl font-['Silkscreen'] text-white text-center mb-6">{gameOverReason === 'combust√≠vel' ? 'Seu combust√≠vel acabou!' : 'Viagem interrompida!'}</p>
            <div className="flex justify-center space-x-4">
              <button onClick={() => { setShowGameOverModal(false); navigate('/select-vehicle'); }} className="px-6 py-3 bg-red-500 text-white font-bold rounded-md shadow-lg border-2 border-black hover:bg-red-600 transition-all duration-200">
                VOLTAR AO IN√çCIO
              </button>
            </div>
          </div>
        </div>
      )}


    </div>
  );
};
</file>

</files>
